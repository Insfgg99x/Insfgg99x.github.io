<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[FGPopMenu]]></title>
      <url>http://cgpointzero.top/2017/03/14/FGPopMenu/</url>
      <content type="html"><![CDATA[<p>##FCPopMenu ç®€æ˜“ã€å‹å¥½çš„ä¸‹æ‹‰èœå•</p>
<p>An easy,friendly and customizable way to make a popover menu.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-b419a2c9014d511e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###Installation</p>
<blockquote>
<p>Cocoapods</p>
</blockquote>
<p>pod â€œFCPopMenuâ€, â€œ~&gt;1.0â€</p>
<p>Use <code>pod repo update</code> if not exist.</p>
<blockquote>
<p>Manual</p>
</blockquote>
<p>Download <code>FCPopMenu</code>,drag folder â€œFCPopMenuâ€ into your project, make sure to ues â€œcreate group if needâ€.</p>
<p>###Useage</p>
<blockquote>
<p>How to create FCPopMenuItems</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">NSArray *names=@[@&quot;æ–°å»ºå‰§æƒ…&quot;,@&quot;å‘å¸ƒæ‹›å‹Ÿ&quot;,@&quot;æœä¸€æœ&quot;];</span><br><span class="line">NSArray *imgs=@[@&quot;sence_new&quot;,@&quot;recruit_new&quot;,@&quot;sence_search&quot;];</span><br><span class="line">NSMutableArray *items=[NSMutableArray array];</span><br><span class="line">__weak typeof(self) wkself=self;</span><br><span class="line">for(int i=0;i&lt;names.count;i++)&#123;</span><br><span class="line"></span><br><span class="line">    FCPopMenuItem *item=[FCPopMenuItem itemWithImage:[UIImage imageNamed:imgs[i]]</span><br><span class="line">    title:names[i]</span><br><span class="line">    titleColor:[UIColor whiteColor]</span><br><span class="line">    handler:^(FCPopMenuItem *sender) &#123;</span><br><span class="line"></span><br><span class="line">        [wkself listClickAction:sender];</span><br><span class="line">    &#125;];</span><br><span class="line">    [items addObject:item];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>FCPopMenu</p>
</blockquote>
<p>Create a popover menu like this</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_list=[FCPopMenu menuWithFrame:CGRectMake(kFCPopMenuWidth-143, 64, 138, 140) trangleHeight:10 tranglePosition:CGPointMake(112, 0) items:items];</span><br><span class="line">_list.mainColor=[UIColor colorWithRed:73/255.f green:73/255.f blue:73/255.f alpha:1.f];</span><br><span class="line">_list.rowHeight=43.5;</span><br><span class="line">_list.sperateColor=[UIColor colorWithRed:217/255.f green:217/255.f blue:217/255.f alpha:1.f];</span><br><span class="line">_list.seperateInsets=UIEdgeInsetsMake(0, 14, 0, 14);</span><br></pre></td></tr></table></figure>
<p>You may need a overlay view<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-(UIControl *)back&#123;</span><br><span class="line"></span><br><span class="line">    if(!_back)&#123;</span><br><span class="line"></span><br><span class="line">        _back=[[UIControl alloc] initWithFrame:self.view.bounds];</span><br><span class="line">        _back.backgroundColor=[UIColor clearColor];</span><br><span class="line">        [_back addTarget:self action:@selector(hideList:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    &#125;</span><br><span class="line">    return _back;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Troggle show/close menu</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-(void)addBtnClickAction:(UIBarButtonItem *)sender&#123;</span><br><span class="line"></span><br><span class="line">    sender.enabled=NO;</span><br><span class="line">    if(self.list.superview)&#123;</span><br><span class="line"></span><br><span class="line">        [self hideList:self.back];</span><br><span class="line">        sender.enabled=YES;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    [self.view addSubview:self.back];</span><br><span class="line">    [self.view addSubview:self.list];</span><br><span class="line">    self.list.alpha=0.0;</span><br><span class="line">    __weak typeof(self) wkself=self;</span><br><span class="line">    [self.list mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line"></span><br><span class="line">        make.right.equalTo(wkself.view).offset(-5);</span><br><span class="line">        make.top.equalTo(wkself.view).offset(64);</span><br><span class="line">        make.size.mas_equalTo(CGSizeMake(138, 140));</span><br><span class="line">    &#125;];</span><br><span class="line">    [UIView animateWithDuration:0.3 animations:^&#123;</span><br><span class="line"></span><br><span class="line">        wkself.list.alpha=1.0;</span><br><span class="line">    &#125;];</span><br><span class="line">    sender.enabled=YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Monitor click action</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-(void)listClickAction:(FCPopMenuItem *)sender&#123;</span><br><span class="line"></span><br><span class="line">    [self hideList:self.back];</span><br><span class="line">    NSString *title=[sender.title copy];</span><br><span class="line">    if([title isEqualToString:@&quot;æ–°å»ºå‰§æƒ…&quot;])&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;else if([title isEqualToString:@&quot;å‘å¸ƒæ‹›å‹Ÿ&quot;])&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;else&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    NSLog(@&quot;%@&quot;,sender.title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Hide<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-(void)hideList:(UIControl *)sender&#123;</span><br><span class="line"></span><br><span class="line">    [sender removeFromSuperview];</span><br><span class="line">    [self.list removeFromSuperview];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Source code on github clickï¼&gt; <a href="https://github.com/Insfgg99x/FCPopMenu" target="_blank" rel="external">here</a></p>
<blockquote>
<p>About Me </p>
</blockquote>
<ul>
<li>Blog:     <a href="http://cgpointzero.top">CGPointZeero</a></li>
<li>GitHub:   <a href="https://github.com/Insfgg99x" target="_blank" rel="external">Insfgg99x</a></li>
<li>Mooc:     <a href="http://www.imooc.com/u/3909164/articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Jianshu:  <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Email:    <a href="mailto:newbox0512@yahoo.com" target="_blank" rel="external">newbox0512@yahoo.com</a></li>
</ul>
<hr>
<p>@CGPoitZero</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[é…·ç‚«çš„æ–‡æœ¬è¾“å…¥æ¡†FGGTextField]]></title>
      <url>http://cgpointzero.top/2016/09/20/fggtextfield/</url>
      <content type="html"><![CDATA[<h2 id="FGGTextField"><a href="#FGGTextField" class="headerlink" title="#FGGTextField"></a>#FGGTextField</h2><p>##Introduction<br>ä¸€ä¸ªè¶…çº§é…·ç‚«çš„æ–‡æœ¬è¾“å…¥æ¡†ï¼Œç»§æ‰¿è‡ªUITextFieldï¼Œä¾èµ–äºAJWValidator.ç”¨äºå®ç°æ–‡æœ¬è¾“å…¥çš„å®æ—¶ç›‘æµ‹ã€‚<br><img src="/img/fggtextfield.gif" alt=""></p>
<p>##Installtion<br>Manual:</p>
<p>Download This Project and drag the FGGTextField folder into your peroject, do not forget to ensure â€œcopy item if needâ€ being selected.</p>
<p>Cocoapods:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;FGGTextField&apos;, &apos;~&gt; 1.0.0&apos;</span><br></pre></td></tr></table></figure></p>
<p>##Usage<br>Just import the header file:<code>import &quot;FGGTextField.h&quot;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">FGGTextField *tf=[[FGGTextField alloc]initWithFrame:CGRectMake(10, 100, kWidth-20, 40)];</span><br><span class="line">tf.placeholder=@&quot;è¯·è¾“å…¥é‚®ç®±&quot;;</span><br><span class="line">tf.errorText=@&quot;é‚®ç®±æ ¼å¼ä¸å¯¹&quot;;</span><br><span class="line">tf.validatorText=@&quot;é‚®ç®±&quot;;</span><br><span class="line">[self.view addSubview:tf];</span><br><span class="line">tf.borderStyle=UITextBorderStyleRoundedRect;</span><br><span class="line">tf.keyboardType=UIKeyboardTypeEmailAddress;</span><br><span class="line"></span><br><span class="line">AJWValidator *validator=[AJWValidator validatorWithType:AJWValidatorTypeString];</span><br><span class="line">[validator addValidationToEnsureValidEmailWithInvalidMessage:tf.errorText];</span><br><span class="line">Â [tf  ajw_attachValidator:validator];</span><br><span class="line">__weak typeof(validator) weak_validator=validator;</span><br><span class="line">validator.validatorStateChangedHandler=^(AJWValidatorState state)&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  switch (state) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  case AJWValidatorValidationStateValid:</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  tf.highlightState=FGGTextFieldHighlightStateValidator;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  leftView.text=@&quot;ğŸ˜&quot;;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â Â break;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â case AJWValidatorValidationStateInvalid:</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â Â  tf.highlightState=FGGTextFieldHighlightStateWrong;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â   Â  leftView.text=@&quot;ğŸ˜Ÿ&quot;;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â   break;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â default:</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â   break;</span><br><span class="line">Â  Â  Â  Â   &#125;</span><br><span class="line">Â  Â  Â  Â Â  if(weak_validator.isValid)&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â Â  NSLog(@&quot;æ ¼å¼æ­£ç¡®âœ…&quot;);</span><br><span class="line">Â  Â  Â  Â   &#125;</span><br><span class="line">Â  Â  Â &#125;;</span><br></pre></td></tr></table></figure>
<p>##Example</p>
<blockquote>
<p>1.åœ¨é¡¹ç›®ä¸­å¯¼å…¥ï¼šFGGTextField.h<br><br>2.åˆ›å»ºFGGTextFieldçš„å¯¹è±¡<br><br>FGGTextField *tf=[[FGGTextField alloc]initWithFrame:CGRectMake(50, 100, 200, 40)];<br><br>3.è®¾ç½®å±æ€§<br><br>tf.placeholder=@â€è¯·è¾“å…¥é‚®ç®±â€;<br><br>tf.errorText=@â€é‚®ç®±æ ¼å¼ä¸æ­£ç¡®â€;<br><br>tf.validatorText=@â€é‚®ç®±â€;<br><br><br><br>tf.borderStyle=UITextBorderStyleRoundedRect;<br><br>tf.keyboardType=UIKeyboardTypeEmailAddress;<br><br>4.æ·»åŠ åˆ°çˆ¶è§†å›¾<br>å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥ç»™æˆ‘å‘é‚®ä»¶ï¼šnewbox0512@yahoo.com<br></p>
</blockquote>
<p>##About Me</p>
<ul>
<li>Blog:     <a href="http://cgpointzero.top">CGPointZeero</a></li>
<li>GitHub:   <a href="https://github.com/Insfgg99x" target="_blank" rel="external">Insfgg99x</a></li>
<li>Mooc:     <a href="http://www.imooc.com/u/3909164/articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Jianshu:  <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Email:    <a href="mailto:newbox0512@yahoo.com" target="_blank" rel="external">newbox0512@yahoo.com</a></li>
</ul>
<p>I attached my code on github,touch to download:-&gt;<a href="https://github.com/Insfgg99x/FGGTextField" target="_blank" rel="external">FGGTextField</a></p>
<hr>
<p>@CGPoitZero</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Swift 3.0ä¸€ä¸ªæ–¹æ³•ä¸€è¡Œä»£ç å®ç°UITableViewå¤´éƒ¨è§†å›¾ç¼©æ”¾]]></title>
      <url>http://cgpointzero.top/2016/09/18/Swfit/fgtableheaderview/</url>
      <content type="html"><![CDATA[<h3 id="FGTableHeaderView"><a href="#FGTableHeaderView" class="headerlink" title="FGTableHeaderView"></a>FGTableHeaderView<br></h3><blockquote>
<p>ä¸€ä¸ªæ–¹æ³•å®ç°è¡¨å¤´éƒ¨è§†å›¾ç¼©æ”¾<br></p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-e438c54e2f087f84.gif?imageMogr2/auto-orient/strip" alt=""></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="###Introduction"></a>###Introduction</h2><p>ä¸€ä¸ªæ–¹æ³•å®ç°UITableViewçš„å¤´éƒ¨è§†å›¾ç¼©æ”¾</p>
<p>###Install:<br>Cocopods:</p>
<ul>
<li>OC<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;FGTableHeaderView&apos;, &apos;~&gt; 1.0&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Manual:<br>Download <a href="https://github.com/Insfgg99x/FGTableHeaderView.git" target="_blank" rel="external">FGTableHeaderView</a> and dragâ€FGTableHeaderViewâ€ folder  into projec.</p>
<ul>
<li>Swift<br>Download <a href="https://github.com/Insfgg99x/FGHeaderView.git" target="_blank" rel="external">FGTableHeaderView</a> and dragâ€FGHeaderViewâ€ folder  into projec.</li>
</ul>
<p>###Useage:</p>
<blockquote>
<p>OC</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[_tbView fg_setHeaderFrame:CGRectMake(0, 0, self.view.frame.size.width, 150) image:[UIImage imageNamed:@&quot;IMG_2174.jpg&quot;]];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Swift</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tbView.fg_setHeaderView(frame: CGRect(x: 0, y: 0, width: self.view.frame.size.width, height: 150), image: UIImage(named: &quot;IMG_2174.jpg&quot;))</span><br></pre></td></tr></table></figure>
<hr>
<p>##About Me</p>
<blockquote>
<p>Blog:     <a href="http://cgpointzero.top">CGPointZeero</a><br>GitHub:   <a href="https://github.com/Insfgg99x" target="_blank" rel="external">Insfgg99x</a><br>Mooc:     <a href="http://www.imooc.com/u/3909164/articles" target="_blank" rel="external">CGPointZero</a><br>Jianshu:  <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" rel="external">CGPointZero</a><br>Email:    <a href="mailto:newbox0512@yahoo.com" target="_blank" rel="external">newbox0512@yahoo.com</a></p>
</blockquote>
<p>I attached my code on github,touch to download:</p>
<blockquote>
<p>OCç‰ˆæœ¬GitHubåœ°å€:<a href="https://github.com/Insfgg99x/FGTableHeaderView" target="_blank" rel="external">FGTableHeaderView</a><br>Swiftç‰ˆæœ¬GitHubåœ°å€ï¼š<a href="https://github.com/Insfgg99x/FGHeaderView" target="_blank" rel="external">FGHeaderView</a></p>
</blockquote>
<hr>
<p>@CGPoitZero</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[FGWebImage:A Swift async load image framework for iOS]]></title>
      <url>http://cgpointzero.top/2016/09/13/Swfit/fgwebimage/</url>
      <content type="html"><![CDATA[<p>#<a href="https://github.com/Insfgg99x/FGWebImage" target="_blank" rel="external">FGWebImage</a></p>
<p>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦..</p>
<p>##Introduction<br>An Categoryension build in Swift 3.0 for UIImageView and A light-weight framework of  async loading image like SDWebImage.</p>
<p>##Installtion<br>Manual:</p>
<p>Download This Project and drag the <code>FGWebImage</code> folder into your peroject, do not forget to ensure â€œcopy item if needâ€ being selected.</p>
<p>##Usage</p>
<p>Aync load image example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let frm=CGRect.init(x: 20, y: 80, width: self.view.bounds.size.width-40, height:400)</span><br><span class="line">let imv=UIImageView.init(frame: frm)</span><br><span class="line">self.view?.addSubview(imv)</span><br><span class="line">let urlString=&quot;http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;</span><br><span class="line">imv.fg_setImageWithUrl(urlString: urlString, placeHolder: nil)</span><br></pre></td></tr></table></figure>
<p>##About Me</p>
<blockquote>
<p>Blog:     <a href="http://cgpointzero.top">CGPointZeero</a><br>GitHub:   <a href="https://github.com/Insfgg99x" target="_blank" rel="external">Insfgg99x</a><br>Mooc:     <a href="http://www.imooc.com/u/3909164/articles" target="_blank" rel="external">CGPointZero</a><br>Jianshu:  <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" rel="external">CGPointZero</a><br>Email:    <a href="mailto:newbox0512@yahoo.com" target="_blank" rel="external">newbox0512@yahoo.com</a></p>
</blockquote>
<p>I attached my code on github,touch to download:-&gt;<a href="https://github.com/Insfgg99x/FGWebImage" target="_blank" rel="external">FGWebImage</a><br>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦..<br>@CGPoitZero</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[FGNetwork:A light networking kit for iOS base on NSURLSession]]></title>
      <url>http://cgpointzero.top/2016/09/12/fgnetwork/</url>
      <content type="html"><![CDATA[<p>###<a href="https://github.com/Insfgg99x/FGNetwork" target="_blank" rel="external">FGNetwork</a><br>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦..</p>
<p>##Introduction<br> A light networking kit for iOS with GET ,POST,file upload and multi files uploading supported,base on <code>NSURLSession</code>.</p>
<p>##Installtion<br>Manual:</p>
<p>Download This Project and drag the FGNetwork folder into your peroject, do not forget to ensure â€œcopy item if needâ€ being selected.</p>
<p>##Usage<br>Just import the header file:<code>import &quot;FGNetwork.h&quot;</code></p>
<blockquote>
<p>Singleton</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">Â *Â  Singleton</span><br><span class="line">Â */</span><br><span class="line">+(instancetype)shared;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>GET:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">Â *Â  getè¯·æ±‚</span><br><span class="line">Â *Â  urlString Â  é“¾æ¥</span><br><span class="line">Â *Â  success Â  Â  æˆåŠŸçš„å›è°ƒ</span><br><span class="line">Â *Â  failure Â  Â  å¤±è´¥çš„å›è°ƒ</span><br><span class="line">Â */</span><br><span class="line">-(void)get:(NSString *)urlString success:(void (^) (NSData *data, NSURLResponse *response)) success failure:(void (^) (NSError *error))failure;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>POST:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">Â *Â  postè¯·æ±‚</span><br><span class="line">Â *Â  urlString Â  ä¸»åœ°å€</span><br><span class="line">Â *Â  paramatersÂ  å‚æ•°å­—å…¸</span><br><span class="line">Â *Â  success Â  Â  æˆåŠŸçš„å›è°ƒ</span><br><span class="line">Â *Â  failure Â  Â  å¤±è´¥çš„å›è°ƒ</span><br><span class="line">Â */</span><br><span class="line">-(void)post:(NSString *)urlString paramaters:(NSString *)paramaters success:(void (^) (NSData *data, NSURLResponse *response)) success failure:(void (^) (NSError *error))failure;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>And file upload supported:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">Â *Â  æ–‡ä»¶ä¸Šä¼ </span><br><span class="line">Â *Â  urlString Â  æœåŠ¡å™¨åœ°å€</span><br><span class="line">Â *Â  fileDataÂ  Â  æ–‡ä»¶äºŒè¿›åˆ¶æ•°æ®</span><br><span class="line">Â *Â  mimeTypeÂ  Â  MIME Type</span><br><span class="line">Â *Â  paramatersÂ  å‚æ•°å­—å…¸</span><br><span class="line">Â *Â  success Â  Â  æˆåŠŸçš„å›è°ƒ</span><br><span class="line">Â *Â  failure Â  Â  å¤±è´¥çš„å›è°ƒ</span><br><span class="line">Â */</span><br><span class="line">-(void)uploadFileToHost:(NSString *)urlString fileData:(NSData *)fileData name:(NSString *)name fileName:(NSString *)fileName mimeType:(NSString *)mimeType paramaters:(NSString *)paramaters success:(void (^) (NSData *data, NSURLResponse *response)) success failure:(void (^) (NSError *error))failure;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Multi files upload supported:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/**ä¸Šä¼ å¤šå¼ ç…§ç‰‡ï¼ˆ2å¼ ï¼‰fileåº”è¯¥å¯¹åº”å¤šä¸ªå˜é‡åå„’file0ï¼Œfile1*/</span><br><span class="line">-(void)uploadMultiFileToHost:(NSString *)urlString imgs:(NSArray *)imgs name:(NSString *)name mimeType:(NSString *)mimeType paramaters:(NSString *)paramaters success:(void (^)(NSData *data, NSURLResponse *response))success failure:(void (^)(NSError *error))failure;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>And  a optional function:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">Â *Â  å–æ¶ˆæ‰€æœ‰æ•°æ®è¯·æ±‚</span><br><span class="line">Â */</span><br><span class="line">-(void)cancelAllDataTask;</span><br></pre></td></tr></table></figure>
<p>##Example<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-(void)downloadData&#123;</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  [[FGNetwork shared] get:@&quot;http://www.baidu.com&quot; success:^(NSData *data, NSURLResponse *response) &#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  NSString *str=[[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];</span><br><span class="line">Â  Â  Â  Â  NSLog(@&quot;%@&quot;,str);</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  &#125; failure:^(NSError *error) &#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##About Me</p>
<blockquote>
<p>Blog:     <a href="http://cgpointzero.top">CGPointZeero</a><br>GitHub:   <a href="https://github.com/Insfgg99x" target="_blank" rel="external">Insfgg99x</a><br>Mooc:     <a href="http://www.imooc.com/u/3909164/articles" target="_blank" rel="external">CGPointZero</a><br>Jianshu:  <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" rel="external">CGPointZero</a><br>Email:    <a href="mailto:newbox0512@yahoo.com" target="_blank" rel="external">newbox0512@yahoo.com</a></p>
</blockquote>
<p>I attached my code on github,touch to download -&gt;<a href="https://github.com/Insfgg99x/FGNetwork" target="_blank" rel="external">FGNetwork</a><br>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦..</p>
<p>@CGPoitZero<br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Swift 3.0 Automaticly convert Simplified and Traditional Chiniese]]></title>
      <url>http://cgpointzero.top/2016/09/12/Swfit/swfit-converter/</url>
      <content type="html"><![CDATA[<p>#FGCoverter<br>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦..</p>
<p>##Introduction<br>A Category of String used for mutual converting between simplified Chinese and Traditional Chinese.The Swift Edition of <a href="https://github.com/Insfgg99x/FGReverser" target="_blank" rel="external">FGReverser</a></p>
<p>##Installtion<br>Manual:<br>Download This Project and drag the FGReverser folder into your peroject, do not forget to ensure â€œcopy item if needâ€ being selected.</p>
<p>##Usage</p>
<p>Simplfied Chinese to Traditional Chinese, or Traditional Chinese to Simplfied Chinese, Use:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pulic func reverseString()-&gt;String</span><br></pre></td></tr></table></figure></p>
<p>##Example<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Â .................................</span><br><span class="line">Â let string=&quot;æ­å–œå‘è´¢&quot;</span><br><span class="line">Â let result=string.reverseString()</span><br><span class="line">Â print(result)</span><br><span class="line">Â .................................</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>The result is <code>æ­å–œç™¼è²¡</code></p>
</blockquote>
<p>or<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Â .................................</span><br><span class="line">Â let string=&quot;æ­å–œç™¼è²¡&quot;</span><br><span class="line">Â let result=string.reverseString()</span><br><span class="line">Â print(result)</span><br><span class="line">Â .................................</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>The result is <code>æ­å–œå‘è´¢</code></p>
</blockquote>
<p>##About Me</p>
<ul>
<li>Blog:     <a href="http://cgpointzero.top">CGPointZeero</a></li>
<li>GitHub:   <a href="https://github.com/Insfgg99x" target="_blank" rel="external">Insfgg99x</a></li>
<li>Mooc:     <a href="http://www.imooc.com/u/3909164/articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Jianshu:  <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Email:    <a href="mailto:newbox0512@yahoo.com" target="_blank" rel="external">newbox0512@yahoo.com</a></li>
</ul>
<p>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦..</p>
<blockquote>
<p>End. </p>
</blockquote>
<p>Attached the address of my source code on GitHub <a href="https://github.com/Insfgg99x/FGGConverter" target="_blank" rel="external">FGGConverter</a> Hope your star, fork or pull request.</p>
<p>@CGPoitZero</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[iOSå¼€å‘ä¹‹ä¸€ä¸ªæ–¹æ³•å®ç°ä»»æ„å†…å®¹ç¹ç®€äº’è½¬(éæœ¬åœ°åŒ–)]]></title>
      <url>http://cgpointzero.top/2016/09/11/FGRevser/</url>
      <content type="html"><![CDATA[<p>##æ‘˜è¦<br>æœ¬æ–‡å°†ä»‹ç»æˆ‘è‡ªå·±å°è£…çš„ä¸€ä¸ªä»»æ„å†…å®¹ç¹ç®€æ¢è½¬çš„å®ç°æ€è·¯ã€‚</p>
<p>##FGReverser<br>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦..</p>
<p>##Introduction<br>A Category of NSString used for mutual converting between simplified Chinese and Traditional Chinese.</p>
<p>##Installtion<br>Manual:</p>
<p>Download This Project and drag the FGReverser folder into your peroject, do not forget to ensure â€œcopy item if needâ€ being selected.</p>
<p>Cocoapods:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;FGReverser&apos;, &apos;~&gt; 1.0.0&apos;</span><br></pre></td></tr></table></figure></p>
<p>##Usage<br>Just import the header file:<code>import &quot;NSString+FGReverser.h&quot;</code></p>
<p>Simplfied Chinese to Traditional Chinese, or Traditional Chinese to Simplfied Chinese, Use:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(NSString *)reverseString;</span><br></pre></td></tr></table></figure></p>
<p>##Example<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSString *sourceString=@&quot;æ­å–œå‘è´¢&quot;;</span><br><span class="line">NSString *reslutString=[sourceString reverseString];</span><br><span class="line">NSLog(@&quot;%@&quot;,reslutString);</span><br></pre></td></tr></table></figure></p>
<p>The result is <code>æ­å–œç™¼è²¡</code></p>
<p>##About Me</p>
<ul>
<li>Blog:     <a href="http://cgpointzero.top">CGPointZeero</a></li>
<li>GitHub:   <a href="https://github.com/Insfgg99x" target="_blank" rel="external">Insfgg99x</a></li>
<li>Mooc:     <a href="http://www.imooc.com/u/3909164/articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Jianshu:  <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Email:    <a href="mailto:newbox0512@yahoo.com" target="_blank" rel="external">newbox0512@yahoo.com</a></li>
</ul>
<p>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦..</p>
<p>@CGPoitZero</p>
<p>##å®ç°æ€è·¯<br>ä¸Šé¢å†…å®¹æ˜¯è¯¥é¡¹ç›®çš„ç®€ä»‹ï¼Œè¯¥æ‹“å±•ä»…ç”¨äº†ä¸€ä¸ªæ–¹æ³•å°±å®ç°äº†ä»»æ„å†…å®¹ç¹ç®€ä½“äº’è½¬çš„åŠŸèƒ½ã€‚</p>
<p>1.æ”¶é›†ç®€ä½“å’Œç¹ä½“ç¼–ç çš„å­—ç¬¦é›†<br>2.æ•´ç†å‡ºæ¥ç¹ä½“å’Œç®€ä½“ä¸ä¸€æ ·çš„æ–‡å­—<br>3.åˆ†åˆ«å°†ç®€ä½“å’Œç¹ä½“ä¸ä¸€æ ·çš„å­—ä¸­æ‰€æœ‰çš„ç®€ä½“å­—å’Œç¹ä½“å­—åŠ è½½åˆ°ä¸¤ä¸ªä¸åŒçš„æ•°ç»„ä¸­ï¼Œå¹¶ä¸”ç¡®ä¿è¿™ä¸¤ä¸ªæ•°ç»„ä¸­çš„ç®€ä½“å’Œç¹ä½“ä¸€ä¸€å¯¹åº”(ç›¸åŒçš„index)<br>4.æä¸€ä¸ªå¯å˜å­—å…¸ï¼Œéå†ç®€ä½“å­—æ•°ç»„ï¼Œä»¥ç®€ä½“å­—ä¸ºé”®ï¼Œä»¥ç¹ä½“å­—ä¸ºå€¼ï¼Œä»¥key-valueçš„å½¢å¼æ”¾å…¥å­—å…¸ä¸­ï¼Œå¹¶ä¸”ä»¥ç¹ä½“å­—ä½œä¸ºé”®ï¼Œä»¥ç®€ä½“å­—ä½œä¸ºå€¼ï¼Œå†å­˜ä¸€éï¼Œå³<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for(long i=0i&lt;simplifiedArray.count; i++)&#123;</span><br><span class="line">NSString *key=[simplifiedArray objectAtIndex:i];</span><br><span class="line">NSString *value=[traditionalArray objectAtIndex:i];</span><br><span class="line">[dict setValue:value forKey:key];</span><br><span class="line">[dict setValue:key forKey:value];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.å°†ä¸Šä¸€æ­¥çš„å­—å…¸å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œæœ€å¥½æ˜¯å†™å…¥Macä¸Šä½ çŸ¥é“çš„ä¸€ä¸ªè·¯å¾„ï¼Œä½œä¸ºèµ„æºæ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘å­˜åˆ°äº†æ¡Œé¢ä¸Šï¼Œå«<code>reverse</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[dict writeToFile:filePath atomically:YES];</span><br></pre></td></tr></table></figure></p>
<p>##è¿›å…¥æ­£é¢˜<br>ä¸Šé¢çš„éƒ½æ˜¯å‡†å¤‡å·¥ä½œï¼Œä»£ç ä¸­ä¸éœ€è¦ç”¨åˆ°ï¼Œåªæ˜¯ä¸ºäº†å‡†å¤‡èµ„æºæ–‡ä»¶ã€‚</p>
<p>###æ€è·¯<br>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ç›´æ¥æäº†ä¸ªNSStringçš„åˆ†ç±»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ææˆä¸€ä¸ªå•åˆ—ç±»ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  Mutual converting</span><br><span class="line">*</span><br><span class="line">*/</span><br><span class="line">@interface NSString (FGReverser)</span><br></pre></td></tr></table></figure></p>
<p>åŠ è½½ä¸Šä¸€æ­¥çš„èµ„æºæ–‡ä»¶åˆ°ä¸€ä¸ªå­—å…¸ä¸­ï¼Œä¸ºä¸‹é¢çš„è½¬åŒ–åšå‡†å¤‡ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSString *mapPath=[[NSBundle mainBundle] pathForResource:@&quot;reverse&quot; ofType:nil];</span><br><span class="line">NSDictionary *map=[NSDictionary dictionaryWithContentsOfFile:mapPath];</span><br></pre></td></tr></table></figure></p>
<p>æä¸€ä¸ªç¹ç®€äº’è½¬çš„æ¥å£ï¼Œåœ¨è¿™ä¸ªæ¥å£ä¸­ï¼Œå»éå†ç»™å®šçš„å­—ç¬¦ä¸²ï¼Œå–å‡ºæ¯ä¸ªå­—ç¬¦å¯¹åº”çš„åè½¬å­—ç¬¦<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  Mutual converting between Simplfied Chinese and traditional Chinese.</span><br><span class="line">*</span><br><span class="line">*  return the converted string</span><br><span class="line">*/</span><br><span class="line">-(NSString *)reverseString;</span><br></pre></td></tr></table></figure></p>
<p>##äº’è½¬é€»è¾‘<br>å¾ˆç®€å•ï¼ŒæŠŠè¦è½¬åŒ–çš„å­—ç¬¦ä¸²ï¼Œé€ä¸ªå–å‡ºæ¥(unicharå‹çš„ï¼Œç”¨æ ¼å¼è¯´æ˜ç¬¦å·<code>%C</code>è½¬æˆNSString)ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unichar c=[resultString characterAtIndex:i];</span><br><span class="line">NSString *key=[NSString stringWithFormat:@&quot;%C&quot;,c];</span><br></pre></td></tr></table></figure></p>
<p>ç„¶ååˆ°ä¸Šé¢åŠ è½½å¥½çš„mapä¸­æ£€æŸ¥æ˜¯å¦å­˜åœ¨åè½¬å€¼ã€‚è‹¥å­˜åœ¨åè½¬å€¼ï¼Œåˆ™ç”¨åè½¬å€¼å­—ç¬¦æ›¿æ¢æ—§å€¼å­—ç¬¦ï¼Œæœ€åå°†å¤„ç†å¥½çš„å­—ç¬¦ä¸²è¿”å›ï¼Œå°±å®ç°äº†ç¹ç®€äº’è½¬ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  Mutual converting between Simplfied Chinese and traditional Chinese.</span><br><span class="line">*</span><br><span class="line">*  return the converted string</span><br><span class="line">*/</span><br><span class="line">-(NSString *)reverseString&#123;</span><br><span class="line"></span><br><span class="line">NSString *mapPath=[[NSBundle mainBundle] pathForResource:@&quot;reverse&quot; ofType:nil];</span><br><span class="line">NSDictionary *map=[NSDictionary dictionaryWithContentsOfFile:mapPath];</span><br><span class="line">NSMutableString *resultString=[NSMutableString stringWithString:[self copy]];</span><br><span class="line"></span><br><span class="line">for (NSInteger i=0; i&lt;resultString.length; i++)&#123;</span><br><span class="line"></span><br><span class="line">unichar c=[resultString characterAtIndex:i];</span><br><span class="line">NSString *key=[NSString stringWithFormat:@&quot;%C&quot;,c];</span><br><span class="line">NSString *value=[map objectForKey:key];</span><br><span class="line">if(value)&#123;</span><br><span class="line"></span><br><span class="line">[resultString deleteCharactersInRange:NSMakeRange(i, 1)];</span><br><span class="line">[resultString insertString:value atIndex:i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return resultString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è‡³æ­¤å·²å®ç°å…¨éƒ¨åŠŸèƒ½ã€‚<br>æœ€åé™„ä¸Šæˆ‘åœ¨<code>Github</code>ä¸Šçš„ä»£ç åœ°å€ï¼š<a href="https://github.com/Insfgg99x/FGReverser" target="_blank" rel="external">FGReverser</a>ï¼Œæ¬¢è¿pull requestå’Œstar~ï¼Œå¸Œæœ›å¤šæ”¯æŒã€‚<br>åŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥ä»<code>Cocoapods</code>ä¸‹è½½åˆ°ï¼š<a href="https://cocoapods.org/pods/FGReverser" target="_blank" rel="external">FGGReverser</a>ï¼Œä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;FGReverser&apos;, &apos;~&gt;1.0.0&apos;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘çš„åšå®¢åœ°å€ï¼š<a href="http://cgpointzero.top">CGPointZero</a>ï¼Œæ¬¢è¿è®¿é—®æ”¶è—ï¼Œä¸€èµ·æ¢è®¨ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Swift 3.0 One function to implementation auto scroll ad. view]]></title>
      <url>http://cgpointzero.top/2016/09/11/Swfit/swift-auto-scroll/</url>
      <content type="html"><![CDATA[<p>###Abstract</p>
<blockquote>
<p>How to automatic scroll<br>New features in Swift 3.0<br>How to Async load image with memery and disk cache policy like <code>SDWebImage</code>.</p>
</blockquote>
<p>###Introduction<br>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦.<br>A class with ad. pics auotmatic scrolling build in swift with image cache policy used.<br><img src="http://upload-images.jianshu.io/upload_images/937405-24ff5553ed3b31ae.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>###Installtion<br>Manual:</p>
<p>Download This Project and drag the <code>FGSwiftAutoScrollView</code> folder into your peroject, do not forget to ensure â€œcopy item if needâ€ being selected.</p>
<p>###Usage</p>
<ul>
<li><p>Load Web Imagesï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Â  Â  //MARK:-</span><br><span class="line">Â  Â  //MARK:automatic scrollView with web images</span><br><span class="line">Â  Â  convenience init(frame:CGRect, placeHolder placeHolderImage:UIImage?,remoteImageUrls imgs:Array&lt;String&gt;?, selectImageAction imageDidSelectedAction:@escaping FGImageClickBlock)&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  self.init(frame: frame)</span><br><span class="line">Â  Â  Â  Â  self.createLoacalCacheFolder()</span><br><span class="line">Â  Â  Â  Â  self.placeHolderImage=placeHolderImage</span><br><span class="line">Â  Â  Â  Â  self.didSelectedImageAction=imageDidSelectedAction</span><br><span class="line">Â  Â  Â  Â  self.imageUrlArray=imgs</span><br><span class="line">Â  Â  Â  Â  DispatchQueue.main.async &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.createScrollView()</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Load Local Imagesï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Â  Â  //MARK:automatic scrollView with local images</span><br><span class="line">Â  Â  convenience init(frame:CGRect,placeHolder placeHolderImage:UIImage?,localImageNames imgs:Array&lt;String&gt;?, selectImageAction imageDidSelectedAction:@escaping FGImageClickBlock)&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  self.init(frame: frame)</span><br><span class="line">Â  Â  Â  Â  self.placeHolderImage=placeHolderImage</span><br><span class="line">Â  Â  Â  Â  var fileUrlsArray:Array&lt;String&gt;=[]</span><br><span class="line">Â  Â  Â  Â  for name in imgs!&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  var path:String?</span><br><span class="line">Â  Â  Â  Â  Â  Â  if name.hasSuffix(&quot;jpg&quot;)||name.hasSuffix(&quot;png&quot;)&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  path=Bundle.main.path(forResource: name, ofType: nil)</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  else&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  path=Bundle.main.path(forResource: name, ofType: &quot;png&quot;)</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  if path==nil&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  path=&quot;&quot;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  path=path?.addingPercentEncoding(withAllowedCharacters: .urlPathAllowed)</span><br><span class="line">Â  Â  Â  Â  Â  Â  let fullPath=String.init(format: &quot;file://%@&quot;, path!)</span><br><span class="line">Â  Â  Â  Â  Â  Â  fileUrlsArray.append(fullPath)</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  self.didSelectedImageAction=imageDidSelectedAction</span><br><span class="line">Â  Â  Â  Â  self.imageUrlArray=fileUrlsArray</span><br><span class="line">Â  Â  Â  Â  self.createScrollView()</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>you can simply use the srcoll call back block if need (not necessary)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">self.banner?.imageDidScrolledBlock=&#123; (currentIndex) in</span><br><span class="line"></span><br><span class="line">Â  Â  print(&quot;æ»šåˆ°åˆ°äº†ç¬¬&quot;+String(currentIndex)+&quot;é¡µäº†&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>###Explainï¼š<br>If you donâ€™t need add image tap action, property didSelectedImageAction  block can be nil.</p>
<p>###How to implementation</p>
<blockquote>
<p>Create a class:<code>FGSwiftAutoScrollView.swift</code> and confirm to the UIScrollViewDelegate</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class FGSwiftAutoScrollView: UIView,UIScrollViewDelegate&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Add some properties</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">//auto scroll interval</span><br><span class="line">Â  Â  let fg_scrollInterval=3.0</span><br><span class="line">Â  Â  //disk cache path</span><br><span class="line">Â  Â  let fg_cachePath=NSSearchPathForDirectoriesInDomains(.libraryDirectory, .userDomainMask, true).last!+&quot;/FGGAutomaticScrollViewCache&quot;</span><br><span class="line">Â  Â  //memery cache</span><br><span class="line">Â  Â  let fg_imageCache=NSCache&lt;AnyObject,AnyObject&gt;()</span><br><span class="line">Â  Â  //maximun disk chache cycle</span><br><span class="line">Â  Â  let fg_maxCacheCycle=TimeInterval(7*24*3600)</span><br><span class="line">Â  Â  // tap image call action call back</span><br><span class="line">Â  Â  private var didSelectedImageAction:FGImageClickBlock?</span><br><span class="line">Â  Â  //image did scrolled call back</span><br><span class="line">Â  Â  public varÂ  imageDidScrolledBlock:FGImageScrolledBlock?</span><br><span class="line">Â  Â  //data source</span><br><span class="line">Â  Â  public varÂ  imageUrlArray:Array&lt;String&gt;?&#123;</span><br><span class="line">Â  Â  Â  Â  //redifine setter</span><br><span class="line">Â  Â  Â  Â  didSet&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  //refresh UI on main queue</span><br><span class="line">Â  Â  Â  Â  Â  Â  DispatchQueue.main.async &#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  self.createScrollView()</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  //main scrollView</span><br><span class="line">Â  Â  private var scroll:UIScrollView?</span><br><span class="line">Â  Â  //to ensure automatic scroll</span><br><span class="line">Â  Â  private var timer:Timer!</span><br><span class="line">Â  Â  //page control to show current page index</span><br><span class="line">Â  Â  private var pageControl:UIPageControl!</span><br><span class="line">Â  Â  //placeHolder image</span><br><span class="line">Â  Â  var placeHolderImage:UIImage?</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Override initWithFrame:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">override init(frame:CGRect)&#123;</span><br><span class="line">Â  Â  Â  Â  super.init(frame:frame)</span><br><span class="line">Â  Â  Â  Â  self.createLoacalCacheFolder()</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Create an area for disk image cache</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//MARK:- create cache area</span><br><span class="line">Â  Â  //MARK:create a cache area to cache web images</span><br><span class="line">Â  Â  private func createLoacalCacheFolder()&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  if !FileManager.default.fileExists(atPath: fg_cachePath)&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  do&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  try FileManager.default.createDirectory(atPath: fg_cachePath, withIntermediateDirectories: true, attributes: nil)</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;catch&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Give two convenience functions</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//MARK:-Load Web Image</span><br><span class="line">Â  Â  //MARK:automatic scrollView with web images</span><br><span class="line">Â  Â  convenience init(frame:CGRect, placeHolder placeHolderImage:UIImage?,remoteImageUrls imgs:Array&lt;String&gt;?, selectImageAction imageDidSelectedAction:@escaping FGImageClickBlock)&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  self.init(frame: frame)</span><br><span class="line">Â  Â  Â  Â  self.placeHolderImage=placeHolderImage</span><br><span class="line">Â  Â  Â  Â  self.didSelectedImageAction=imageDidSelectedAction</span><br><span class="line">Â  Â  Â  Â  self.imageUrlArray=imgs</span><br><span class="line">Â  Â  Â  Â  DispatchQueue.main.async &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.createScrollView()</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//MARK:Load Local Image</span><br><span class="line">Â  Â  //MARK:automatic scrollView with local images</span><br><span class="line">Â  Â  convenience init(frame:CGRect,placeHolder placeHolderImage:UIImage?,localImageNames imgs:Array&lt;String&gt;?, selectImageAction imageDidSelectedAction:@escaping FGImageClickBlock)&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  self.init(frame: frame)</span><br><span class="line">Â  Â  Â  Â  self.placeHolderImage=placeHolderImage</span><br><span class="line">Â  Â  Â  Â  var fileUrlsArray:Array&lt;String&gt;=[]</span><br><span class="line">Â  Â  Â  Â  for name in imgs!&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  var path:String?</span><br><span class="line">Â  Â  Â  Â  Â  Â  if name.hasSuffix(&quot;jpg&quot;)||name.hasSuffix(&quot;png&quot;)&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  path=Bundle.main.path(forResource: name, ofType: nil)</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  else&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  path=Bundle.main.path(forResource: name, ofType: &quot;png&quot;)</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  if path==nil&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  path=&quot;&quot;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  path=path?.addingPercentEncoding(withAllowedCharacters: .urlPathAllowed)</span><br><span class="line">Â  Â  Â  Â  Â  Â  let fullPath=String.init(format: &quot;file://%@&quot;, path!)</span><br><span class="line">Â  Â  Â  Â  Â  Â  fileUrlsArray.append(fullPath)</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  self.didSelectedImageAction=imageDidSelectedAction</span><br><span class="line">Â  Â  Â  Â  self.imageUrlArray=fileUrlsArray</span><br><span class="line">Â  Â  Â  Â  self.createScrollView()</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Create main scroll view</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">//MARK:-</span><br><span class="line">Â  Â  //MARK:create scroll view</span><br><span class="line">Â  Â  private func createScrollView()&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  if self.scroll != nil&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  for sub in self.subviews &#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  sub.removeFromSuperview()</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.scroll?.removeFromSuperview()</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.scroll=nil</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  self.scroll=UIScrollView.init(frame: self.bounds)</span><br><span class="line">Â  Â  Â  Â  self.addSubview(self.scroll!)</span><br><span class="line">Â  Â  Â  Â  self.scroll?.delegate=self</span><br><span class="line">Â  Â  Â  Â  var count:Int?;</span><br><span class="line">Â  Â  Â  Â  if self.imageUrlArray==nil&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  count=0</span><br><span class="line">Â  Â  Â  Â  &#125;else&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  count=self.imageUrlArray?.count</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  let width:CGFloat=CGFloat((count!+1))*self.bounds.size.width;</span><br><span class="line">Â  Â  Â  Â  let height:CGFloat=self.bounds.size.height;</span><br><span class="line">Â  Â  Â  Â  self.scroll?.contentSize=CGSize.init(width: width, height: height)</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  self.scroll?.isPagingEnabled=true</span><br><span class="line">Â  Â  Â  Â  self.scroll?.showsHorizontalScrollIndicator=false</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  if self.timer != nil&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  self.timer.invalidate()</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.timer=nil</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  //detach the timer</span><br><span class="line">Â  Â  Â  Â  self.timer=Timer.scheduledTimer(withTimeInterval: fg_scrollInterval, repeats: true, block: &#123; (t) in</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  if self.imageUrlArray?.count==0&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  return</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  var index=Int((self.scroll?.contentOffset.x)!/self.bounds.size.width);</span><br><span class="line">Â  Â  Â  Â  Â  Â  index+=1</span><br><span class="line">Â  Â  Â  Â  Â  Â  if index==self.imageUrlArray?.count&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  index=0</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  if self.imageDidScrolledBlock != nil&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  self.imageDidScrolledBlock?(UInt(index))</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.pageControl.currentPage=index</span><br><span class="line">Â  Â  Â  Â  Â  Â  UIView.animate(withDuration: 0.2, animations: &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  self.scroll?.contentOffset=CGPoint.init(x: self.bounds.size.width*CGFloat(index), y: 0)</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;)</span><br><span class="line">Â  Â  Â  Â  &#125;)</span><br><span class="line">Â  Â  Â  Â  if count!&gt;0&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  for i in 0...count!&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  let xpos=CGFloat(i)*self.bounds.size.width</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  let frm=CGRect.init(x: xpos, y: 0, width: self.bounds.size.width, height: self.bounds.size.height)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  let imv=UIImageView.init(frame: frm)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  imv.image=self.placeHolderImage</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  imv.isUserInteractionEnabled=true</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  let tap:UITapGestureRecognizer=UITapGestureRecognizer.init(target: self, action:#selector(FGSwiftAutoScrollView.tapImage))</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  imv.addGestureRecognizer(tap)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  self.scroll?.addSubview(imv)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  var urlString:String?</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  if i&lt;count!&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urlString=self.imageUrlArray?[i]</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;else&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urlString=imageUrlArray?.first</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  self.fg_setImageWithUrlString(imageView: imv,</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urlString: urlString,</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeHolder:self.placeHolderImage)</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  if self.pageControl != nil&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.pageControl.removeFromSuperview()</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.pageControl=nil</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  let pageControlFrame=CGRect.init(x: 0, y: 0, width: 200, height: 17)</span><br><span class="line">Â  Â  Â  Â  self.pageControl=UIPageControl.init(frame: pageControlFrame)</span><br><span class="line">Â  Â  Â  Â  self.pageControl.center=CGPoint.init(x: self.bounds.size.width/2, y: self.bounds.size.height-10)</span><br><span class="line">Â  Â  Â  Â  self.pageControl.numberOfPages=count!</span><br><span class="line">Â  Â  Â  Â  self.pageControl.pageIndicatorTintColor=UIColor.init(red: 225.0/255.0, green: 225.0/255.0, blue: 225.0/255.0, alpha: 1.0)</span><br><span class="line">Â  Â  Â  Â  self.pageControl.currentPageIndicatorTintColor=UIColor.orange</span><br><span class="line">Â  Â  Â  Â  self.addSubview(self.pageControl)</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Impletatin of sroll view delegate</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//MARK:-</span><br><span class="line">Â  Â  //MARK:UIScrollView Delegate</span><br><span class="line">Â  Â  func scrollViewDidEndDecelerating(_ scrollView: UIScrollView) &#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  var index=Int((self.scroll?.contentOffset.x)!/self.bounds.size.width);</span><br><span class="line">Â  Â  Â  Â  if index==self.imageUrlArray?.count&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  index=0;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  if self.imageDidScrolledBlock != nil&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  self.imageDidScrolledBlock?(UInt(index))</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  self.pageControl.currentPage=index</span><br><span class="line">Â  Â  Â  Â  self.scroll?.contentOffset=CGPoint.init(x: self.bounds.size.width*CGFloat(index), y: 0)</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Implementation of tap image action</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//MARK:-</span><br><span class="line">Â  Â  //MARK: Tag Image Action</span><br><span class="line">Â  Â  func tapImage()&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  if self.didSelectedImageAction != nil&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  self.didSelectedImageAction?(UInt(self.pageControl.currentPage));</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Destroy the timer in deinit</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">deinit&#123;</span><br><span class="line">Â  Â  Â  Â  if self.timer != nil&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.timer .invalidate()</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.timer=nil</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Write an extension to async download image like <code>SDWebImage</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">extension FGSwiftAutoScrollView&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Async image loading like <code>SDWebImage</code> with cache in memery an disk</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">Â  Â  func fg_setImageWithUrlString(imageView:UIImageView?,urlString:String?,placeHolder:UIImage?)&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  if imageView==nil&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  return</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  imageView?.image=placeHolder</span><br><span class="line">Â  Â  Â  Â  if urlString==nil&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  return</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  var cachePath=fg_cachePath+&quot;/&quot;+String(describing: urlString?.hash)</span><br><span class="line">Â  Â  Â  Â  if (urlString?.hasPrefix(&quot;file://&quot;))!&#123;//local path</span><br><span class="line">Â  Â  Â  Â  Â  Â  cachePath=urlString!</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  //check the memery chache exist or not(both local and web images)</span><br><span class="line">Â  Â  Â  Â  var data=fg_imageCache.object(forKey: cachePath as AnyObject)</span><br><span class="line">Â  Â  Â  Â  if (data != nil) &#123;//exist in memery cache</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  DispatchQueue.main.async&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  imageView?.image=UIImage(data: data as! Data)</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;else&#123;//not in memery cache,check if exist in disk or not</span><br><span class="line">Â  Â  Â  Â  Â  Â  //local images</span><br><span class="line">Â  Â  Â  Â  Â  Â  if (urlString?.hasPrefix(&quot;file://&quot;))!&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  let url:NSURL=NSURL.init(string: urlString!)!</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  do&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try data=Data.init(contentsOf: url as URL) as AnyObject?</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;catch&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  //if local image exist</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  if data != nil&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fg_imageCache.setObject(data as AnyObject, forKey: cachePath as AnyObject)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DispatchQueue.main.async&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageView?.image=UIImage(data: data as! Data)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  else&#123;//local image is not exist,just ingnore</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //ingnore</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  //web images</span><br><span class="line">Â  Â  Â  Â  Â  Â  else&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  //check if exist in disk</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  let exist=FileManager.default.fileExists(atPath: cachePath)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  if exist &#123;//exist in disk</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //check if expired</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var attributes:Dictionary&lt;FileAttributeKey,Any&gt;?</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  do&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try attributes=FileManager.default.attributesOfItem(atPath: cachePath)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;catch&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let createDate:Date?=attributes?[FileAttributeKey.creationDate] as! Date?</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let interval:TimeInterval?=Date.init().timeIntervalSince(createDate!)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let expired=(interval! &gt; fg_maxCacheCycle)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if expired&#123;//expired</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //download image</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.donwloadDataAndRefreshImageView(imageView: imageView, urlString: urlString, cachePath: cachePath)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else&#123;//not expired</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //load from disk</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let url:NSURL=NSURL.init(string: urlString!)!</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  do&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try data=Data.init(contentsOf: url as URL) as AnyObject?</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;catch&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if data != nil&#123;//if has data</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //cached in memery</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fg_imageCache.setObject(data as AnyObject, forKey: cachePath as AnyObject)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DispatchQueue.main.async&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageView?.image=UIImage(data: data as! Data)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else&#123;//has not data</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //remove item from disk</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let url:NSURL=NSURL.init(string: urlString!)!</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  do&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try data=Data.init(contentsOf: url as URL) as AnyObject?</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;catch&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //donwload agin</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.donwloadDataAndRefreshImageView(imageView: imageView, urlString: urlString, cachePath: cachePath)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //not exist in disk</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  else&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //download image</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.donwloadDataAndRefreshImageView(imageView: imageView, urlString: urlString, cachePath: cachePath)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Donwload Image Task</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//async download image</span><br><span class="line">Â  Â  private func donwloadDataAndRefreshImageView(imageView:UIImageView?,urlString:String?,cachePath:String!)&#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  do&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  try FileManager.default.removeItem(atPath: cachePath)</span><br><span class="line">Â  Â  Â  Â  &#125;catch&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  //download data</span><br><span class="line">Â  Â  Â  Â  let url=URL.init(string: urlString!)</span><br><span class="line">Â  Â  Â  Â  let session=URLSession.shared.dataTask(with: url!, completionHandler: &#123; (resultData, res, err) in</span><br><span class="line">Â  Â  Â  Â  Â  Â  let fileUrl=URL.init(fileURLWithPath: cachePath)</span><br><span class="line">Â  Â  Â  Â  Â  Â  do&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  try resultData?.write(to: fileUrl, options:.atomic)</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;catch&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  self.fg_imageCache.setObject(resultData as AnyObject, forKey: cachePath as AnyObject)</span><br><span class="line">Â  Â  Â  Â  Â  Â  if resultData != nil&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  DispatchQueue.main.async&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageView?.image=UIImage(data: resultData!)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  else&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  //ingnore</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;)</span><br><span class="line">Â  Â  Â  Â  session.resume()</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>End. Attached the address of my source code on GitHub</p>
</blockquote>
<p><a href="https://github.com/Insfgg99x/FGSwiftAutoScrollView" target="_blank" rel="external">FGSwiftAutoScrollView</a> Hope your star, fork or pull request.</p>
<p>###Support Me</p>
<ul>
<li>Blog:     <a href="http://cgpointzero.top">CGPointZeero</a></li>
<li>GitHub:   <a href="https://github.com/Insfgg99x" target="_blank" rel="external">Insfgg99x</a></li>
<li>Mooc:     <a href="http://www.imooc.com/u/3909164/articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Jianshu:  <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" rel="external">CGPointZero</a></li>
<li>Email:    <a href="mailto:newbox0512@yahoo.com" target="_blank" rel="external">newbox0512@yahoo.com</a></li>
</ul>
<p>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</p>
<p>Copyright (c) 2016 CGPointZero. All rights reserved.<br><br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[iOSå¼€å‘ä¹‹åªç”¨ä¸€ä¸ªæ–¹æ³•å®ç°å›¾ç‰‡çš„è½®æ’­]]></title>
      <url>http://cgpointzero.top/2016/09/07/banner/</url>
      <content type="html"><![CDATA[<p>##æ‘˜è¦<br>æœ¬æ–‡è¯¦ç»†çš„è®²è¿°äº†å¦‚ä½•å°è£…ä¸€ä¸ªåªç”¨ä¸€ä¸ªæ–¹æ³•å°±å®ç°è‡ªåŠ¨å¾ªç¯è½®æ’­çš„å¹¿å‘Šè§†å›¾ï¼Œä¾èµ–äºSDWebImageã€‚</p>
<p>###æ•ˆæœå›¾<br><img src="http://upload-images.jianshu.io/upload_images/937405-a37caa1ed0f1cefd.gif?imageMogr2/auto-orient/strip" alt=""></p>
<h3 id="FGGAutomaticScrollViewç®€ä»‹ï¼š"><a href="#FGGAutomaticScrollViewç®€ä»‹ï¼š" class="headerlink" title="FGGAutomaticScrollViewç®€ä»‹ï¼š"></a>FGGAutomaticScrollViewç®€ä»‹ï¼š</h3><hr>
<p> åˆå§‹åŒ–æ–¹æ³•ï¼Œä¸¤ç§ï¼š</p>
<p>1.ä»ç½‘ç»œåŠ è½½å›¾ç‰‡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[FGGAutoScrollView alloc] initWithFrame:(CGRect)frame</span><br><span class="line">                               imageURLs:(NSArray *)URLArray</span><br><span class="line">                   imageDidSelectedBlock:(FGGImageClickBlock) didSelectedImageAtIndex];</span><br></pre></td></tr></table></figure></p>
<p>2.ä»æœ¬åœ°åŠ è½½å›¾ç‰‡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[FGGAutoScrollView alloc] initWithFrame:(CGRect)frame</span><br><span class="line">                         localImageNames:(NSArray *)imageNames </span><br><span class="line">                   imageDidSelectedBlock:(FGGImageClickBlock) didSelectedImageAtIndex;</span><br></pre></td></tr></table></figure></p>
<p> æç¤ºï¼š</p>
<h2 id="è‹¥ä¸éœ€è¦ä¸ºå›¾ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåˆå§‹åŒ–æ—¶ï¼Œç‚¹å‡»å›¾ç‰‡çš„å›è°ƒblockç½®ä¸ºnilå°±å¯ä»¥äº†ã€‚"><a href="#è‹¥ä¸éœ€è¦ä¸ºå›¾ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåˆå§‹åŒ–æ—¶ï¼Œç‚¹å‡»å›¾ç‰‡çš„å›è°ƒblockç½®ä¸ºnilå°±å¯ä»¥äº†ã€‚" class="headerlink" title=" è‹¥ä¸éœ€è¦ä¸ºå›¾ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåˆå§‹åŒ–æ—¶ï¼Œç‚¹å‡»å›¾ç‰‡çš„å›è°ƒblockç½®ä¸ºnilå°±å¯ä»¥äº†ã€‚"></a> è‹¥ä¸éœ€è¦ä¸ºå›¾ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåˆå§‹åŒ–æ—¶ï¼Œç‚¹å‡»å›¾ç‰‡çš„å›è°ƒblockç½®ä¸ºnilå°±å¯ä»¥äº†ã€‚</h2><p>###ä½¿ç”¨ç¤ºä¾‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">NSArray *array = @[@&quot;http://i.okaybuy.cn/images/multipic/new/201506/fe/fe6b322427edad3dd6c7916116a9a15b.jpg,</span><br><span class="line">&quot;@&quot;http://i.okaybuy.cn/images/multipic/new/201505/88/888d8cf6a769c401af2ced0140fa90f3.jpg&quot;,</span><br><span class="line">@&quot;http://i.okaybuy.cn/images/multipic/new/201506/53/532a6028830f9d7e39b5bce9e5e60e52.jpg&quot;];</span><br><span class="line"></span><br><span class="line">_bannerView=[[FGGAutoScrollView alloc]initWithFrame:CGRectMake(20, 100, self.view.frame.size.width-40, 200) placeHolderImage:nil imageURLs:array imageDidSelectedBlock:^(NSInteger selectedIndex) &#123;</span><br><span class="line">        switch (selectedIndex) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                NSLog(@&quot;ä½ é€‰æ‹©äº†ç¬¬%ldå¼ å›¾ç‰‡&quot;,selectedIndex);</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                NSLog(@&quot;ä½ é€‰æ‹©äº†ç¬¬%ldå¼ å›¾ç‰‡&quot;,selectedIndex);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                NSLog(@&quot;ä½ é€‰æ‹©äº†ç¬¬%ldå¼ å›¾ç‰‡&quot;,selectedIndex);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">[self.view addSubview:_bannerView];</span><br></pre></td></tr></table></figure></p>
<p>è‹¥ä½ æƒ³æ·»åŠ è‡ªåŠ¨æ»šåŠ¨çš„å›è°ƒäº‹ä»¶ï¼ˆå¯ä¸è®¾ç½®ï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_bannerView.imageDidScrolledBlock=^(NSInteger index)&#123;</span><br><span class="line">        NSLog(@&quot;æ»šåŠ¨åˆ°äº†ç¬¬%ldå¼ &quot;,index);</span><br><span class="line">    &#125;;</span><br><span class="line"> [self.view addSubview:_bannerView];</span><br></pre></td></tr></table></figure></p>
<p>è‹¥ä½ çš„å›¾ç‰‡æ˜¯ä»é“¾æ¥æ˜¯ä»ç½‘ä¸Šè·å–çš„ï¼Œä½ å¯ä»¥åœ¨è·å–å›¾ç‰‡çš„æ•°ç»„<code>imgsArray</code>åï¼Œè°ƒç”¨setæ–¹æ³•å³å¯æ›¿æ¢æ•°æ®æºï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨reloadè§†å›¾ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_bannerView.imageURLArray=imgsArray;</span><br></pre></td></tr></table></figure></p>
<p>##å®ç°ç»†èŠ‚<br>æä¸€ä¸ªè‡ªå®šä¹‰çš„è§†å›¾<code>`FGGAutoScrollView</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@interface FGGAutoScrollView : UIView&lt;UIScrollViewDelegate&gt;</span><br></pre></td></tr></table></figure></p>
<p>è®¾ç½®å¦‚ä¸‹å±æ€§ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**ç‚¹å‡»ç…§ç‰‡çš„å›è°ƒ*/</span><br><span class="line">@property(nonatomic,copy,readonly)FGGImageClickBlock    didSelectedImageAtIndex;</span><br><span class="line"></span><br><span class="line">@property(nonatomic,copy) FGGImageScrolledBlock         imageDidScrolledBlock;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *    å›¾ç‰‡çš„urlStringé“¾æ¥æ•°ç»„</span><br><span class="line"> *    </span><br><span class="line"> *    å¯ä»¥é€šè¿‡è°ƒç”¨å…¶setæ–¹æ³•ï¼Œæ¥é‡è½½æ•°æ®æºå’Œè§†å›¾</span><br><span class="line"> */</span><br><span class="line">@property(nonatomic,strong)NSArray                      *imageURLArray;</span><br></pre></td></tr></table></figure></p>
<p>æ»šåŠ¨æ—¶é—´é—´éš”ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  æ»šåŠ¨æ—¶é—´é—´éš” å¯ä»¥è‡ªå·±ä¿®æ”¹</span><br><span class="line"> */</span><br><span class="line">static double kFGGScrollInterval = 3.0f;</span><br></pre></td></tr></table></figure></p>
<p>åŠ è½½ç½‘ç»œå›¾ç‰‡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  åŠ è½½ç½‘ç»œå›¾ç‰‡æ»šåŠ¨</span><br><span class="line"> *</span><br><span class="line"> *  @param frame    frame</span><br><span class="line"> *  @param URLArray åŒ…å«å›¾ç‰‡URLå­—ç¬¦ä¸²çš„æ•°ç»„</span><br><span class="line"> *  @param didSelectedImageAtIndex ç‚¹å‡»å›¾ç‰‡æ—¶å›è°ƒçš„block</span><br><span class="line"> *</span><br><span class="line"> *  @return FGGAutoScrollViewå¯¹è±¡</span><br><span class="line"> */</span><br><span class="line">-(instancetype)initWithFrame:(CGRect)frame placeHolderImage:(UIImage *)placeHolderImage imageURLs:(NSArray *)URLArray imageDidSelectedBlock:(FGGImageClickBlock) didSelectedImageAtIndex;</span><br></pre></td></tr></table></figure></p>
<p>åŠ è½½æœ¬åœ°å›¾ç‰‡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  åŠ è½½æœ¬åœ°å›¾ç‰‡æ»šåŠ¨</span><br><span class="line"> *</span><br><span class="line"> *  @param frame      frame</span><br><span class="line"> *  @param imageNames æœ¬åœ°å›¾ç‰‡åå­—æ•°ç»„</span><br><span class="line"> *  @param didSelectedImageAtIndex ç‚¹å‡»å›¾ç‰‡æ—¶å›è°ƒçš„block</span><br><span class="line"> *</span><br><span class="line"> *  @return FGGAutoScrollViewå¯¹è±¡</span><br><span class="line"> */</span><br><span class="line">-(instancetype)initWithFrame:(CGRect)frame placeHolderImage:(UIImage *)placeHolderImage localImageNames:(NSArray *)imageNames imageDidSelectedBlock:(FGGImageClickBlock) didSelectedImageAtIndex;</span><br></pre></td></tr></table></figure></p>
<p>##å®ç° FGGAutoScrollView.m</p>
<p>åœ¨æ‹“å±•ä¸­æ·»åŠ ä¸€ä¸ªå±æ€§ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@interface FGGAutoScrollView()</span><br><span class="line">/**</span><br><span class="line"> *  æ»šåŠ¨è§†å›¾å¯¹è±¡ï¼ˆåªè¯»ï¼‰</span><br><span class="line"> */</span><br><span class="line">@property(nonatomic,strong,readonly)UIScrollView        *scroll;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>æ·»åŠ è®¡æ•°å™¨ï¼Œé»˜è®¤å›¾ç‰‡ç­‰æˆå‘˜å˜é‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@implementation FGGAutoScrollView&#123;</span><br><span class="line">    </span><br><span class="line">    //å®šæ—¶å™¨</span><br><span class="line">    NSTimer *_timer;</span><br><span class="line">    //é¡µç æ§åˆ¶å™¨</span><br><span class="line">    UIPageControl *_pageControl;</span><br><span class="line">    /**é»˜è®¤å›¾ç‰‡*/</span><br><span class="line">    UIImage *_placeHolderImage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åŠ è½½ç½‘ç»œå›¾ç‰‡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//åŠ è½½ç½‘ç»œå›¾ç‰‡çš„æ–¹æ³•</span><br><span class="line">-(instancetype)initWithFrame:(CGRect)frame placeHolderImage:(UIImage *)placeHolderImage imageURLs:(NSArray *)URLArray imageDidSelectedBlock:(FGGImageClickBlock)didSelectedImageAtIndex&#123;</span><br><span class="line">    </span><br><span class="line">    if(self=[super initWithFrame:frame])&#123;</span><br><span class="line">        </span><br><span class="line">        _placeHolderImage=placeHolderImage;</span><br><span class="line">        _imageURLArray=URLArray;</span><br><span class="line">        _didSelectedImageAtIndex=didSelectedImageAtIndex;</span><br><span class="line">        [self createScrollView];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åŠ è½½æœ¬åœ°å›¾ç‰‡:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//åŠ è½½æœ¬åœ°çš„å›¾ç‰‡çš„æ–¹æ³•</span><br><span class="line">-(instancetype)initWithFrame:(CGRect)frame placeHolderImage:(UIImage *)placeHolderImage localImageNames:(NSArray *)imageNames imageDidSelectedBlock:(FGGImageClickBlock)didSelectedImageAtIndex&#123;</span><br><span class="line">    </span><br><span class="line">    if(self=[super initWithFrame:frame])&#123;</span><br><span class="line">        </span><br><span class="line">        if(imageNames.count&gt;0)&#123;</span><br><span class="line">            </span><br><span class="line">            _placeHolderImage=placeHolderImage;</span><br><span class="line">            NSMutableArray *fullPathArray=[NSMutableArray array];</span><br><span class="line">            for(int i=0;i&lt;imageNames.count;i++)&#123;</span><br><span class="line">                </span><br><span class="line">                NSString *path;</span><br><span class="line">                NSString *name=imageNames[i];</span><br><span class="line">                if([name hasSuffix:@&quot;jpg&quot;][name hasSuffix:@&quot;png&quot;])</span><br><span class="line">                    path=[[NSBundle mainBundle] pathForResource:name ofType:nil];</span><br><span class="line">                else</span><br><span class="line">                    path=[[NSBundle mainBundle] pathForResource:name ofType:@&quot;png&quot;];</span><br><span class="line">                NSString *fullPath=[NSString stringWithFormat:@&quot;file://%@&quot;,[path stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]];</span><br><span class="line">                [fullPathArray addObject:fullPath];</span><br><span class="line">            &#125;</span><br><span class="line">            _imageURLArray=fullPathArray;</span><br><span class="line">            _didSelectedImageAtIndex=didSelectedImageAtIndex;</span><br><span class="line">            [self createScrollView];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åˆ›å»ºæ»šåŠ¨è§†å›¾ï¼Œæ·»åŠ ç‚¹å‡»æ‰‹åŠ¿ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">//æ„å»ºå¾ªç¯æ»šåŠ¨è§†å›¾</span><br><span class="line">-(void)createScrollView&#123;</span><br><span class="line">    </span><br><span class="line">    if(_scroll)&#123;</span><br><span class="line">        </span><br><span class="line">        for(UIView *sub in _scroll.subviews)</span><br><span class="line">            [sub removeFromSuperview];</span><br><span class="line">        [_scroll removeFromSuperview];</span><br><span class="line">        _scroll=nil;</span><br><span class="line">    &#125;</span><br><span class="line">    _scroll=[[UIScrollView alloc]initWithFrame:self.bounds];</span><br><span class="line">    [self addSubview:_scroll];</span><br><span class="line">    _scroll.delegate=self;</span><br><span class="line">    _scroll.contentSize=CGSizeMake((_imageURLArray.count+1)*self.bounds.size.width, self.bounds.size.height);</span><br><span class="line">    </span><br><span class="line">    _scroll.pagingEnabled=YES;</span><br><span class="line">    _scroll.showsHorizontalScrollIndicator=NO;</span><br><span class="line">    if(_timer)&#123;</span><br><span class="line">        </span><br><span class="line">        [_timer invalidate];</span><br><span class="line">        _timer=nil;</span><br><span class="line">    &#125;</span><br><span class="line">    _timer=[NSTimer scheduledTimerWithTimeInterval:kFGGScrollInterval</span><br><span class="line">                                            target:self</span><br><span class="line">                                          selector:@selector(automaticScroll)</span><br><span class="line">                                          userInfo:nil</span><br><span class="line">                                           repeats:YES];</span><br><span class="line">    for(int i=0;i&lt;=_imageURLArray.count;i++)&#123;</span><br><span class="line">        </span><br><span class="line">        CGFloat xpos=i*self.bounds.size.width;</span><br><span class="line">        UIImageView *imv=[[UIImageView alloc]initWithFrame:CGRectMake(xpos, 0, self.bounds.size.width, self.bounds.size.height)];</span><br><span class="line">        //è®¾ç½®ç°è‰²åº•</span><br><span class="line">        imv.image=_placeHolderImage;</span><br><span class="line">        imv.userInteractionEnabled=YES;</span><br><span class="line">        </span><br><span class="line">        //æ·»åŠ ç‚¹å‡»å›¾ç‰‡çš„æ‰‹åŠ¿</span><br><span class="line">        UITapGestureRecognizer *tap=[[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(tapImage)];</span><br><span class="line">        [imv addGestureRecognizer:tap];</span><br><span class="line">        [_scroll addSubview:imv];</span><br><span class="line">        NSString *urlString;</span><br><span class="line">        if(i&lt;_imageURLArray.count)</span><br><span class="line">            urlString=_imageURLArray[i];</span><br><span class="line">        else</span><br><span class="line">            urlString=_imageURLArray[0];</span><br><span class="line">        NSURL *url=[NSURL URLWithString:urlString];</span><br><span class="line">        [imv sd_setImageWithURL:url placeholderImage:_placeHolderImage];</span><br><span class="line">    &#125;</span><br><span class="line">    if(_pageControl)</span><br><span class="line">        _pageControl=nil;</span><br><span class="line">    _pageControl=[[UIPageControl alloc]init];</span><br><span class="line">    _pageControl.center=CGPointMake(self.bounds.size.width/2, self.bounds.size.height-10);</span><br><span class="line">    _pageControl.numberOfPages=_imageURLArray.count;</span><br><span class="line">    _pageControl.currentPage=0;</span><br><span class="line">    _pageControl.pageIndicatorTintColor=[UIColor whiteColor];</span><br><span class="line">    _pageControl.currentPageIndicatorTintColor=[UIColor orangeColor];</span><br><span class="line">    [self addSubview:_pageControl];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è‡ªåŠ¨æ»šåŠ¨çš„æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  è‡ªåŠ¨å¾ªç¯æ»šåŠ¨</span><br><span class="line"> */</span><br><span class="line">-(void)automaticScroll&#123;</span><br><span class="line">    </span><br><span class="line">    if(_imageURLArray.count&gt;0)&#123;</span><br><span class="line">        </span><br><span class="line">        NSInteger index=_scroll.contentOffset.x/self.bounds.size.width;</span><br><span class="line">        index++;</span><br><span class="line">        if(index==_imageURLArray.count)</span><br><span class="line">            index=0;</span><br><span class="line">        if(self.imageDidScrolledBlock)</span><br><span class="line">            self.imageDidScrolledBlock(index);</span><br><span class="line">        _pageControl.currentPage=index;</span><br><span class="line">        __weak typeof(self) weakSelf=self;</span><br><span class="line">        //æ·»åŠ æ»šåŠ¨åŠ¨ç”»</span><br><span class="line">        [UIView animateWithDuration:0.2 animations:^&#123;</span><br><span class="line">           weakSelf.scroll.contentOffset=CGPointMake(index*self.bounds.size.width, 0);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç‚¹å‡»å›¾ç‰‡çš„å›è°ƒï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//ç‚¹å‡»å›¾ç‰‡æ—¶å›è°ƒä»£ç å—</span><br><span class="line">-(void)tapImage&#123;</span><br><span class="line">    </span><br><span class="line">    if(self.didSelectedImageAtIndex)&#123;</span><br><span class="line">        </span><br><span class="line">        self.didSelectedImageAtIndex(_pageControl.currentPage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‡å†™æ•°æ®æºçš„setæ–¹æ³•ï¼Œä»¥é‡è½½è§†å›¾ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**å›¾ç‰‡æ•°ç»„çš„setteræ–¹æ³•*/</span><br><span class="line">-(void)setImageURLArray:(NSArray *)imageURLArray&#123;</span><br><span class="line">    </span><br><span class="line">    if(![imageURLArray isKindOfClass:[NSArray class]])</span><br><span class="line">        return;</span><br><span class="line">    _imageURLArray=imageURLArray;</span><br><span class="line">    if(_imageURLArray.count==0)</span><br><span class="line">        return;</span><br><span class="line">    [self createScrollView];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ»šåŠ¨çš„ä»£ç†æ–¹æ³•ï¼Œè‹¥è®¾ç½®äº†æ»šåŠ¨çš„å›è°ƒï¼Œåˆ™åœ¨è¿™ä¸ªæ–¹æ³•é‡Œå›è°ƒ<code>imageDidScrolledBlock</code>ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - UIScrollView</span><br><span class="line">-(void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView&#123;</span><br><span class="line">    </span><br><span class="line">    NSInteger index=_scroll.contentOffset.x/self.bounds.size.width;</span><br><span class="line">    if(index==_imageURLArray.count)</span><br><span class="line">        index=0;</span><br><span class="line">    if(self.imageDidScrolledBlock)</span><br><span class="line">        self.imageDidScrolledBlock(index);</span><br><span class="line">    _pageControl.currentPage=index;</span><br><span class="line">    _scroll.contentOffset=CGPointMake(self.bounds.size.width*index, 0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€ååœ¨dellocä¸­é”€æ¯è®¡æ—¶å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//é”€æ¯</span><br><span class="line">-(void)dealloc&#123;</span><br><span class="line">    </span><br><span class="line">    if(_timer)&#123;</span><br><span class="line">        </span><br><span class="line">        [_timer invalidate];</span><br><span class="line">        _timer=nil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€åé™„ä¸Šæˆ‘çš„GitHubä»£ç åœ°å€ï¼š<a href="https://github.com/Insfgg99x/FGGAutomaticScrollView" target="_blank" rel="external">FGGAutomaticScrollView</a>ï¼Œæ¬¢è¿pull requestå’Œstar ~<br>ä»¥åŠæˆ‘çš„ä¸ªäººåšå®¢ï¼š<a href="http://cgpointzero.top">CGPointZero</a>æ¬¢è¿è®¿é—®ï½<br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[2016å¹´æœ€æ–°ç‰ˆiOS Appå†…è´­ä¹°è¯¦ç»†æŒ‡å—]]></title>
      <url>http://cgpointzero.top/2016/09/07/in-app-purchase/</url>
      <content type="html"><![CDATA[<p>##æ‘˜è¦ï¼š</p>
<ul>
<li>æœ¬æ–‡è®²è¿°äº†å¦‚ä½•åˆ›å»ºAppå†…è´­ä¹°é¡¹ç›®ï¼Ÿ</li>
<li>å¦‚ä½•æ·»åŠ æ²™ç›’Appå†…è´­ä¹°æµ‹è¯•å¸å·ï¼Ÿ</li>
<li>å¦‚ä½•å°è£…ä¸€ä¸ªå†…è´­ä¹°çš„ç®¡ç†ç±»ï¼Ÿ</li>
<li>å¦‚ä½•åœ¨å®Œæˆä»˜æ¬¾ä¹‹åï¼Œä¿è¯æœ‰æ•ˆçš„æä¾›å¢å€¼æœåŠ¡ï¼Ÿ<br>###å¦‚ä½•åˆ›å»ºå†…è´­ä¹°é¡¹ç›®ï¼Ÿ<br>åˆ›å»ºå†…è´­ä¹°ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®Œæˆâ€œåè®®ã€ç¨åŠ¡å’Œé“¶è¡Œä¸šåŠ¡â€ã€‚æ‰“å¼€iTunes Connectï¼Œè¿›å…¥appï¼Œé€‰æ‹©â€åŠŸèƒ½â€-â€œAppå†…è´­ä¹°é¡¹ç›®â€ï¼Œç‚¹å‡»â€ï¼‹â€åˆ›å»ºä¸€ä¸ªå†…è´­ä¹°é¡¹ç›®</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-99d61a36a4c8d77e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>é€‰æ‹©æ‰€å±ç±»å‹ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/937405-19fa37f86b8d245e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>æŒ‰ç…§æç¤ºå¡«å†™åç§°ï¼Œå®šä»·ï¼Œäº§å“idï¼Œä»¥åŠæè¿°ä¿¡æ¯ï¼Œå†…è´­å•†å“åˆ—è¡¨æˆªå›¾ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/937405-2389e241e444ff5e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>éœ€è¦æ³¨æ„äº§å“idçš„è§„èŒƒï¼Œå®ƒå¿…é¡»ç”±ï¼š<code>&quot;bundle identifier&quot;+ç¼–å·</code>ç»„æˆ å¦‚<code>xxx01</code>ï¼Œå…¶ä¸­<code>xxx</code>è¡¨ç¤º<code>bundle identifier</code>ã€‚<br>æ¯ä¸ªå†…è´­é¡¹ç›®éœ€è¦æä¾›ä¸€ä¸ªå†…è´­ä¹°å•†å“åˆ—è¡¨æˆªå›¾ï¼Œå¦‚ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/937405-e36392c078eb248f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>åˆ›å»ºå®Œå†…è´­é¡¹ç›®ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ²™ç›’æµ‹è¯•å¸å·ã€‚</p>
<p>###å¦‚ä½•åˆ›å»ºæ²™ç›’æµ‹è¯•å¸å·ï¼Ÿ<br>è¿›å…¥â€œç”¨æˆ·å’ŒèŒèƒ½â€ï¼Œé€‰æ‹©â€œæ²™ç®±æµ‹è¯•æŠ€æœ¯å‘˜â€ï¼Œç‚¹å‡»â€œï¼‹â€æ·»åŠ ä¸€ä¸ªæµ‹è¯•å¸å·ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/937405-77bc12bf15c7406c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>æŒ‰ç…§æç¤ºï¼Œè¾“å…¥ä¿¡æ¯ï¼Œåˆ›å»ºæµ‹è¯•å¸å·ï¼Œç”¨äºå†…è´­ä¹°æµ‹è¯•ã€‚æ¥ä¸‹æ¥æ˜¯ä»£ç éƒ¨åˆ†ã€‚</p>
<p>###å¦‚ä½•å°è£…ä¸€ä¸ªå†…è´­ä¹°ç®¡ç†ç±»ï¼Ÿ<br>æ€è·¯</p>
<ul>
<li>è¿™ä¸ªç®¡ç†ç±»éœ€è¦æœ‰ä¸€ä¸ªæ”¯ä»˜çš„è°ƒèµ·æ¥å£ï¼Œè‡³å°‘è¦ä¸€ä¸ªäº§å“idå‚æ•°ï¼›</li>
<li>è‹¥æ˜¯éæ¶ˆè€—å‹å•†å“ï¼Œéœ€è¦æä¾›ä¸€ä¸ªæ¢å¤å·²è´­ä¹°å•†å“çš„æ¥å£ï¼›</li>
<li>è¦ä¿è¯å†…è´­ä»˜å®Œæ¬¾ä¹‹åï¼Œè¦å‘Šè¯‰æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ï¼Œæˆ‘ä¹°äº†ä»€ä¹ˆä¸œè¥¿ï¼Œè€Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åˆè¦è€ƒè™‘ï¼š<br>æä¸€ä¸ªç®¡ç†ç±»ï¼š<code>@interface FCInAppPurchaseManager : NSObject</code><br>æä¸ªå•ä¾‹ç±»æ–¹æ³•ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  å•ä¾‹ç±»</span><br><span class="line"> *</span><br><span class="line"> *  @return å•ä¾‹å¯¹è±¡</span><br><span class="line"> */</span><br><span class="line">+(instancetype)sharedManager;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æä¸€ä¸ªè´­ä¹°å•†å“çš„æ¥å£ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  è´­ä¹°å•†å“</span><br><span class="line"> *</span><br><span class="line"> *  @param identifier iTunes Connectå•†å“ID</span><br><span class="line"> *  @param tradeId    äº¤æ˜“idï¼ˆè‡ªå·±æœåŠ¡å™¨åˆ›å»ºè®¢å•çš„äº¤æ˜“idï¼‰</span><br><span class="line"> *  @param key        äº¤æ˜“æ ‡è¯†ï¼ˆè‡ªå·±æœåŠ¡å™¨ç”Ÿæˆçš„keyï¼Œé˜²æ²»æœæ’°äº¤æ˜“ï¼‰</span><br><span class="line"> */</span><br><span class="line">-(void)purchaseProductWithIdentifier:(NSString *)identifier tradeId:(NSString *)tradeId key:(NSString *)key;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨å•†å“åˆ—è¡¨ç•Œé¢è´­ä¹°å•†å“æ—¶ï¼Œè°ƒç”¨ä¸Šé¢è¿™ä¸ªæ¥å£ï¼Œä»è‡ªå·±æœåŠ¡å™¨åˆ›å»ºäº¤æ˜“ï¼Œè·å–äº¤æ˜“idå’Œkey<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath&#123;</span><br><span class="line">    //åˆ›å»ºäº¤æ˜“</span><br><span class="line">    FCInnserPurchaseProductModel *model=_dataArray[indexPath.row];</span><br><span class="line">    FCFamousUser *currentUser=[[FCAccountSettings getCurrentAccountSetting] getCurrentUser];</span><br><span class="line">    NSString *token=[FCMainSettings getToken];</span><br><span class="line">    NSDictionary *params=@&#123;kAfterLoginToken:token,</span><br><span class="line">                           @&quot;userid&quot;:currentUser.userId,</span><br><span class="line">                           @&quot;no&quot;:@(currentUser.no),</span><br><span class="line">                           @&quot;productid&quot;:model.productId,</span><br><span class="line">                           @&quot;price&quot;:model.price,</span><br><span class="line">                           @&quot;coin&quot;:model.coin,</span><br><span class="line">                           @&quot;quantity&quot;:@1,</span><br><span class="line">                           @&quot;signature&quot;:[[NSUUID UUID] UUIDString],</span><br><span class="line">                           @&quot;channel&quot;:@&quot;ios&quot;,</span><br><span class="line">                           @&quot;device_type&quot;:@&quot;ios&quot;&#125;;</span><br><span class="line">    HUDShowLoading</span><br><span class="line">    [[FCWebServiceController sharedWebServiceController] sendRequestWithParameters:params action:@&quot;trade/create&quot; success:^(id json) &#123;</span><br><span class="line">        </span><br><span class="line">        if(![json isKindOfClass:[NSDictionary class]])&#123;</span><br><span class="line">            HUDError(kServerInnerError)</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        HUDDismiss</span><br><span class="line">        NSString *tradeId=[[json objectForKey:@&quot;trade&quot;] objectForKey:@&quot;_id&quot;];</span><br><span class="line">        NSString *key=[[json objectForKey:@&quot;extras&quot;] objectForKey:@&quot;key&quot;];</span><br><span class="line">        //è°ƒèµ·è´­ä¹°ç®¡ç†ç±»çš„è´­ä¹°</span><br><span class="line">        [[FCInAppPurchaseManager sharedManager] purchaseProductWithIdentifier:model.identifier tradeId:tradeId key:key];</span><br><span class="line">        </span><br><span class="line">    &#125; failure:^(NSError *error) &#123;</span><br><span class="line">        HUDError(error.localizedDescription);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###å†…è´­ä¹°ç®¡ç†ç±»çš„å®ç° <code>FCInAppPurchaseManager.m</code><br>é¦–å…ˆè¦å¯¼å…¥StoreKitæ¡†æ¶ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;StoreKit/StoreKit.h&gt;</span><br></pre></td></tr></table></figure></p>
<p>å•ä¾‹ç±»æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">static FCInAppPurchaseManager *purchaseManager=nil;</span><br><span class="line">+(instancetype)sharedManager&#123;</span><br><span class="line">    </span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        purchaseManager=[[FCInAppPurchaseManager alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return purchaseManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æä¸€ä¸ªæ‹“å±•ï¼ŒåŠ ä¸Šä¸€äº›ç§æœ‰å±æ€§ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@interface FCInAppPurchaseManager()&lt;SKProductsRequestDelegate,SKPaymentTransactionObserver&gt;</span><br><span class="line">/**</span><br><span class="line"> *  æœåŠ¡å™¨ç”Ÿæˆçš„æ ¡éªŒç </span><br><span class="line"> */</span><br><span class="line">@property(nonatomic,copy)NSString *key;</span><br><span class="line">/**</span><br><span class="line"> *  iTunes Connectä¸Šå•†å“çš„æ ‡è¯†ç¬¦</span><br><span class="line"> */</span><br><span class="line">@property(nonatomic,copy)NSString *identifier;</span><br><span class="line">/**</span><br><span class="line"> *  æœåŠ¡å™¨çš„äº¤æ˜“ç¼–å·</span><br><span class="line"> */</span><br><span class="line">@property(nonatomic,copy)NSString *tradeId;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œæ·»åŠ ç›‘å¬ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-(instancetype)init&#123;</span><br><span class="line">    </span><br><span class="line">    if(self=[super init])&#123;</span><br><span class="line">        </span><br><span class="line">        [[SKPaymentQueue defaultQueue] addTransactionObserver:self];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®ç°è´­ä¹°å•†å“çš„æ¥å£ï¼šä¿å­˜äº¤æ˜“idã€keyåˆ°æœ¬åœ°çš„ç›®çš„æ˜¯ï¼Œæ”¯ä»˜å®Œæˆåï¼Œå‘Šè¯‰æœåŠ¡å™¨ç”¨æˆ·ä¹°äº†å•¥çš„è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€ä¸ªä¸ç¡®å®šçš„è¿‡ç¨‹ï¼Œæœ‰å¯èƒ½æ–­ç½‘äº†ï¼Œæ‰‹æœºæ²¡ç”µäº†ã€ç¨‹åºè¢«ç»ˆç»“äº†ï¼Œç¨‹åºbugå´©æºƒäº†ç­‰ä¸ç¡®å®šå› ç´ ï¼Œä¸€æ¬¡è¦ä¿ç•™è¿™ä¸€æ¬¡çš„äº¤æ˜“idã€keyï¼Œå†æ¬¡å¯åŠ¨appæ—¶ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨æ²¡æœ‰æ‹¿ç€å‡­è¯å»å‘è‹¹æœæœåŠ¡å™¨éªŒè¯äº¤æ˜“ä¿¡æ¯è‹¹æœä¼šè‡ªåŠ¨è°ƒç”¨ç›‘å¬è´­ä¹°ç»“æœçš„æ–¹æ³•<code>paymentQueue : updatedTransactions :</code>ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå®Œæˆä¸Šä¸€æ¬¡åº”è¯¥å‘Šè¯‰æˆ‘ä»¬æœåŠ¡å™¨ç”¨æˆ·ä¹°äº†å•¥çš„ä»»åŠ¡ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  è´­ä¹°å•†å“</span><br><span class="line"> *</span><br><span class="line"> *  @param identifier äº§å“åœ¨iTunes connectä¸­çš„æ ‡è¯†ç¬¦ï¼ˆHZSX.FriendCircle01 HZSX.FriendCircle02 HZSX.FriendCircle03 åˆ†åˆ«å¯¹åº”60åœˆå¸ã€180åœˆå¸ 300åœˆå¸ï¼‰</span><br><span class="line"> *  @param tradeId    äº¤æ˜“ç¼–å·ï¼ˆæœåŠ¡ç«¯ç”Ÿæˆçš„ï¼‰</span><br><span class="line"> *  @param key        éªŒè¯ç”¨çš„keyï¼ˆæœåŠ¡ç«¯ç”Ÿæˆï¼‰</span><br><span class="line"> */</span><br><span class="line">-(void)purchaseProductWithIdentifier:(NSString *)identifier tradeId:(NSString *)tradeId key:(NSString *)key&#123;</span><br><span class="line">    </span><br><span class="line">    if(![SKPaymentQueue canMakePayments])&#123;</span><br><span class="line">        </span><br><span class="line">        HUDError(@&quot;æ‚¨çš„æ‰‹æœºæ²¡æœ‰æ‰“å¼€ç¨‹åºå†…ä»˜è´¹è´­ä¹°&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if(![identifier hasPrefix:@&quot;HZSX.FriendCircle&quot;])&#123;</span><br><span class="line">        </span><br><span class="line">        HUDError(@&quot;å•†å“ç±»å‹é”™è¯¯&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if(kFCEmptyCheck(tradeId))&#123;</span><br><span class="line">        HUDError(@&quot;äº¤æ˜“ç¼–å·ä¸èƒ½ä¸ºç©º&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if(kFCEmptyCheck(key))&#123;</span><br><span class="line">        HUDError(@&quot;ç¼ºå°‘å¿…è¦å‚æ•°&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    _identifier=identifier;</span><br><span class="line">    _tradeId=tradeId;</span><br><span class="line">    _key=key;</span><br><span class="line">    //å­˜åˆ°æœ¬åœ°</span><br><span class="line">    NSString *token=[FCMainSettings getToken];</span><br><span class="line">    NSString *tradeId_key=[NSString stringWithFormat:@&quot;%@_tradeId&quot;,token];</span><br><span class="line">    NSString *tradeKey_key=[NSString stringWithFormat:@&quot;%@_key&quot;,token];</span><br><span class="line">    [[NSUserDefaults standardUserDefaults] setObject:tradeId forKey:tradeId_key];</span><br><span class="line">    [[NSUserDefaults standardUserDefaults] setObject:key forKey:tradeKey_key];</span><br><span class="line">    [[NSUserDefaults standardUserDefaults] synchronize];</span><br><span class="line">    </span><br><span class="line">    NSSet *set=[NSSet setWithObject:identifier];</span><br><span class="line">    //å‘èµ·è´­ä¹°å•†å“çš„è¯·æ±‚</span><br><span class="line">    SKProductsRequest *request=[[SKProductsRequest alloc] initWithProductIdentifiers:set];</span><br><span class="line">    request.delegate=self;</span><br><span class="line">    [request start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®ç°StoreKitçš„ä»£ç†æ–¹æ³•ï¼š<br>#pragma mark - SKProductsRequestDelegate<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//æ”¶åˆ°çš„äº§å“ä¿¡æ¯</span><br><span class="line">- (void)productsRequest:(SKProductsRequest *)request didReceiveResponse:(SKProductsResponse *)response&#123;</span><br><span class="line">    </span><br><span class="line">    if(response.products.count==0)&#123;</span><br><span class="line">        HUDError(@&quot;å•†å“ä¿¡æ¯é”™è¯¯&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    SKProduct *product=response.products.lastObject;</span><br><span class="line">    SKPayment *payment=[SKPayment paymentWithProduct:product];</span><br><span class="line">    [[SKPaymentQueue defaultQueue] addPayment:payment];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>#pragma mark - SKRequestDelegate<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-(void)request:(SKRequest *)request didFailWithError:(NSError *)error&#123;</span><br><span class="line">    </span><br><span class="line">    HUDError(error.localizedDescription);</span><br><span class="line">&#125;</span><br><span class="line">-(void)requestDidFinish:(SKRequest *)request&#123;</span><br><span class="line">    </span><br><span class="line">    HUDDismiss;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç›‘å¬è´­ä¹°ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - ç›‘å¬è´­ä¹°ç»“æœ(è‹¥è´­ä¹°æ—¶ï¼Œé€€å‡ºäº†appï¼Œè‹¹æœä¼šåœ¨appå¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•)</span><br><span class="line">-(void)paymentQueue:(SKPaymentQueue *)queue updatedTransactions:(NSArray *)transactions&#123;</span><br><span class="line">    </span><br><span class="line">    if(transactions.count==0!transactions)&#123;</span><br><span class="line">        </span><br><span class="line">        HUDError(@&quot;è·å–ä¸åˆ°è´­ä¹°ç»“æœ&quot;)</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    SKPaymentTransaction *transaction=transactions.lastObject;</span><br><span class="line">    switch (transaction.transactionState)</span><br><span class="line">    &#123;</span><br><span class="line">        case SKPaymentTransactionStatePurchased:&#123;//äº¤æ˜“å®Œæˆ</span><br><span class="line">            </span><br><span class="line">            [self recordTransaction:transaction];</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case SKPaymentTransactionStateFailed:&#123;//äº¤æ˜“å¤±è´¥</span><br><span class="line">        </span><br><span class="line">            [self failedTransaction:transaction];</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case SKPaymentTransactionStateRestored://å·²ç»è´­ä¹°è¿‡è¯¥å•†å“</span><br><span class="line">            [self restoreTransactions];</span><br><span class="line">            break;</span><br><span class="line">        case SKPaymentTransactionStatePurchasing: //å•†å“æ·»åŠ è¿›åˆ—è¡¨</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Ÿ</p>
<p>###ä¸ºä»€ä¹ˆä¸æŠŠäº¤æ˜“å®Œæˆåï¼Œå‘Šè¯‰è‡ªå·±æœåŠ¡å™¨ï¼Œä¹°äº†ä»€ä¹ˆï¼Œè¿™éƒ¨åˆ†ä¸šåŠ¡æŠ½ç¦»å‡ºæ¥å‘¢ï¼Ÿ<br>è€ƒè™‘åˆ°ä»è°ƒèµ·æ”¯ä»˜åˆ°æ”¯ä»˜ç»“æœï¼ˆæˆåŠŸã€å¤±è´¥ç­‰ï¼‰éœ€è¦<code>å‡ ç§’ç”šè‡³åå‡ ç§’</code>ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·å¯èƒ½ç¦»å¼€äº†å½“å‰ç•Œé¢ï¼Œ<br>è€Œè‹¹æœè´­ä¹°çš„ç»“æœå›è°ƒæ—¶ï¼Œç”¨æˆ·ä¸åœ¨å½“å‰ç•Œé¢å°±å‘Šè¯‰ä¸äº†æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œç”¨æˆ·ä¹°äº†å•¥å•¥å•¥ã€‚<br>å› æ­¤æˆ‘æŠŠè´­ä¹°å®Œæˆï¼Œå‘Šè¯‰æœåŠ¡å™¨çš„è¿™éƒ¨åˆ†é€»è¾‘ä¹Ÿå†™è¿›äº†è¿™ä¸ªç®¡ç†ç±»é‡Œé¢ã€‚è¿™æ ·ï¼Œç”¨æˆ·æ— è®ºæ˜¯å¦ç¦»å¼€å½“å‰é¡µé¢ï¼Œåªè¦æ”¯ä»˜æˆåŠŸäº†ï¼Œå°±èƒ½è°ƒç”¨å‘Šè¯‰æœåŠ¡å™¨ç”¨æˆ·ä¹°äº†å•¥çš„é€»è¾‘ã€‚</p>
<p>å‘Šè¯‰æœåŠ¡å™¨ç”¨æˆ·ä¹°äº†å•¥ï¼šåŒæ—¶å°†äº¤æ˜“idã€äº¤æ˜“keyã€å‡­è¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - è¯·æ±‚æœåŠ¡ç«¯ï¼Œè®°å½•äº¤æ˜“ å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä¹°äº†ä»€ä¹ˆ</span><br><span class="line">-(void)recordTransaction:(SKPaymentTransaction *)transaction&#123;</span><br><span class="line">    </span><br><span class="line">    //ç»“æŸäº¤æ˜“</span><br><span class="line">    [[SKPaymentQueue defaultQueue] finishTransaction: transaction];</span><br><span class="line">    </span><br><span class="line">    NSString *token=[FCMainSettings getToken];</span><br><span class="line">    NSString *tradeId_key=[NSString stringWithFormat:@&quot;%@_tradeId&quot;,token];</span><br><span class="line">    NSString *tradeKey_key=[NSString stringWithFormat:@&quot;%@_key&quot;,token];</span><br><span class="line">    if(kFCEmptyCheck(_tradeId))&#123;</span><br><span class="line">        _tradeId=[[NSUserDefaults standardUserDefaults] objectForKey:tradeId_key];</span><br><span class="line">    &#125;</span><br><span class="line">    if(kFCEmptyCheck(_key))&#123;</span><br><span class="line">        _key=[[NSUserDefaults standardUserDefaults] objectForKey:tradeKey_key];</span><br><span class="line">    &#125;</span><br><span class="line">    //è·å–è‹¹æœè¿”å›çš„æ”¯ä»˜å‡­è¯</span><br><span class="line">    NSURL *receiptURL=[[NSBundle mainBundle] appStoreReceiptURL];</span><br><span class="line">    NSData *receiptData=[NSData dataWithContentsOfURL:receiptURL];</span><br><span class="line">    if(!receiptData)&#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    NSString *base64_receipt=[[receiptData base64EncodedStringWithOptions:NSDataBase64EncodingEndLineWithLineFeed]</span><br><span class="line">                              stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;];</span><br><span class="line">    if(kFCEmptyCheck(base64_receipt))&#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    //sign=MD5(tradeid=tradeid&amp;salt=mrpyp-2016&amp;key=key)</span><br><span class="line">    NSString *components=[[NSString stringWithFormat:@&quot;tradeid=%@&amp;salt=mrpyp-2016&amp;key=%@&quot;,_tradeId,_key]</span><br><span class="line">                          stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;];</span><br><span class="line">    //NSString *rsa_components=[[RSA encryptString:components publicKey:kInAppPurchaseRSAPublicKey]</span><br><span class="line">    //                          stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;];</span><br><span class="line">    NSString *md5_componets=[components MD5Hash];</span><br><span class="line">    if(kFCEmptyCheck(token)kFCEmptyCheck(_tradeId)kFCEmptyCheck(md5_componets))&#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    NSDictionary *params=@&#123;kAfterLoginToken:token,</span><br><span class="line">                           @&quot;sign&quot;:md5_componets,</span><br><span class="line">                           @&quot;tradeid&quot;:_tradeId,</span><br><span class="line">                           @&quot;receipt&quot;:base64_receipt,</span><br><span class="line">                           @&quot;key&quot;:_key&#125;;</span><br><span class="line">    [self tellServerBuySuccessWithdTradeInfo:params];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¹°äº†ä»€ä¹ˆï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  å‘Šè¯‰æœåŠ¡å™¨è´­ä¹°æˆåŠŸäº†</span><br><span class="line"> *</span><br><span class="line"> *  @param tradeInfo       äº¤æ˜“ä¿¡æ¯</span><br><span class="line"> *  @param destinationPath å­˜æ”¾äº¤æ˜“ä¿¡æ¯çš„æ–‡ä»¶è·¯å¾„</span><br><span class="line"> */</span><br><span class="line">-(void)tellServerBuySuccessWithdTradeInfo:(NSDictionary *)tradeInfo/* destionationPath:(NSString *)destinationPath*/&#123;</span><br><span class="line">    </span><br><span class="line">    [[FCWebServiceController sharedWebServiceController] sendRequestWithParameters:tradeInfo action:@&quot;pay/ios_receipt_verify&quot; success:^(id json) &#123;</span><br><span class="line">        </span><br><span class="line">        if(![json isKindOfClass:[NSDictionary class]])&#123;</span><br><span class="line">            HUDError(kServerInnerError)</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        BOOL result=[[json objectForKey:@&quot;result&quot;] boolValue];</span><br><span class="line">        if(!result)&#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        NSLog(@&quot;éªŒè¯æˆåŠŸ&quot;);</span><br><span class="line">        //æ˜¾ç¤ºè´­ä¹°æˆåŠŸçš„è§†å›¾</span><br><span class="line">        //[self showBuySuccessViewWithCoin:60];</span><br><span class="line">        </span><br><span class="line">    &#125; failure:^(NSError *error) &#123;</span><br><span class="line">        NSLog(@&quot;%@&quot;,error.localizedDescription);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###æ¢å¤å·²è´­ä¹°çš„å•†å“<br>è‹¥ä½ è´­ä¹°çš„å•†å“ç±»å‹æ˜¯<code>éæ¶ˆè€—å‹</code>çš„ï¼Œåœ¨ç”¨æˆ·åˆ‡æ¢å¸å·ï¼Œæ¢æ‰‹æœºç­‰æƒ…æ™¯ä¸‹ï¼Œæ¢å¤å·²è´­ä¹°çš„å†…å®¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//æ¢å¤è´­ä¹°çš„è£…å¤‡</span><br><span class="line">-(void)restoreTransactions&#123;</span><br><span class="line"></span><br><span class="line">    [[SKPaymentQueue defaultQueue] restoreCompletedTransactions];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¹¶å®ç°æ¢å¤è´­ä¹°çš„ä»£ç†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//æ¢å¤è´­ä¹°çš„è£…å¤‡æˆåŠŸ</span><br><span class="line">-(void)paymentQueueRestoreCompletedTransactionsFinished: (SKPaymentTransaction *)transaction&#123;</span><br><span class="line">    </span><br><span class="line">    if(!transaction)</span><br><span class="line">        return;</span><br><span class="line">    [self paymentQueue:[SKPaymentQueue defaultQueue] updatedTransactions:@[transaction]];</span><br><span class="line">&#125;</span><br><span class="line">//æ¢å¤è´­ä¹°çš„è£…å¤‡å¤±è´¥</span><br><span class="line">-(void)paymentQueue:(SKPaymentQueue *) paymentQueue restoreCompletedTransactionsFailedWithError:(NSError *)error&#123;</span><br><span class="line">    </span><br><span class="line">    HUDError(error.localizedDescription);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€ååœ¨<code>dealloc</code>æ–¹æ³•ä¸­æ³¨é”€ç›‘å¬:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-(void)dealloc&#123;</span><br><span class="line">    </span><br><span class="line">    [[SKPaymentQueue defaultQueue] removeTransactionObserver:self];//è§£é™¤ç›‘å¬</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###æµ‹è¯•å†…è´­ä¹°<br>å†…è´­ä¹°çš„ä»£ç å·²ç»å†™å¥½äº†ï¼Œå†…è´­é¡¹ç›®ä¹Ÿæ–°å»ºäº†ï¼Œæ²™ç›’æµ‹è¯•å¸å·ä¹Ÿæœ‰äº†ï¼Œç°åœ¨å¯ä»¥åŠ¨æ‰‹æµ‹è¯•å†…è´­ä¹°äº†ã€‚</p>
<ul>
<li>æ‰‹æœºæ‰“å¼€App Storeï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªtab<code>ç²¾å“æ¨è</code>ï¼Œæ»šåŠ¨åˆ°æœ€åº•éƒ¨ï¼Œç‚¹å‡»è‡ªå·±çš„Apple IDï¼Œåœ¨å¼¹å‡ºçš„æ¡†ä¸­ï¼Œé€‰æ‹©<code>æ³¨é”€</code>ã€‚</li>
<li>æ‰“å¼€æˆ‘ä»¬è‡ªå·±çš„appï¼Œè¿›å…¥å†…è´­ä¹°<code>å•†å“åˆ—è¡¨é¡µé¢</code>ï¼Œç‚¹ä¸€ä¸ªå•†å“ï¼Œå‘èµ·è´­ä¹°ã€‚</li>
<li>åœ¨ç™»é™†çš„å¼¹æ¡†ä¸­é€‰æ‹©<code>ä½¿ç”¨ç°æœ‰çš„Apple ID</code>ï¼Œåœ¨ç™»é™†iTunes connectçš„å¼¹æ¡†ä¸­ï¼Œè¾“å…¥å‰é¢æ³¨å†Œçš„<code>æ²™ç›’æµ‹è¯•å¸å·</code></li>
<li>åœ¨è´­ä¹°ä¿¡æ¯çš„å¼¹æ¡†ä¸­é€‰æ‹©<code>è´­ä¹°</code><br><img src="http://upload-images.jianshu.io/upload_images/937405-e42a3ba654fcb492.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></li>
<li>è´­ä¹°å®Œæˆï¼Œå‰å¾€<code>æˆ‘çš„å¸æˆ·</code>ï¼ŒæŸ¥çœ‹å……å€¼è®°å½•ï¼ŒéªŒè¯æœåŠ¡å™¨æ˜¯å¦çºªå½•æ­¤æ¬¡äº¤æ˜“ã€‚<br>###æäº¤å®¡æ ¸<br>è‹¥ä½ çš„appæ—¶ç¬¬ä¸€æ¬¡åŠ å…¥å†…è´­ä¹°ï¼Œåˆ™ï¼Œappå†…è´­é¡¹ç›®ä¹Ÿè¦ä¸€å¹¶æäº¤<br><img src="http://upload-images.jianshu.io/upload_images/937405-2157998701de688e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>è‡³æ­¤ï¼Œå†…è´­ä¹°é›†æˆç»“æŸï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººåšå®¢ï¼š<a href="http://cgpointzero.top">CGPointZero</a><br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ç”¨NSURLConnectionå°è£…ä¸€ä¸ªæ–­ç‚¹ç»­ä¼ åå°ä¸‹è½½çš„è½»é‡çº§ä¸‹è½½å·¥å…·]]></title>
      <url>http://cgpointzero.top/2016/09/06/downloader/</url>
      <content type="html"><![CDATA[<p>###æ‘˜è¦</p>
<ul>
<li>æœ¬æ–‡è®²è¿°ï¼Œç”¨NSURLConnectionå°è£…ä¸€ä¸ªæ–­ç‚¹ä¸‹è½½ï¼Œæ”¯æŒåå°ä¸‹è½½çš„å®Œæ•´çš„ä¸‹è½½å·¥å…·ã€‚<br>###æ•ˆæœå›¾<br><img src="http://upload-images.jianshu.io/upload_images/937405-a515886852667cb1.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"></li>
</ul>
<p>###ç”¨æ³•ç¤ºä¾‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[[FGGDownloadManager shredManager] downloadWithUrlString:model.url toPath:model.destinationPath process:^(float progress, NSString *sizeString, NSString *speedString) &#123;</span><br><span class="line">//æ›´æ–°è¿›åº¦æ¡çš„è¿›åº¦å€¼</span><br><span class="line">weakCell.progressView.progress=progress;</span><br><span class="line">//æ›´æ–°è¿›åº¦å€¼æ–‡å­—</span><br><span class="line">weakCell.progressLabel.text=[NSString stringWithFormat:@&quot;%.2f%%&quot;,progress*100];</span><br><span class="line">//æ›´æ–°æ–‡ä»¶å·²ä¸‹è½½çš„å¤§å°</span><br><span class="line">weakCell.sizeLabel.text=sizeString;</span><br><span class="line">//æ˜¾ç¤ºç½‘é€Ÿ</span><br><span class="line">weakCell.speedLabel.text=speedString;</span><br><span class="line">if(speedString)</span><br><span class="line">weakCell.speedLabel.hidden=NO;</span><br><span class="line"></span><br><span class="line">&#125; completion:^&#123;</span><br><span class="line">[sender setTitle:@&quot;å®Œæˆ&quot; forState:UIControlStateNormal];</span><br><span class="line">sender.enabled=NO;</span><br><span class="line">weakCell.speedLabel.hidden=YES;</span><br><span class="line">UIAlertView *alert=[[UIAlertView alloc]initWithTitle:@&quot;æç¤º&quot; message:[NSString stringWithFormat:@&quot;%@ä¸‹è½½å®Œæˆâœ…&quot;,model.name] delegate:nil cancelButtonTitle:@&quot;å¥½&quot; otherButtonTitles:nil, nil];</span><br><span class="line">[alert show];</span><br><span class="line"></span><br><span class="line">&#125; failure:^(NSError *error) &#123;</span><br><span class="line">[[FGGDownloadManager shredManager] cancelDownloadTask:model.url];</span><br><span class="line">[sender setTitle:@&quot;æ¢å¤&quot; forState:UIControlStateNormal];</span><br><span class="line">weakCell.speedLabel.hidden=YES;</span><br><span class="line">UIAlertView *alert=[[UIAlertView alloc]initWithTitle:@&quot;Error&quot; message:error.localizedDescription delegate:nil cancelButtonTitle:@&quot;ç¡®å®š&quot; otherButtonTitles:nil, nil];</span><br><span class="line">[alert show];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>###æ€è·¯</p>
<ul>
<li>æä¸€ä¸ªä¸‹è½½ç±»ï¼Œè´Ÿè´£ä¸€ä¸ªä¸‹è½½ä»»åŠ¡ï¼›</li>
<li>æä¸€ä¸ªä¸‹è½½ç®¡ç†ç±»ï¼Œè´Ÿè´£ä¸‹è½½é˜Ÿåˆ—ï¼›</li>
<li>åœ¨ç¨‹åºè¿›å…¥åå°æ—¶ï¼Œå¼€å¯åå°ä¸‹è½½ï¼›</li>
<li>åœ¨ç¨‹åºè¢«ç»ˆç»“æ—¶å–æ¶ˆæ‰€æœ‰ä¸‹è½½å¹¶ä¿å­˜ä¸‹è½½è¿›åº¦ï¼›</li>
<li>å½“ç¨‹åºå¯åŠ¨æ—¶ï¼ŒåŠ è½½ä¸Šæ¬¡ä¸‹è½½è¿›åº¦ï¼›</li>
</ul>
<p>###ä¸‹è½½ç±» FGGDownloader.h<br>FGGDownloaderéµå¾ªNSURLConnectionçš„ä¸€äº›åè®®:<br><code>@interface FGGDownloader : NSObject&lt;NSURLConnectionDataDelegate,NSURLConnectionDelegate&gt;</code><br>æ¥ä¸‹æ¥å®šä¹‰ä¸‰ä¸ªä»£ç å—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typedef void (^ProcessHandle)(float progress,NSString *sizeString,NSString *speedString);</span><br><span class="line">typedef void (^CompletionHandle)();</span><br><span class="line">typedef void (^FailureHandle)(NSError *error);</span><br></pre></td></tr></table></figure>
<p>ç„¶åå£°æ˜ä¸‰ä¸ªåªè¯»å±æ€§ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//ä¸‹è½½è¿‡ç¨‹ä¸­å›è°ƒçš„ä»£ç å—ï¼Œä¼šå¤šæ¬¡è°ƒç”¨</span><br><span class="line">@property(nonatomic,copy,readonly)ProcessHandle process;</span><br><span class="line">//ä¸‹è½½å®Œæˆå›è°ƒçš„ä»£ç å—</span><br><span class="line">@property(nonatomic,copy,readonly)CompletionHandle completion;</span><br><span class="line">//ä¸‹è½½å¤±è´¥çš„å›è°ƒä»£ç å—</span><br><span class="line">@property(nonatomic,copy,readonly)FailureHandle failure;</span><br></pre></td></tr></table></figure></p>
<p>å†™ä¸€ä¸ªå¿«é€Ÿå®ä¾‹çš„ç±»æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+(instancetype)downloader;</span><br></pre></td></tr></table></figure></p>
<p>æä¸€ä¸ªä¸‹è½½çš„æ¥å£ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  æ–­ç‚¹ä¸‹è½½</span><br><span class="line">*</span><br><span class="line">*  @param urlString        ä¸‹è½½çš„é“¾æ¥</span><br><span class="line">*  @param destinationPath  ä¸‹è½½çš„æ–‡ä»¶çš„ä¿å­˜è·¯å¾„</span><br><span class="line">*  @param  process         ä¸‹è½½è¿‡ç¨‹ä¸­å›è°ƒçš„ä»£ç å—ï¼Œä¼šå¤šæ¬¡è°ƒç”¨</span><br><span class="line">*  @param  completion      ä¸‹è½½å®Œæˆå›è°ƒçš„ä»£ç å—</span><br><span class="line">*  @param  failure         ä¸‹è½½å¤±è´¥çš„å›è°ƒä»£ç å—</span><br><span class="line">*/</span><br><span class="line">-(void)downloadWithUrlString:(NSString *)urlString</span><br><span class="line">toPath:(NSString *)destinationPath</span><br><span class="line">process:(ProcessHandle)process</span><br><span class="line">completion:(CompletionHandle)completion</span><br><span class="line">failure:(FailureHandle)failure;</span><br></pre></td></tr></table></figure></p>
<p>æä¸€ä¸ªå–æ¶ˆä¸‹è½½çš„æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  å–æ¶ˆä¸‹è½½</span><br><span class="line">*/</span><br><span class="line">-(void)cancel;</span><br></pre></td></tr></table></figure></p>
<p>ç¨‹åºå¯åŠ¨çš„æ—¶å€™è¦åŠ è½½ä¸Šä¸€æ¬¡çš„ä¸‹è½½è¿›åº¦ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* è·å–ä¸Šä¸€æ¬¡çš„ä¸‹è½½è¿›åº¦</span><br><span class="line">*/</span><br><span class="line">+(float)lastProgress:(NSString *)url;</span><br></pre></td></tr></table></figure></p>
<p>éœ€è¦åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºæ–‡ä»¶ä¸‹è½½äº†çš„å¤§å°ï¼Œæ–‡ä»¶æ€»å¤§å°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**è·å–æ–‡ä»¶å·²ä¸‹è½½çš„å¤§å°å’Œæ€»å¤§å°,æ ¼å¼ä¸º:å·²ç»ä¸‹è½½çš„å¤§å°/æ–‡ä»¶æ€»å¤§å°,å¦‚ï¼š12.00M/100.00Mã€‚</span><br><span class="line">*</span><br><span class="line">* @param url ä¸‹è½½é“¾æ¥</span><br><span class="line">*/</span><br><span class="line">+(NSString *)filesSize:(NSString *)url;</span><br></pre></td></tr></table></figure></p>
<p>æä¸‰ä¸ªé€šçŸ¥ï¼Œå› ä¸ºä¸‹è½½ç®¡ç†ç±»è¦ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  ä¸‹è½½å®Œæˆçš„é€šçŸ¥å</span><br><span class="line">*/</span><br><span class="line">static NSString *const FGGDownloadTaskDidFinishDownloadingNotification=@&quot;FGGDownloadTaskDidFinishDownloadingNotification&quot;;</span><br><span class="line">/**</span><br><span class="line">*  ç³»ç»Ÿå­˜å‚¨ç©ºé—´ä¸è¶³çš„é€šçŸ¥å</span><br><span class="line">*/</span><br><span class="line">static NSString *const FGGInsufficientSystemSpaceNotification=@&quot;FGGInsufficientSystemSpaceNotification&quot;;</span><br><span class="line">/**</span><br><span class="line">*  ä¸‹è½½è¿›åº¦æ”¹å˜çš„é€šçŸ¥</span><br><span class="line">*/</span><br><span class="line">static NSString *const FGGProgressDidChangeNotificaiton=@&quot;FGGProgressDidChangeNotificaiton&quot;;</span><br></pre></td></tr></table></figure></p>
<p>###ä¸‹è½½ç±»çš„å®ç° FGGDownloader.m<br>å¤§æ–‡ä»¶ä¸‹è½½ï¼Œè¦éµå¾ªä½å†…å­˜å ç”¨ï¼Œå› æ­¤æˆ‘ä»¬è¦æœ‰ä¸€ä¸ªæ–‡ä»¶è¯»å†™å¥æŸ„ï¼š<code>NSFileHandle</code>ï¼Œä»¥åŠä¸€äº›å‚¨æ”¾ä¸‹è½½ä½ç½®ã€ä¸‹è½½è·¯å¾„ã€é“¾æ¥ç­‰ä¸€äº›ä¸œè¥¿çš„æˆå‘˜å˜é‡ã€‚</p>
<p><pre><br>è¯´æ˜ä¸€ä¸‹ï¼Œ<code>_timer</code>æ˜¯ä¸ºäº†è·å–ç½‘é€Ÿè¿‘ä¼¼å€¼ï¼Œæ²¡0.5ç§’è®¡ç®—æ–‡ä»¶å¢é•¿çš„å¤§å°ï¼Œå–ç½‘é€Ÿå¹³å‡å€¼.<br>è¿™é‡Œæœ‰ä¸ªå‡è®¾ï¼šå‡è®¾æ–‡ä»¶è¯»å†™ä¸å ç”¨æ—¶é—´ï¼Œè€Œåœ¨è¿™0.5ç§’å†…æ–‡ä»¶çš„å¢é‡ç›´æ¥ååº”ç½‘é€Ÿã€‚<br></pre><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@implementation FGGDownloader&#123;</span><br><span class="line"></span><br><span class="line">NSString        *_url_string;</span><br><span class="line">NSString        *_destination_path;</span><br><span class="line">NSFileHandle    *_writeHandle;</span><br><span class="line">NSURLConnection *_con;</span><br><span class="line">NSUInteger       _lastSize;</span><br><span class="line">NSUInteger       _growth;</span><br><span class="line">NSTimer         *_timer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¿«é€Ÿå®ä¾‹åŒ–çš„ç±»æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+(instancetype)downloader&#123;</span><br><span class="line"></span><br><span class="line">return [[[self class] alloc]init];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åˆå§‹åŒ–æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-(instancetype)init&#123;</span><br><span class="line"></span><br><span class="line">if(self=[super init])&#123;</span><br><span class="line"></span><br><span class="line">//æ¯0.5ç§’è®¡ç®—ä¸€æ¬¡æ–‡ä»¶å¤§å°å¢åŠ éƒ¨åˆ†çš„å°ºå¯¸</span><br><span class="line">_timer=[NSTimer scheduledTimerWithTimeInterval:0.1 target:self selector:@selector(getGrowthSize) userInfo:nil repeats:YES];</span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è®¡ç®—æ–‡ä»¶æ²¡0.5ç§’çš„å¢é‡ï¼Œä»¥è®¡ç®—ç½‘é€Ÿè¿‘ä¼¼å€¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//è®¡ç®—ä¸€æ¬¡æ–‡ä»¶å¤§å°å¢åŠ éƒ¨åˆ†çš„å°ºå¯¸ï¼Œä»¥è®¡ç®—ç½‘é€Ÿè¿‘ä¼¼å€¼</span><br><span class="line">-(void)getGrowthSize</span><br><span class="line">&#123;</span><br><span class="line">NSUInteger size=[[[[NSFileManager defaultManager] attributesOfItemAtPath:_destination_path error:nil] objectForKey:NSFileSize] integerValue];</span><br><span class="line">_growth=size-_lastSize;</span><br><span class="line">_lastSize=size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…³é”®æ–¹æ³•ï¼Œä¸‹è½½æ¥å£æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  æ–­ç‚¹ä¸‹è½½</span><br><span class="line">*</span><br><span class="line">*  @param urlString        ä¸‹è½½çš„é“¾æ¥</span><br><span class="line">*  @param destinationPath  ä¸‹è½½çš„æ–‡ä»¶çš„ä¿å­˜è·¯å¾„</span><br><span class="line">*  @param  process         ä¸‹è½½è¿‡ç¨‹ä¸­å›è°ƒçš„ä»£ç å—ï¼Œä¼šå¤šæ¬¡è°ƒç”¨</span><br><span class="line">*  @param  completion      ä¸‹è½½å®Œæˆå›è°ƒçš„ä»£ç å—</span><br><span class="line">*  @param  failure         ä¸‹è½½å¤±è´¥çš„å›è°ƒä»£ç å—</span><br><span class="line">*/</span><br><span class="line">-(void)downloadWithUrlString:(NSString *)urlString toPath:(NSString *)destinationPath process:(ProcessHandle)process completion:(CompletionHandle)completion failure:(FailureHandle)failure&#123;</span><br><span class="line"></span><br><span class="line">if(urlString&amp;&amp;destinationPath)&#123;</span><br><span class="line"></span><br><span class="line">_url_string=urlString;</span><br><span class="line">_destination_path=destinationPath;</span><br><span class="line">_process=process;</span><br><span class="line">_completion=completion;</span><br><span class="line">_failure=failure;</span><br><span class="line"></span><br><span class="line">NSURL *url=[NSURL URLWithString:urlString];</span><br><span class="line">NSMutableURLRequest *request=[NSMutableURLRequest requestWithURL:url];</span><br><span class="line">NSFileManager *fileManager=[NSFileManager defaultManager];</span><br><span class="line">BOOL fileExist=[fileManager fileExistsAtPath:destinationPath];</span><br><span class="line">if(fileExist)&#123;</span><br><span class="line"></span><br><span class="line">NSUInteger length=[[[fileManager attributesOfItemAtPath:destinationPath error:nil] objectForKey:NSFileSize] integerValue];</span><br><span class="line">NSString *rangeString=[NSString stringWithFormat:@&quot;bytes=%ld-&quot;,length];</span><br><span class="line">[request setValue:rangeString forHTTPHeaderField:@&quot;Range&quot;];</span><br><span class="line">&#125;</span><br><span class="line">_con=[NSURLConnection connectionWithRequest:request delegate:self];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å–æ¶ˆä¸‹è½½ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  å–æ¶ˆä¸‹è½½</span><br><span class="line">*/</span><br><span class="line">-(void)cancel&#123;</span><br><span class="line"></span><br><span class="line">[self.con cancel];</span><br><span class="line">self.con=nil;</span><br><span class="line">if(_timer)&#123;</span><br><span class="line"></span><br><span class="line">[_timer invalidate];</span><br><span class="line">_timer=nil;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¨‹åºæ¯æ¬¡å¯åŠ¨éƒ½è¦è·å–ä¸Šæ¬¡çš„ä¸‹è½½è¿›åº¦ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* è·å–ä¸Šä¸€æ¬¡çš„ä¸‹è½½è¿›åº¦</span><br><span class="line">*/</span><br><span class="line">+(float)lastProgress:(NSString *)url&#123;</span><br><span class="line"></span><br><span class="line">if(url)</span><br><span class="line">return [[NSUserDefaults standardUserDefaults]floatForKey:[NSString stringWithFormat:@&quot;%@progress&quot;,url]];</span><br><span class="line">return 0.0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ä¸‹è½½é“¾æ¥urlè·å–æ–‡ä»¶çš„å¤§å°ä¿¡æ¯ï¼ˆå½“å‰å¤§å°/æ€»å¤§å° ç»„æˆçš„å­—ç¬¦ä¸²ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**è·å–æ–‡ä»¶å·²ä¸‹è½½çš„å¤§å°å’Œæ€»å¤§å°,æ ¼å¼ä¸º:å·²ç»ä¸‹è½½çš„å¤§å°/æ–‡ä»¶æ€»å¤§å°,å¦‚ï¼š12.00M/100.00M</span><br><span class="line">*/</span><br><span class="line">+(NSString *)filesSize:(NSString *)url&#123;</span><br><span class="line"></span><br><span class="line">NSString *totalLebgthKey=[NSString stringWithFormat:@&quot;%@totalLength&quot;,url];</span><br><span class="line">NSUserDefaults *usd=[NSUserDefaults standardUserDefaults];</span><br><span class="line">NSUInteger totalLength=[usd integerForKey:totalLebgthKey];</span><br><span class="line">if(totalLength==0)&#123;</span><br><span class="line"></span><br><span class="line">return @&quot;0.00K/0.00K&quot;;</span><br><span class="line">&#125;</span><br><span class="line">NSString *progressKey=[NSString stringWithFormat:@&quot;%@progress&quot;,url];</span><br><span class="line">float progress=[[NSUserDefaults standardUserDefaults] floatForKey:progressKey];</span><br><span class="line">NSUInteger currentLength=progress*totalLength;</span><br><span class="line"></span><br><span class="line">NSString *currentSize=[self convertSize:currentLength];</span><br><span class="line">NSString *totalSize=[self convertSize:totalLength];</span><br><span class="line">return [NSString stringWithFormat:@&quot;%@/%@&quot;,currentSize,totalSize];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹é¢æ˜¯ä¸ªå·¥å…·æ–¹æ³•ï¼ŒæŠŠæ–‡ä»¶çš„é•¿åº¦(å­—èŠ‚)è½¬æˆå­—ç¬¦ä¸²<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* è®¡ç®—ç¼“å­˜çš„å ç”¨å­˜å‚¨å¤§å°</span><br><span class="line">*</span><br><span class="line">* @prama length  æ–‡ä»¶å¤§å°</span><br><span class="line">*/</span><br><span class="line">+(NSString *)convertSize:(NSUInteger)length</span><br><span class="line">&#123;</span><br><span class="line">if(length&lt;1024)</span><br><span class="line">return [NSString stringWithFormat:@&quot;%ldB&quot;,(NSUInteger)length];</span><br><span class="line">else if(length&gt;=1024&amp;&amp;length&lt;1024*1024)</span><br><span class="line">return [NSString stringWithFormat:@&quot;%.0fK&quot;,(float)length/1024];</span><br><span class="line">else if(length &gt;=1024*1024&amp;&amp;length&lt;1024*1024*1024)</span><br><span class="line">return [NSString stringWithFormat:@&quot;%.1fM&quot;,(float)length/(1024*1024)];</span><br><span class="line">else</span><br><span class="line">return [NSString stringWithFormat:@&quot;%.1fG&quot;,(float)length/(1024*1024*1024)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹è½½è¿‡ç¨‹å¯èƒ½ä¼šå­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œè‹¥ä¸åšå¤„ç†ï¼Œä¼šå¯¼è‡´crashï¼Œå› æ­¤æ¯æ¬¡å¥æŸ„å†™æ–‡ä»¶æ—¶ï¼Œéƒ½è¦åˆ¤æ–­å­˜å‚¨ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  è·å–ç³»ç»Ÿå¯ç”¨å­˜å‚¨ç©ºé—´</span><br><span class="line">*</span><br><span class="line">*  @return ç³»ç»Ÿç©ºç”¨å­˜å‚¨ç©ºé—´ï¼Œå•ä½ï¼šå­—èŠ‚</span><br><span class="line">*/</span><br><span class="line">-(NSUInteger)systemFreeSpace&#123;</span><br><span class="line"></span><br><span class="line">NSString *docPath=[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject];</span><br><span class="line">NSDictionary *dict=[[NSFileManager defaultManager] attributesOfFileSystemForPath:docPath error:nil];</span><br><span class="line">return [[dict objectForKey:NSFileSystemFreeSize] integerValue];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###ä¸‹é¢æ˜¯NSURLConnectçš„ä»£ç†å’Œæ•°æ®æº<br>ä¸‹è½½å¤±è´¥ï¼Œå›è°ƒerror blockï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - NSURLConnection</span><br><span class="line">/**</span><br><span class="line">* ä¸‹è½½å¤±è´¥</span><br><span class="line">*/</span><br><span class="line">-(void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error&#123;</span><br><span class="line"></span><br><span class="line">if(_failure)</span><br><span class="line">_failure(error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨æ¥å—åˆ°å“åº”è¯·æ±‚çš„ä»£ç†æ–¹æ³•ä¸­å­˜å‚¨æ–‡ä»¶ä¸­å¤§å°ï¼Œä»¥åŠåˆå§‹åŒ–æ–‡ä»¶è¯»å†™å¥æŸ„<code>_writeHandle</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* æ¥æ”¶åˆ°å“åº”è¯·æ±‚</span><br><span class="line">*/</span><br><span class="line">-(void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response&#123;</span><br><span class="line"></span><br><span class="line">NSString *key=[NSString stringWithFormat:@&quot;%@totalLength&quot;,_url_string];</span><br><span class="line">NSUserDefaults *usd=[NSUserDefaults standardUserDefaults];</span><br><span class="line">NSUInteger totalLength=[usd integerForKey:key];</span><br><span class="line">if(totalLength==0)&#123;</span><br><span class="line"></span><br><span class="line">[usd setInteger:response.expectedContentLength forKey:key];</span><br><span class="line">[usd synchronize];</span><br><span class="line">&#125;</span><br><span class="line">NSFileManager *fileManager=[NSFileManager defaultManager];</span><br><span class="line">BOOL fileExist=[fileManager fileExistsAtPath:_destination_path];</span><br><span class="line">if(!fileExist)</span><br><span class="line">[fileManager createFileAtPath:_destination_path contents:nil attributes:nil];</span><br><span class="line">_writeHandle=[NSFileHandle fileHandleForWritingAtPath:_destination_path];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹è½½è¿‡ç¨‹çš„æ¥æ”¶æ•°æ®çš„å›è°ƒï¼Œå¤„ç†è®¡ç®—ç½‘é€Ÿã€ä¸‹è½½è¿›åº¦ã€æ–‡ä»¶å¤§å°ä¿¡æ¯ï¼Œå­˜æ¡£å½“å‰å¤§å°ç­‰æ“ä½œï¼Œæœ€åå›è°ƒ<b><i>ç½‘é€Ÿ</i></b>ï¼Œæ–‡ä»¶å¤§å°/æ€»å¤§å°å­—ç¬¦ä¸²ï¼Œ<b><i>ä¸‹è½½è¿›åº¦</i></b>ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* ä¸‹è½½è¿‡ç¨‹ï¼Œä¼šå¤šæ¬¡è°ƒç”¨</span><br><span class="line">*/</span><br><span class="line">-(void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data&#123;</span><br><span class="line"></span><br><span class="line">[_writeHandle seekToEndOfFile];</span><br><span class="line"></span><br><span class="line">NSUInteger freeSpace=[self systemFreeSpace];</span><br><span class="line">if(freeSpace&lt;1024*1024*20)&#123;</span><br><span class="line"></span><br><span class="line">UIAlertController *alertController=[UIAlertController alertControllerWithTitle:@&quot;æç¤º&quot; message:@&quot;ç³»ç»Ÿå¯ç”¨å­˜å‚¨ç©ºé—´ä¸è¶³20M&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">UIAlertAction *confirm=[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:nil];</span><br><span class="line">[alertController addAction:confirm];</span><br><span class="line">[[UIApplication sharedApplication].keyWindow.rootViewController presentViewController:alertController animated:YES completion:nil];</span><br><span class="line">//å‘é€ç³»ç»Ÿå­˜å‚¨ç©ºé—´ä¸è¶³çš„é€šçŸ¥,ç”¨æˆ·å¯è‡ªè¡Œæ³¨å†Œè¯¥é€šçŸ¥ï¼Œæ”¶åˆ°é€šçŸ¥æ—¶ï¼Œæš‚åœä¸‹è½½ï¼Œå¹¶æ›´æ–°ç•Œé¢</span><br><span class="line">[[NSNotificationCenter defaultCenter] postNotificationName:FGGInsufficientSystemSpaceNotification object:nil userInfo:@&#123;@&quot;urlString&quot;:_url_string&#125;];</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">[_writeHandle writeData:data];</span><br><span class="line">NSUInteger length=[[[[NSFileManager defaultManager] attributesOfItemAtPath:_destination_path error:nil] objectForKey:NSFileSize] integerValue];</span><br><span class="line">NSString *key=[NSString stringWithFormat:@&quot;%@totalLength&quot;,_url_string];</span><br><span class="line">NSUInteger totalLength=[[NSUserDefaults standardUserDefaults] integerForKey:key];</span><br><span class="line"></span><br><span class="line">//è®¡ç®—ä¸‹è½½è¿›åº¦</span><br><span class="line">float progress=(float)length/totalLength;</span><br><span class="line"></span><br><span class="line">[[NSUserDefaults standardUserDefaults]setFloat:progress forKey:[NSString stringWithFormat:@&quot;%@progress&quot;,_url_string]];</span><br><span class="line">[[NSUserDefaults standardUserDefaults] synchronize];</span><br><span class="line"></span><br><span class="line">//è·å–æ–‡ä»¶å¤§å°ï¼Œæ ¼å¼ä¸ºï¼šæ ¼å¼ä¸º:å·²ç»ä¸‹è½½çš„å¤§å°/æ–‡ä»¶æ€»å¤§å°,å¦‚ï¼š12.00M/100.00M</span><br><span class="line">NSString *sizeString=[FGGDownloader filesSize:_url_string];</span><br><span class="line"></span><br><span class="line">//å‘é€è¿›åº¦æ”¹å˜çš„é€šçŸ¥(ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ç”¨åˆ°ï¼Œåªæœ‰åœ¨è§¦å‘ä¸‹è½½ä¸æ˜¾ç¤ºä¸‹è½½è¿›åº¦åœ¨ä¸åŒç•Œé¢çš„æ—¶å€™æ‰ä¼šç”¨åˆ°)</span><br><span class="line">NSDictionary *userInfo=@&#123;@&quot;url&quot;:_url_string,@&quot;progress&quot;:@(progress),@&quot;sizeString&quot;:sizeString&#125;;</span><br><span class="line">[[NSNotificationCenter defaultCenter] postNotificationName:FGGProgressDidChangeNotificaiton object:nil userInfo:userInfo];</span><br><span class="line"></span><br><span class="line">//è®¡ç®—ç½‘é€Ÿ</span><br><span class="line">NSString *speedString=@&quot;0.00Kb/s&quot;;</span><br><span class="line">NSString *growString=[FGGDownloader convertSize:_growth*(1.0/0.1)];</span><br><span class="line">speedString=[NSString stringWithFormat:@&quot;%@/s&quot;,growString];</span><br><span class="line"></span><br><span class="line">//å›è°ƒä¸‹è½½è¿‡ç¨‹ä¸­çš„ä»£ç å—</span><br><span class="line">if(_process)</span><br><span class="line">_process(progress,sizeString,speedString);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹è½½å®Œæˆï¼Œå‘é€é€šçŸ¥ï¼Œå›è°ƒä¸‹è½½å®Œæˆçš„ä»£ç å—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* ä¸‹è½½å®Œæˆ</span><br><span class="line">*/</span><br><span class="line">-(void)connectionDidFinishLoading:(NSURLConnection *)connection&#123;</span><br><span class="line"></span><br><span class="line">[[NSNotificationCenter defaultCenter] postNotificationName:FGGDownloadTaskDidFinishDownloadingNotification object:nil userInfo:@&#123;@&quot;urlString&quot;:_url_string&#125;];</span><br><span class="line">if(_completion)</span><br><span class="line">_completion();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###ä¸‹è½½ç®¡ç†ç±» FGGDownloadManager.h<br>é¦–å…ˆè¦å¯¼å…¥ä¸‹è½½ç±»ï¼š<code>#import &quot;FGGDownloader.h&quot;</code><br>å•ä¾‹æ¥å£<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+(instancetype)shredManager;</span><br></pre></td></tr></table></figure></p>
<p>åŒæ ·æœ‰æ·»åŠ ä¸‹è½½ä»»åŠ¡çš„æ¥å£ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  æ–­ç‚¹ä¸‹è½½</span><br><span class="line">*</span><br><span class="line">*  @param urlString        ä¸‹è½½çš„é“¾æ¥</span><br><span class="line">*  @param destinationPath  ä¸‹è½½çš„æ–‡ä»¶çš„ä¿å­˜è·¯å¾„</span><br><span class="line">*  @param  process         ä¸‹è½½è¿‡ç¨‹ä¸­å›è°ƒçš„ä»£ç å—ï¼Œä¼šå¤šæ¬¡è°ƒç”¨</span><br><span class="line">*  @param  completion      ä¸‹è½½å®Œæˆå›è°ƒçš„ä»£ç å—</span><br><span class="line">*  @param  failure         ä¸‹è½½å¤±è´¥çš„å›è°ƒä»£ç å—</span><br><span class="line">*/</span><br><span class="line">-(void)downloadWithUrlString:(NSString *)urlString</span><br><span class="line">toPath:(NSString *)destinationPath</span><br><span class="line">process:(ProcessHandle)process</span><br><span class="line">completion:(CompletionHandle)completion</span><br><span class="line">failure:(FailureHandle)failure;</span><br></pre></td></tr></table></figure></p>
<p>ç®¡ç†ç±»è‡ªç„¶å¯ä»¥æš‚åœæŒ‡å®šçš„æŸä¸ªä¸‹è½½ï¼Œæ ¹æ®æŸä¸ªä¸‹è½½é“¾æ¥urlï¼Œæš‚åœæŸä¸ªä¸‹è½½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  æš‚åœä¸‹è½½</span><br><span class="line">*</span><br><span class="line">*  @param url ä¸‹è½½çš„é“¾æ¥</span><br><span class="line">*/</span><br><span class="line">-(void)cancelDownloadTask:(NSString *)url;</span><br></pre></td></tr></table></figure></p>
<p>ç®¡ç†ç±»å¯ä»¥æš‚åœæ‰€æœ‰ä¸‹è½½ä»»åŠ¡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  æš‚åœæ‰€æœ‰ä¸‹è½½</span><br><span class="line">*/</span><br><span class="line">-(void)cancelAllTasks;</span><br></pre></td></tr></table></figure></p>
<p>ç®¡ç†ç±»å¯ä»¥å½»åº•ç§»é™¤æŸä¸ªä¸‹è½½ä»»åŠ¡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  å½»åº•ç§»é™¤ä¸‹è½½ä»»åŠ¡</span><br><span class="line">*</span><br><span class="line">*  @param url  ä¸‹è½½é“¾æ¥</span><br><span class="line">*  @param path æ–‡ä»¶è·¯å¾„</span><br><span class="line">*/</span><br><span class="line">-(void)removeForUrl:(NSString *)url file:(NSString *)path;</span><br></pre></td></tr></table></figure></p>
<p>å½“ç„¶ç®¡ç†ç±»å¯ä»¥æ ¹æ®ä¸‹è½½é“¾æ¥urlè·å–ä¸Šä¸€æ¬¡çš„ä¸‹è½½è¿›åº¦ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  è·å–ä¸Šä¸€æ¬¡çš„ä¸‹è½½è¿›åº¦</span><br><span class="line">*</span><br><span class="line">*  @param url ä¸‹è½½é“¾æ¥</span><br><span class="line">*</span><br><span class="line">*  @return ä¸‹è½½è¿›åº¦</span><br><span class="line">*/</span><br><span class="line">-(float)lastProgress:(NSString *)url;</span><br></pre></td></tr></table></figure></p>
<p>ä»¥åŠè·å–æ–‡ä»¶å¤§å°ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  è·å–æ–‡ä»¶å·²ä¸‹è½½çš„å¤§å°å’Œæ€»å¤§å°,æ ¼å¼ä¸º:å·²ç»ä¸‹è½½çš„å¤§å°/æ–‡ä»¶æ€»å¤§å°,å¦‚ï¼š12.00M/100.00Mã€‚</span><br><span class="line">*</span><br><span class="line">*  @param url ä¸‹è½½é“¾æ¥</span><br><span class="line">*</span><br><span class="line">*  @return æœ‰æ–‡ä»¶å¤§å°åŠæ€»å¤§å°ç»„æˆçš„å­—ç¬¦ä¸²</span><br><span class="line">*/</span><br><span class="line">-(NSString *)filesSize:(NSString *)url;</span><br></pre></td></tr></table></figure></p>
<p>###ç®¡ç†ç±»çš„å®ç° FGGDownloadManager.m</p>
<ul>
<li>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æäº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¾ç½®äº†åŒæ—¶æœ€å¤šå…è®¸å¤šå°‘ä¸ªä¸‹è½½ä»»åŠ¡ã€‚</li>
<li>è¶…è¿‡æœ€å¤§ä¸‹è½½ä»»åŠ¡åï¼Œæ·»åŠ ä¸‹è½½ä»»åŠ¡å°†ä¼šè¢«æ·»åŠ è¿›å…¥ä¸‹è½½ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¤„äºç­‰å¾…æ¨¡å¼ã€‚</li>
<li>å½“å½“å‰æ­£åœ¨è¿›è¡Œçš„ä¸‹è½½ä»»åŠ¡æ•°å°äºå…è®¸æœ€å¤§åŒæ—¶ä¸‹è½½ä»»åŠ¡æ•°æ—¶ï¼Œé˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªä¸‹è½½ä»»åŠ¡å‡ºåˆ—ï¼ˆéµå¾ªå…ˆå…¥åˆ—çš„å…ˆå‡ºåˆ—ï¼‰ã€‚</li>
</ul>
<p>æ ¹æ®é€»è¾‘ï¼Œæˆ‘å®šåˆ¶äº†ä»¥ä¸‹æˆå‘˜å˜é‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@implementation FGGDownloadManager&#123;</span><br><span class="line"></span><br><span class="line">NSMutableDictionary         *_taskDict;</span><br><span class="line">/**</span><br><span class="line">*  æ’é˜Ÿå¯¹åˆ—</span><br><span class="line">*/</span><br><span class="line">NSMutableArray              *_queue;</span><br><span class="line">/**</span><br><span class="line">*  åå°è¿›ç¨‹id</span><br><span class="line">*/</span><br><span class="line">UIBackgroundTaskIdentifier  _backgroudTaskId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å•ä¾‹æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+(instancetype)shredManager</span><br><span class="line">&#123;</span><br><span class="line">static dispatch_once_t onceToken;</span><br><span class="line">dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">mgr=[[FGGDownloadManager alloc]init];</span><br><span class="line">&#125;);</span><br><span class="line">return mgr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ³¨å†Œappè¿›å…¥åå°ï¼Œappä¼šåˆ°å‰å°ï¼Œè¢«ç»ˆç»“ç­‰ï¼Œä»¥åŠç³»ç»Ÿå†…å­˜ä¸è¶³çš„é€šçŸ¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-(instancetype)init&#123;</span><br><span class="line"></span><br><span class="line">if(self=[super init])&#123;</span><br><span class="line"></span><br><span class="line">_taskDict=[NSMutableDictionary dictionary];</span><br><span class="line">_queue=[NSMutableArray array];</span><br><span class="line">_backgroudTaskId=UIBackgroundTaskInvalid;</span><br><span class="line">//æ³¨å†Œç³»ç»Ÿå†…å­˜ä¸è¶³çš„é€šçŸ¥</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(systemSpaceInsufficient:) name:FGGInsufficientSystemSpaceNotification object:nil];</span><br><span class="line">//æ³¨å†Œç¨‹åºä¸‹è½½å®Œæˆçš„é€šçŸ¥</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(downloadTaskDidFinishDownloading:) name:FGGDownloadTaskDidFinishDownloadingNotification object:nil];</span><br><span class="line">//æ³¨å†Œç¨‹åºå³å°†å¤±å»ç„¦ç‚¹çš„é€šçŸ¥</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(downloadTaskWillResign:) name:UIApplicationWillResignActiveNotification object:nil];</span><br><span class="line">//æ³¨å†Œç¨‹åºè·å¾—ç„¦ç‚¹çš„é€šçŸ¥</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(downloadTaskDidBecomActive:) name:UIApplicationDidBecomeActiveNotification object:nil];</span><br><span class="line">//æ³¨å†Œç¨‹åºå³å°†è¢«ç»ˆç»“çš„é€šçŸ¥</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(downloadTaskWillBeTerminate:) name:UIApplicationWillTerminateNotification object:nil];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ”¶åˆ°ç³»ç»Ÿå†…å­˜ä¸è¶³çš„é€šçŸ¥æ—¶ï¼Œå–æ¶ˆä¸‹è½½ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  æ”¶åˆ°ç³»ç»Ÿå­˜å‚¨ç©ºé—´ä¸è¶³çš„é€šçŸ¥è°ƒç”¨çš„æ–¹æ³•</span><br><span class="line">*</span><br><span class="line">*  @param sender ç³»ç»Ÿå­˜å‚¨ç©ºé—´ä¸è¶³çš„é€šçŸ¥</span><br><span class="line">*/</span><br><span class="line">-(void)systemSpaceInsufficient:(NSNotification *)sender&#123;</span><br><span class="line"></span><br><span class="line">NSString *urlString=[sender.userInfo objectForKey:@&quot;urlString&quot;];</span><br><span class="line">[[FGGDownloadManager shredManager] cancelDownloadTask:urlString];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¨‹åºå³å°†å¤±å»ç„¦ç‚¹ï¼Œå¼€å¯åå°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  æ”¶åˆ°ç¨‹åºå³å°†å¤±å»ç„¦ç‚¹çš„é€šçŸ¥ï¼Œå¼€å¯åå°è¿è¡Œ</span><br><span class="line">*</span><br><span class="line">*  @param sender é€šçŸ¥</span><br><span class="line">*/</span><br><span class="line">-(void)downloadTaskWillResign:(NSNotification *)sender&#123;</span><br><span class="line"></span><br><span class="line">if(_taskDict.count&gt;0)&#123;</span><br><span class="line"></span><br><span class="line">_backgroudTaskId=[[UIApplication sharedApplication] beginBackgroundTaskWithExpirationHandler:^&#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¨‹åºé‡æ–°è·å¾—ç„¦ç‚¹æ—¶ï¼Œå…³é—­åå°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  æ”¶åˆ°ç¨‹åºé‡æ–°å¾—åˆ°ç„¦ç‚¹çš„é€šçŸ¥ï¼Œå…³é—­åå°</span><br><span class="line">*</span><br><span class="line">*  @param sender é€šçŸ¥</span><br><span class="line">*/</span><br><span class="line">-(void)downloadTaskDidBecomActive:(NSNotification *)sender&#123;</span><br><span class="line"></span><br><span class="line">if(_backgroudTaskId!=UIBackgroundTaskInvalid)&#123;</span><br><span class="line"></span><br><span class="line">[[UIApplication sharedApplication] endBackgroundTask:_backgroudTaskId];</span><br><span class="line">_backgroudTaskId=UIBackgroundTaskInvalid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¨‹åºå³å°†è¢«ç»ˆç»“æ—¶ï¼Œå–æ¶ˆæ‰€æœ‰ä¸‹è½½ä»»åŠ¡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  ç¨‹åºå°†è¦ç»“æŸæ—¶ï¼Œå–æ¶ˆä¸‹è½½</span><br><span class="line">*</span><br><span class="line">*  @param sender é€šçŸ¥</span><br><span class="line">*/</span><br><span class="line">-(void)downloadTaskWillBeTerminate:(NSNotification *)sender&#123;</span><br><span class="line"></span><br><span class="line">[[FGGDownloadManager shredManager] cancelAllTasks];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ”¶åˆ°ä¸‹è½½å®Œæˆçš„é€šçŸ¥æ—¶ï¼Œä»æ’é˜Ÿé˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªä»»åŠ¡å‡ºåˆ—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  ä¸‹è½½å®Œæˆé€šçŸ¥è°ƒç”¨çš„æ–¹æ³•</span><br><span class="line">*</span><br><span class="line">*  @param sender é€šçŸ¥</span><br><span class="line">*/</span><br><span class="line">-(void)downloadTaskDidFinishDownloading:(NSNotification *)sender&#123;</span><br><span class="line"></span><br><span class="line">//ä¸‹è½½å®Œæˆåï¼Œä»ä»»åŠ¡åˆ—è¡¨ä¸­ç§»é™¤ä¸‹è½½ä»»åŠ¡ï¼Œè‹¥æ€»ä»»åŠ¡æ•°å°äºæœ€å¤§åŒæ—¶ä¸‹è½½ä»»åŠ¡æ•°ï¼Œ</span><br><span class="line">//åˆ™ä»æ’é˜Ÿå¯¹åˆ—ä¸­å–å‡ºä¸€ä¸ªä»»åŠ¡ï¼Œè¿›å…¥ä¸‹è½½</span><br><span class="line">NSString *urlString=[sender.userInfo objectForKey:@&quot;urlString&quot;];</span><br><span class="line">[_taskDict removeObjectForKey:urlString];</span><br><span class="line">if(_taskDict.count&lt;kFGGDwonloadMaxTaskCount)&#123;</span><br><span class="line"></span><br><span class="line">if(_queue.count&gt;0)&#123;</span><br><span class="line"></span><br><span class="line">NSDictionary *first=[_queue objectAtIndex:0];</span><br><span class="line"></span><br><span class="line">[self downloadWithUrlString:first[@&quot;urlString&quot;]</span><br><span class="line">toPath:first[@&quot;destinationPath&quot;]</span><br><span class="line">process:first[@&quot;process&quot;]</span><br><span class="line">completion:first[@&quot;completion&quot;]</span><br><span class="line">failure:first[@&quot;failure&quot;]];</span><br><span class="line">//ä»æ’é˜Ÿå¯¹åˆ—ä¸­ç§»é™¤ä¸€ä¸ªä¸‹è½½ä»»åŠ¡</span><br><span class="line">[_queue removeObjectAtIndex:0];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ·»åŠ ä¸‹è½½ä»»åŠ¡ï¼šåˆ¤æ–­æ˜¯å¦è¶…è¿‡å…è®¸çš„æœ€å¤§çš„å¹¶å‘ä»»åŠ¡æ•°ï¼Œè‹¥å¤§äºï¼Œåˆ™è¿›å…¥é˜Ÿåˆ—æ´¾å¯¹ï¼Œåä¹‹åˆ™æä¸€ä¸ªä¸‹è½½ç±»å»ä¸‹è½½è¿™ä¸ªä»»åŠ¡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-(void)downloadWithUrlString:(NSString *)urlString toPath:(NSString *)destinationPath process:(ProcessHandle)process completion:(CompletionHandle)completion failure:(FailureHandle)failure&#123;</span><br><span class="line"></span><br><span class="line">//è‹¥åŒæ—¶ä¸‹è½½çš„ä»»åŠ¡æ•°è¶…è¿‡æœ€å¤§åŒæ—¶ä¸‹è½½ä»»åŠ¡æ•°ï¼Œ</span><br><span class="line">//åˆ™æŠŠä¸‹è½½ä»»åŠ¡å­˜å…¥å¯¹åˆ—ï¼Œåœ¨ä¸‹è½½å®Œæˆåï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹è½½ã€‚</span><br><span class="line">if(_taskDict.count&gt;=kFGGDwonloadMaxTaskCount)&#123;</span><br><span class="line"></span><br><span class="line">NSDictionary *dict=@&#123;@&quot;urlString&quot;:urlString,</span><br><span class="line">@&quot;destinationPath&quot;:destinationPath,</span><br><span class="line">@&quot;process&quot;:process,</span><br><span class="line">@&quot;completion&quot;:completion,</span><br><span class="line">@&quot;failure&quot;:failure&#125;;</span><br><span class="line">[_queue addObject:dict];</span><br><span class="line"></span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">FGGDownloader *downloader=[FGGDownloader downloader];</span><br><span class="line">@synchronized (self) &#123;</span><br><span class="line">[_taskDict setObject:downloader forKey:urlString];</span><br><span class="line">&#125;</span><br><span class="line">[downloader downloadWithUrlString:urlString</span><br><span class="line">toPath:destinationPath</span><br><span class="line">process:process</span><br><span class="line">completion:completion</span><br><span class="line">failure:failure];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å–æ¶ˆä¸‹è½½ä»»åŠ¡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  å–æ¶ˆä¸‹è½½ä»»åŠ¡</span><br><span class="line">*</span><br><span class="line">*  @param url ä¸‹è½½çš„é“¾æ¥</span><br><span class="line">*/</span><br><span class="line">-(void)cancelDownloadTask:(NSString *)url&#123;</span><br><span class="line"></span><br><span class="line">FGGDownloader *downloader=[_taskDict objectForKey:url];</span><br><span class="line">[downloader cancel];</span><br><span class="line">@synchronized (self) &#123;</span><br><span class="line">[_taskDict removeObjectForKey:url];</span><br><span class="line">&#125;</span><br><span class="line">if(_queue.count&gt;0)&#123;</span><br><span class="line"></span><br><span class="line">NSDictionary *first=[_queue objectAtIndex:0];</span><br><span class="line"></span><br><span class="line">[self downloadWithUrlString:first[@&quot;urlString&quot;]</span><br><span class="line">toPath:first[@&quot;destinationPath&quot;]</span><br><span class="line">process:first[@&quot;process&quot;]</span><br><span class="line">completion:first[@&quot;completion&quot;]</span><br><span class="line">failure:first[@&quot;failure&quot;]];</span><br><span class="line">//ä»æ’é˜Ÿå¯¹åˆ—ä¸­ç§»é™¤ä¸€ä¸ªä¸‹è½½ä»»åŠ¡</span><br><span class="line">[_queue removeObjectAtIndex:0];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å–æ¶ˆæ‰€æœ‰ä¸‹è½½ä»»åŠ¡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-(void)cancelAllTasks&#123;</span><br><span class="line"></span><br><span class="line">[_taskDict enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) &#123;</span><br><span class="line">FGGDownloader *downloader=obj;</span><br><span class="line">[downloader cancel];</span><br><span class="line">[_taskDict removeObjectForKey:key];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å½»åº•ç§»é™¤ä¸‹è½½ä»»åŠ¡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*  å½»åº•ç§»é™¤ä¸‹è½½ä»»åŠ¡</span><br><span class="line">*</span><br><span class="line">*  @param url  ä¸‹è½½é“¾æ¥</span><br><span class="line">*  @param path æ–‡ä»¶è·¯å¾„</span><br><span class="line">*/</span><br><span class="line">-(void)removeForUrl:(NSString *)url file:(NSString *)path&#123;</span><br><span class="line"></span><br><span class="line">FGGDownloader *downloader=[_taskDict objectForKey:url];</span><br><span class="line">if(downloader)&#123;</span><br><span class="line">[downloader cancel];</span><br><span class="line">&#125;</span><br><span class="line">@synchronized (self) &#123;</span><br><span class="line">[_taskDict removeObjectForKey:url];</span><br><span class="line">&#125;</span><br><span class="line">NSUserDefaults *usd=[NSUserDefaults standardUserDefaults];</span><br><span class="line">NSString *totalLebgthKey=[NSString stringWithFormat:@&quot;%@totalLength&quot;,url];</span><br><span class="line">NSString *progressKey=[NSString stringWithFormat:@&quot;%@progress&quot;,url];</span><br><span class="line">[usd removeObjectForKey:totalLebgthKey];</span><br><span class="line">[usd removeObjectForKey:progressKey];</span><br><span class="line">[usd synchronize];</span><br><span class="line"></span><br><span class="line">NSFileManager *fileManager=[NSFileManager defaultManager];</span><br><span class="line">BOOL fileExist=[fileManager fileExistsAtPath:path];</span><br><span class="line">if(fileExist)&#123;</span><br><span class="line"></span><br><span class="line">[fileManager removeItemAtPath:path error:nil];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ®urlè·å–ä¸Šæ¬¡ä¸‹è½½è¿›åº¦ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-(float)lastProgress:(NSString *)url&#123;</span><br><span class="line"></span><br><span class="line">return [FGGDownloader lastProgress:url];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ®urlè·å–ä¸Šæ¬¡ä¸‹è½½å¤§å°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-(NSString *)filesSize:(NSString *)url&#123;</span><br><span class="line"></span><br><span class="line">return [FGGDownloader filesSize:url];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€ååœ¨é”€æ¯çš„æ—¶å€™ï¼Œç§»é™¤é€šçŸ¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-(void)dealloc&#123;</span><br><span class="line"></span><br><span class="line">[[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€åé™„ä¸Šæˆ‘çš„GitHubä»£ç åœ°å€ï¼š<a href="https://github.com/Insfgg99x/FGGDownloader" target="_blank" rel="external">FGGDownloader</a>ï¼Œæ¬¢è¿pull requestå’Œstar ~<br><img src="http://upload-images.jianshu.io/upload_images/937405-1e69ddd0ab142791.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[å‘å¸ƒå¼€æºé¡¹ç›®å‘å¸ƒåˆ°cocoapodsä¸Šå»]]></title>
      <url>http://cgpointzero.top/2016/09/03/cocoapods-release-project/</url>
      <content type="html"><![CDATA[<p>å‘å¸ƒå¼€æºé¡¹ç›®åˆ°cocoapodsä¸Šï¼Œå¯ä»¥è®©åˆ«äººç›´æ¥ç”¨cocoapodså¼•ç”¨ä½ çš„é¡¹ç›®ã€‚<br>é¦–å…ˆä½ éœ€è¦å®‰è£…cocoapodsï¼Œå¦‚æœä½ åœ¨å®‰è£…å‡ºç°äº†é—®é¢˜ï¼Œè¯·å‚è€ƒæˆ‘çš„è¿™ç¯‡å¸–å­ï¼š<br><a href="http://www.jianshu.com/p/7846ef67153f" target="_blank" rel="external">è§£å†³å®‰è£…cocoapodsä¸€ç›´å¡åœ¨Setting up master repos</a></p>
<p>######å‘å¸ƒé¡¹ç›®åˆ°cocoapodséœ€è¦å¦‚ä¸‹2ä¸ªæ–‡ä»¶ï¼š<br><code>LICENSE</code>å’Œ<code>podspec</code>ï¼Œå³å¼€æºè®¸å¯å’Œè§„æ ¼è¯´æ˜æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾:<br><img src="http://upload-images.jianshu.io/upload_images/937405-d8864eee92b83683.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###LICENSE<br>ä¸€èˆ¬é‡‡ç”¨<a href="https://opensource.org/licenses/MIT" target="_blank" rel="external">MIT</a>æ ¼å¼LICENSEå¦‚ä¸‹:<br><br><br><img src="http://upload-images.jianshu.io/upload_images/937405-77ba31f6bdfadc02.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>ç›´æ¥å»è¿™ä¸ªç½‘å€<a href="https://opensource.org/licenses/MIT" target="_blank" rel="external">MIT</a>æ‹·è´ä¸‹æ¥ç›´æ¥ä¿®æ”¹å¹´ä»½ä½œè€…å³å¯ï¼Œä¹Ÿå¯ä»¥æ‹¿Githubä¸Šåˆ«äººçš„LICENSEï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æ¥ä¿®æ”¹å¼€æºè®¸å¯ã€‚</p>
<p>###podspec<br>é¡¹ç›®çš„è§„æ ¼è¯´æ˜ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªpodspecï¼š</p>
<p><pre>Pod::Spec.new do |s|<br>s.name                  = â€œFGGDownloaderâ€<br>s.version               = â€œ1.0â€<br>s.ios.deployment_target = â€˜6.0â€™<br>s.summary               = â€œFGGDownloader is used for resume from break point downloading.â€<br>s.homepage              = â€œ<a href="https://github.com/Insfgg99x/FGGDownloader" target="_blank" rel="external">https://github.com/Insfgg99x/FGGDownloader</a>â€œ<br>s.license               = â€œMITâ€<br>s.authors               = { â€œCGPointZeroâ€ =&gt; â€œnewbox0512@yahoo.comâ€ }<br>s.source                = { :git =&gt; â€œ<a href="https://github.com/Insfgg99x/FGGDownloader.git" target="_blank" rel="external">https://github.com/Insfgg99x/FGGDownloader.git</a>â€œ, :tag =&gt; â€œ1.0â€ }<br>s.frameworks            = â€˜Foundationâ€™,â€™UIKitâ€™<br>s.source_files          = â€˜FGGDownloader/*.{h,m}â€™<br>s.requires_arc          = true<br>#s.dependency â€˜SDWebImageâ€™<br>#s.dependency â€˜popâ€™<br>end</pre></p>
<p>######æ¯ä¸€é¡¹éƒ½æœ‰è‡ªå·±çš„å«ä¹‰ï¼š</p>
<p><pre><br>s.nameï¼šåç§°ï¼Œ<b>pod search name</b> çš„ name<br>s.versionï¼šç‰ˆæœ¬å·<br>s.ios.deployment_target:æ”¯æŒçš„podæœ€ä½ç‰ˆæœ¬<br>s.summary: ç®€ä»‹<br>s.homepage:é¡¹ç›®çš„åœ°å€<br>s.license:å¼€æºè®¸å¯<br>s.author:ä½œè€…ä¿¡æ¯ï¼Œè¡¨ç¤ºæ ¼å¼ä¸º { â€œ[ä½œè€…å]â€ =&gt; â€œ[é‚®ç®±]â€ }<br>s.source:é¡¹ç›®çš„gitä»£ç ä»“åº“çš„åœ°å€ï¼Œå¦‚æ ¼å¼ä¸º:{:git =&gt; â€œ[gitä»£ç ä»“åº“åœ°å€]â€, tag =&gt; â€œ[ç‰ˆæœ¬å·]â€}<br>s.frameworks:è¡¨ç¤ºéœ€è¦çš„æ¡†æ¶,å¦‚â€™Foundationâ€™ï¼Œå¤šä¸ªæ¡†æ¶ä¹‹é—´ä»¥è‹±æ–‡é€—å·åˆ†éš”ã€‚<br>s.source_files:åˆ«äººé€šè¿‡ä½ çš„podå¼•ç”¨æ–‡ä»¶çš„å±‚çº§ç›®å½•ã€‚<br>å¦‚æˆ‘è¦å¼•ç”¨FGGDownloaderæ–‡ä»¶å¤¹ä¸‹çš„.hå’Œ.mæ–‡ä»¶ï¼Œåˆ™å¯ä»¥å†™æˆâ€™FGGDownloader/*.{h,m}â€™<br><img src="http://upload-images.jianshu.io/upload_images/937405-88b741350b73aab2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>s.requires_arc: æ˜¯å¦æ”¯æŒARC<br>s.dependencyï¼šä¾èµ–çš„é¡¹ç›®ï¼Œå¦‚æœ‰å¤šä¸ªï¼Œåˆ™å†™å¤šè¡Œ<br>#è¡¨ç¤ºæ³¨é‡Š<br></pre></p>
<p>###å¦‚ä½•ç”Ÿæˆpodspec<br>ä¸¤ç§æ–¹æ³•ï¼š<br>1.æ‹·è´åˆ«äººé¡¹ç›®çš„podspecæ–‡ä»¶ï¼Œä¿®æ”¹ä½œè€…ï¼Œç®€ä»‹ï¼Œä¾èµ–ç­‰è¯´æ˜ä¿¡æ¯ã€‚<br>2.ç”¨ä¸­ç«¯cdåˆ°é¡¹ç›®ç›®å½•ï¼Œè¾“å…¥<code>touch xxx.podspec</code>ç”Ÿæˆpodspecæ–‡ä»¶ï¼Œå…¶ä¸­xxxä»£è¡¨ä½ é¡¹ç›®çš„åå­—ï¼Œè·Ÿä¸Šé¢çš„<code>s.name</code>è¦ä¸€è‡´ã€‚</p>
<p>###éªŒè¯podspecæ–‡çš„æœ‰æ•ˆæ€§ï¼š<br>éªŒè¯podspecçš„æœ‰æ•ˆæ€§ï¼Œæ£€æŸ¥ä¿®å¤è¯­æ³•æˆ–è€…é€»è¾‘é”™è¯¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint xxx.podspec --verbose</span><br></pre></td></tr></table></figure></p>
<p>xxxä»£è¡¨ä½ çš„é¡¹ç›®åå­—ï¼Œè¦ä¸ä¸Šé¢çš„<code>s.name</code>ä¸€è‡´ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™ç§éªŒè¯æ–¹å¼ï¼Œå­˜åœ¨è­¦å‘Šä¹Ÿä¼šéªŒè¯ä¸é€šè¿‡ã€‚<br>æˆ‘ä»¬ç”¨å¯ä»¥å¿½ç•¥è­¦å‘Šçš„éªŒè¯æ–¹å¼(<code>--allow-warnings</code>)ï¼Œå¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint FGGDownloader.podspec --allow-warnings</span><br></pre></td></tr></table></figure></p>
<p>éªŒè¯è½¦æˆåŠŸåä¼šæç¤º<code>xxx.podspec passed validation.</code>ï¼Œå¦‚ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/937405-ff176f2aad7a6f60.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###ä¸ºä½ çš„é¡¹ç›®æ·»åŠ ç‰ˆæœ¬å·<br>å¼€æºè®¸å¯LICENSEå’Œpodspecéƒ½åšå¥½ä¹‹åï¼Œå°†é¡¹ç›®pushåˆ°ä½ çš„è¿œç¨‹ä»£ç ä»“åº“ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git  add .</span><br><span class="line">git commit -m&quot;æ·»åŠ å¼€æºè®¸å¯å’Œpodspec&quot; </span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<p>å‘å¸ƒå¼€æºé¡¹ç›®åˆ°cocoapodsä¸Šå»éœ€è¦æ·»åŠ ç‰ˆæœ¬å·ï¼Œç”¨<code>git tag</code>æ·»åŠ ç‰ˆæœ¬å·ã€‚<br><code>git tag -a 1.0.1 -m&quot;version 1.0.1&quot;</code><br>æ·»åŠ å®Œç‰ˆæœ¬å·åï¼Œç”¨â€™git tagâ€™å‘½ä»¤æŸ¥çœ‹tagæ˜¯å¦æ·»åŠ æˆåŠŸã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure></p>
<p>å°†æœ¬åœ°æ·»åŠ çš„tagåŒæ­¥åˆ°è¿œç¨‹ä»£ç ä»“åº“:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --tag</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ å¯¹<code>git tag</code>çš„æ“ä½œå­˜åœ¨é—®é¢˜ï¼Œè¯·å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.jianshu.com/p/f5461fe1787a" target="_blank" rel="external">å½©è‰²çš„git lg</a></p>
<p>###ä¸‡äº‹å…·å¤‡<br>ä¸Šé¢çš„å‡†å¤‡å·¥ä½œéƒ½åšå¥½äº†ï¼Œå¯ä»¥å‘cocoapodsæäº¤äº†ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>pod trunkå‘½ä»¤æäº¤æˆ‘ä»¬çš„å¼€æºé¡¹ç›®åˆ°cocoapods</code>ã€‚<br>ä½†æ˜¯ï¼Œå‰ææ˜¯ï¼Œä½ å¾—æ³¨å†Œäº†trunkè´¦å·ï¼Œç”¨<code>pod trunk me</code>éªŒè¯ä½ æ˜¯å¦æ³¨å†Œäº†:</p>
<p>######è‹¥ä¸æ˜¯å‡ºç°ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯çš„ï¼Œéƒ½æ˜¯æ²¡æ³¨å†Œçš„ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-368f30318753cc1e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###æ³¨å†Œtrunkè´¦å·<br>ä½¿ç”¨<code>pod trunk register</code>æ³¨å†Œè´¦å·ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod trunk register xxx.@xxx.xx &quot;ä½œè€…å&quot; --verbose</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„<code>xxx.@xxx.xx</code>è¡¨ç¤ºé‚®ç®±ï¼Œå¦‚123@yahoo.com.<br>â€“verboseé€‰é¡¹è¡¨ç¤ºè¾“å‡ºå¯è§æ€§.</p>
<p>æ³¨å†Œå¥½äº†ä¹‹åï¼Œç”¨<code>pod trunk me</code>éªŒè¯æ³¨å†Œä¿¡æ¯.</p>
<p>###å‘å¸ƒä»£ç åˆ°cocoapods<br>è¯¥æœ‰çš„éƒ½å‡†å¤‡å¥½äº†ï¼Œå‘å¸ƒå§ï¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod trunk push xxx.podspec --verbose</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„xxxè¡¨ç¤ºé¡¹ç›®åï¼Œè¦å’Œ<code>s.name</code>ä¿æŒä¸€è‡´.<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æäº¤å‘½ä»¤ï¼Œä¸å…è®¸ä½ çš„podspecæ–‡ä»¶å­˜åœ¨è­¦å‘Šã€‚è‹¥å­˜åœ¨è­¦å‘Šï¼Œåˆ™ä¸èƒ½é€šè¿‡æœ‰æ•ˆæ€§éªŒè¯ï¼Œå¯¼è‡´å‘å¸ƒå¤±è´¥ï¼</p>
<p>æˆ‘ä»¬å¯ä»¥åŠ ä¸Šå…è®¸è­¦å‘Šçš„é€‰é¡¹(â€“allow-warnings)å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod trunk push FGGDownloader.podspec --allow-warnings</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-5bd9fe2135ab2aa4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>éªŒè¯æ˜¯å¦å‘å¸ƒæˆåŠŸï¼š<br><code>pod search xxx</code><br>xxxè¡¨ç¤ºä½ çš„é¡¹ç›®åï¼Œè¦å’Œä¸Šé¢çš„<code>s.name</code> ä¿æŒä¸€è‡´ã€‚è‹¥èƒ½æŸ¥æ‰¾åˆ°ï¼Œè¡¨ç¤ºå‘å¸ƒæˆåŠŸã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥åœ¨<a href="https://cocoapods.org" target="_blank" rel="external">cocoapodså®˜ç½‘</a>æœç´¢ä½ çš„é¡¹ç›®æ¥éªŒè¯ï¼Œä½†ä¸€èˆ¬å®˜ç½‘å­˜åœ¨å»¶è¿Ÿï¼Œå‘å¸ƒåä¸èƒ½ç«‹å³æœå‡ºæ¥ï¼Œå¯èƒ½è¦ç­‰åˆ°ç¬¬äºŒå¤©ç”šè‡³ç¬¬ä¸‰å¤©ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-4643d30e062a2acb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åœ¨cocoapodså®˜ç½‘æœç´¢éªŒè¯"><br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[è§£å†³å®‰è£…cocoapodsä¸€ç›´å¡åœ¨Setting up master repos]]></title>
      <url>http://cgpointzero.top/2016/09/03/cocoapod-setup/</url>
      <content type="html"><![CDATA[<p>#é¦–å…ˆå¸è½½ä¹‹å‰å®‰è£…çš„cocoapods:<br>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š<code>which pod</code>ä¼šå¾—åˆ°ä¸€ä¸ªåœ°å€ï¼Œå¦‚<code>/usr/local/bin/pod</code><br>è¾“å…¥<code>sudo rm -rf /usr/local/bin/pod</code>åˆ é™¤podï¼Œåé¢çš„è·¯å¾„å°±æ˜¯ä¸Šé¢çš„è·¯å¾„</p>
<p>æ¥ç€è¾“å…¥<code>gem list</code>å¾—åˆ°å¦‚ä¸‹åˆ—è¡¨ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-2237beb0846859a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>##åˆ é™¤cocoapodséƒ¨åˆ†ï¼š<br><code>sudo gem uninstall cocoapods -v 1.0.1</code><br><code>sudo gem uninstall cocoapods-core -v 1.0.1</code>åé¢çš„v1.0.1æ ‡ç¤ºç‰ˆæœ¬</p>
<p>##éªŒè¯æ˜¯å¦åˆ é™¤æˆåŠŸï¼š<br><code>pod</code><br>å¾—åˆ°<code>-bash pod :command not found</code>è¡¨ç¤ºåˆ é™¤æˆåŠŸ</p>
<p>##ç§»é™¤åŸæ¥çš„æº<br><code>gem source -l</code><br><code>gem sources  -r https://rubygems.org/</code></p>
<p>##æ·»åŠ å›½å†…æº<br><code>gem sources -a https://gems.ruby-china.org/</code><br><code>gem source -l</code></p>
<p>##å®‰è£…cocoapods<br><code>sudo gem install cocoapods</code>è¾“å…¥å¼€æœºå¯†ç <br>è‹¥å®‰è£…è¿‡ç¨‹å‡ºç°å¦‚ä¸‹é—®é¢˜<br><code>ERROR:  While executing gem ... (Errno::EPERM)
Operation not permitted - /usr/bin/pod</code><br>è§£å†³åŠæ³•æ˜¯ï¼š<br><code>sudo gem install -n /usr/local/bin cocoapods</code>åé¢çš„è·¯å¾„æ˜¯ä¸Šé¢podçš„è·¯å¾„</p>
<p>##åˆå§‹åŒ–cocoapods<br>ä¸Šä¸€æ­¥å®‰è£…å®Œæˆä¹‹åï¼Œæ‰§è¡Œ<code>pod setup</code>è¿‡å‡ åˆ†é’Ÿåˆ°10åˆ†ä¹‹åå°±å®Œæˆåˆå§‹åŒ–äº†ã€‚</p>
<p>##éªŒè¯å®‰è£…å®Œæˆ<br><code>pod search FGGDownloader</code>å¾—åˆ°å¦‚ä¸‹ç»“æœè¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-5b2baa3024cad79a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[å½©è‰²çš„git lg]]></title>
      <url>http://cgpointzero.top/2016/09/01/colorfull_git/</url>
      <content type="html"><![CDATA[<p>#å°†git logæ›¿æ¢æˆgit lgï¼Œå¹¶ä¸”å½©è‰²æ˜¾ç¤ºï¼Œæ–¹ä¾¿æŸ¥çœ‹åŠå›æ»šåˆ°æŸä¸ªç‰ˆæœ¬ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/img/gitlog.png" alt="å½©è‰²çš„git lg"></p>
<p>#åªè¦åœ¨å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å›è½¦ï¼š</p>
<p>git config â€“global alias.lg â€œlog â€“color â€“graph â€“pretty=format:â€™%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Cresetâ€™ â€“abbrev-commitâ€</p>
<p>#ç„¶åå†git lgå°±å¯ä»¥çœ‹åˆ°å½©è‰²çš„æ—¥å¿—ã€‚</p>
<p>#é™„ä¸Šå¸¸ç”¨git å‘½ä»¤<br><code>1.åˆå§‹åŒ– git init<br>2.æŸ¥çœ‹çŠ¶æ€ï¼šgit status<br>3.æ·»åŠ æ–‡ä»¶ï¼šgit  add .<br>4.æäº¤ git commit -mâ€å¤‡æ³¨â€<br>5.æŸ¥çœ‹æ—¥å¿—ï¼šgit log<br>6.æŸ¥çœ‹å½“å‰åˆ†æ”¯ï¼šgit branch<br>7.æ‹‰å–æœ€æ–°ä»£ç ï¼šgit pull origin åˆ†æ”¯å<br>8.æ¨é€ä»£ç ï¼šgit push origin åˆ†æ”¯å<br>9.åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼šgit push origin :åˆ†æ”¯å<br>10.æ–°å»ºåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°æ–°å»ºçš„åˆ†æ”¯:git checkout -b æ–°åˆ†æ”¯å<br>11.å°†æ–°å»ºçš„åˆ†æ”¯æ¨é€åˆ°æœåŠ¡å™¨ï¼šgit push origin æ–°å»ºçš„åˆ†æ”¯å<br>12.åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼šgit branch -D åˆ†æ”¯å<br>13.åˆå¹¶æŸä¸ªåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼šgit merge éœ€è¦åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯å<br>14.å¼ºåˆ¶å›æ’¤åˆ°æŸæ¬¡æäº¤çš„ç‰ˆæœ¬ï¼šgit reset â€”hard ç‰ˆæœ¬å·çš„å‰6ä½(å¦‚ï¼šabe75e)<br>15.æ·»åŠ tagï¼šgit tag -a â€œæ ‡ç­¾åâ€ -mâ€å¤‡æ³¨â€<br>16.å°†æ·»åŠ çš„æ ‡ç­¾æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼šgit push â€”tag<br>17.è¿›å…¥åˆ°æŸå“¥tag:git checkout æ ‡ç­¾å<br>18.å¼ºåˆ¶å›æ’¤åˆ°æŸä¸ªæ ‡ç­¾ï¼šgit reset â€”hard æ ‡ç­¾å<br>19.åˆ é™¤æœ¬åœ°tagï¼šgit tag -d æ ‡ç­¾å<br>20.åˆ é™¤è¿œç¨‹çš„tagï¼šgit push origin -â€“delete tag æ ‡ç­¾å<br>21.åˆ é™¤gitè€Œä¸åˆ é™¤æ–‡ä»¶ï¼šfind . -name â€œ.git | xargs rm -Rf<br>22.æŸ¥çœ‹gitè¿œç¨‹ä»“åº“åœ°å€ï¼šgit remote -v<br>23.ç§»é™¤è¿œç¨‹çš„gitåœ°å€ï¼šgit remote rm origin<br></code></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[JSPatchçƒ­è¡¥ä¸å®æ—¶ä¿®å¤bug]]></title>
      <url>http://cgpointzero.top/2016/08/19/JSPatchABC/</url>
      <content type="html"><![CDATA[<p>###èƒŒæ™¯<br>åœ¨iOSå¼€å‘ä¸­ï¼Œå­˜åœ¨bugä¿®å¤å‘¨æœŸé•¿çš„é—®é¢˜ã€‚è‹¥ç¨‹åºå‡ºäº†bugï¼Œå¾€å¾€éœ€è¦èµ°ä¸€ä¸‹æ­¥éª¤ï¼š<br>ä¿®æ”¹ä»£ç â€“æ‰“åŒ…â€“æäº¤å®¡æ ¸(â€“å®¡æ ¸è¢«æ‹’â€“ä¿®æ”¹ä»£ç â€“å†æ¬¡æäº¤å®¡æ ¸)â€“ç”¨æˆ·æ›´æ–°ã€‚<br>éœ€è¦å¾ˆé•¿ä¸€ä¸ªå‘¨æœŸæ‰èƒ½è§£å†³é—®é¢˜ã€‚è€ŒJSPatchçš„å‡ºç°ï¼Œæœ‰æ•ˆçš„è§£å†³äº†è¿™ä¸€å°´å°¬çš„å±€é¢ã€‚</p>
<p>###çƒ­ä¿®å¤<br>ä¸€ç§å³æ—¶ä¿®å¤bugçš„æŠ€æœ¯ï¼Œä¹Ÿå«hotfixã€‚</p>
<p>###ä»€ä¹ˆæ˜¯JSPatchï¼Ÿ<br><a href="https://github.com/bang590/JSPatch" target="_blank" rel="external">JSPatch</a>æ˜¯ä¸€ä¸ªä¸€ä¸ªåŠ¨æ€æ›´æ–°çš„å¼€æºçš„æ¡†æ¶ï¼Œå¯ä»¥å®æ—¶çš„ä¿®å¤bug(çƒ­ä¿®å¤)ã€æ·»åŠ æ–°åŠŸèƒ½ã€‚ä»æœåŠ¡å™¨ä¸‹å‘è¡¥ä¸jsè¡¥ä¸ä»£ç ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°è¡¥ä¸åï¼Œè¿›è¡Œå®‰å…¨æ ¡éªŒï¼Œç„¶åç”¨JSè°ƒç”¨æˆ–æ›¿æ¢åŸæ¥crashçš„OCæ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°å®æ—¶ä¿®å¤bugçš„ç›®çš„ï¼Œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-1f31b1129e5a164b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###ç¤ºä¾‹<br>å‡å¦‚ï¼Œåœ¨<code>LeftViewControler</code>çš„<code>tableView:didSelectRowAtIndexPath:</code>æ–¹æ³•ä¸­å­˜åœ¨ä¸€ä¸ªæ•°ç»„è¶Šç•Œçš„crashï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath&#123;</span><br><span class="line"></span><br><span class="line">//---------------crash----------------</span><br><span class="line">NSArray *array=@[@&quot;1&quot;,@&quot;2&quot;,@&quot;3&quot;];</span><br><span class="line">for(int i=0;i&lt;4;i++)&#123;</span><br><span class="line">NSLog(@&quot;%@&quot;,array[i]); //ç¨‹åºä¸­å‡ºç°çš„crash(æ•°ç»„è¶Šç•Œ)</span><br><span class="line">&#125;</span><br><span class="line">//---------------crash---------------</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯ç”¨jsä¸‹å‘ä¸€æ®µè¿™æ ·çš„ä»£ç ï¼Œè¾¾åˆ°å®æ—¶ä¿®å¤bugçš„ç›®çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">defineClass(&apos;LeftViewController&apos;, &#123;</span><br><span class="line">tableView_didSelectRowAtIndexPath: function(tableView, indexPath) &#123;</span><br><span class="line"></span><br><span class="line">var array = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;];</span><br><span class="line">for (var i = 0; i &lt; array.count(); i++) &#123;</span><br><span class="line">NSLog(&quot;%&quot;, array[i]); </span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­å¼•å…¥JSPatchï¼Œç„¶ååœ¨åœ¨è‡ªå·±æ­å»ºä¸‹å‘è¡¥ä¸çš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨<a href="http://jspatch.com" target="_blank" rel="external">JSPatchå¹³å°</a>é›†æˆçš„å¸¦ä»£ç ä¸‹å‘åŠŸèƒ½çš„SDKï¼Œæˆ‘ä»¬åªéœ€è¦å†™å¥½è¡¥ä¸ï¼Œç›´æ¥å°±å¯ä»¥åœ¨è¿™ä¸ªå¹³å°ä¸‹å‘äº†ã€‚</p>
<p>###æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šåœ¨<a href="http://jspatch.com" target="_blank" rel="external">JSPatchå¹³å°</a>æ³¨å†Œä¸€ä¸ªå¸å·ï¼›</li>
<li>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä¸€ä¸ªappï¼›</li>
<li>ç¬¬ä¸‰æ­¥ï¼šä¸‹è½½JSPatch SDKï¼Œè¿™ä¸ªè·Ÿgithubä¸Šçš„ä¸ä¸€æ ·ï¼Œgithubä¸Šçš„æ˜¯å¼€æºçš„ï¼Œä¸å¸¦ä»£ç ä¸‹å‘æœåŠ¡å™¨çš„ã€‚</li>
<li>ç¬¬å››æ­¥ï¼šç”ŸæˆRSAå…¬é’¥å’Œç§é’¥ã€‚<br>æ‰“å¼€ç»ˆç«¯ï¼Œcdåˆ°Desktop/ï¼Œè¾“å…¥<code>openssl</code>åæŒ‰å›è½¦ï¼Œè¾“å…¥ä»¥ä¸‹ä¸‰è¡ŒæŒ‡ä»¤ï¼Œ<br><code>genrsa -out rsa_private_key.pem 1024</code><br><code>pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM â€“nocrypt</code><br><code>rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</code><br>åœ¨æ¡Œé¢æ—¶å°±ä¼šå¾—åˆ°2ä¸ª<code>.pem</code>æ–‡ä»¶ï¼Œåˆ†åˆ«æ—¶å…¬é’¥å’Œç§é’¥ã€‚ç§é’¥ç”¨äºæœåŠ¡ç«¯ç”²ç±³ä¸‹å‘çš„è¡¥ä¸ï¼Œå…¬é’¥ç”¨äºå®¢æœç«¯è§£å¯†è¡¥ä¸ã€‚</li>
<li><p>ç¬¬äº”æ­¥ï¼šæŒ‰ç…§æ–‡æ¡£é›†æˆSDKåˆ°æ–‡æ¡£ä¸­ã€‚<br>åœ¨<code>application:didFinishLaunchingWithOptions:</code>æ–¹æ³•ä¸­å¯¹<code>JSPatch</code>åˆå§‹åŒ–<br>`<br>//åˆå§‹åŒ–JSPatch<br>-(void)setupJSPatch{</p>
<p>  [JSPatch startWithAppKey:kJSPatchKey];<br>  [JSPatch setupRSAPublicKey:kRSAPublicKey];<br>  [JSPatch setupLogger:^(NSString *msg) {</p>
<pre><code>NSLog(@&quot;%@&quot;,msg);
</code></pre><p>  }];<br>  //[JSPatch testScriptInBundle];//æ²™ç›’æµ‹è¯•<br>  [JSPatch sync];<br>}<code>å…¶ä¸­ï¼Œ</code>appkey<code>æ˜¯å¹³å°ä¸Šåˆ›å»ºappå¾—åˆ°çš„appkeyï¼Œè€Œ</code>pullic key<code>åˆ™æ˜¯ä¸Šæ­¥ç”Ÿæˆçš„</code>RSAå…¬é’¥<code>ï¼Œæ³¨æ„è¦æ‰‹åŠ¨åŠ æ¢è¡Œ(\n)ã€‚å¦‚:</code>@â€â€”â€“BEGIN PUBLIC KEYâ€”â€“\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC1heHjbL+R6nulhIRptjfGmd3M\nlUâ€¦\nâ€”â€“END PUBLIC KEYâ€”â€“â€ã€‚<br>`</p>
</li>
<li><p>ä¸‹å‘è¡¥ä¸æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè®¡ç®—è¡¥ä¸æ–‡ä»¶(js)æ–‡ä»¶çš„<code>MD5</code>å€¼ï¼Œç„¶åè®²è¿™ä¸ªMD5å€¼ç”¨<code>RSAç§é’¥ç­¾å</code>ï¼Œç­¾ååçš„å­—ç¬¦ä¸²è·Ÿè¡¥ä¸ä¸€èµ·ä¸‹å‘åˆ°å®¢æˆ·ç«¯ã€‚</p>
</li>
<li><p>å®¢æˆ·ç«¯æ‹¿åˆ°ç­¾ååçš„å­—ç¬¦ä¸²åï¼Œç”¨å…¬é’¥è¿›è¡Œ<code>è§£å¯†</code>ï¼Œå¾—åˆ°ä¸€ä¸ªMD5å€¼ï¼Œè®¡ç®—å¾—åˆ°è„šæœ¬çš„MD5å€¼ï¼Œæ¯”è¾ƒè¿™ä¸¤ä¸ªMD5å€¼ï¼Œè‹¥ä¸€æ”¯ï¼Œè¯´æ˜è¡¥ä¸<code>æ²¡è¢«ç¯¡æ”¹</code>ã€‚è‹¥æ— ç¯¡æ”¹ï¼Œåˆ™åœ¨è¿è¡Œæ—¶é€šè¿‡æ–¹æ³•äº¤æ¢ï¼Œæ›¿æ¢æ‰æˆ‘ä»¬çš„crashä»£ç ã€‚</p>
</li>
<li><p>ç¬¬å…­æ­¥ï¼šæˆ‘ä»¬ç”¨åœ¨æ¡Œé¢ä¸Šæ–°å»ºä¸€ä¸ª<code>main.js</code>æ–‡ä»¶ï¼Œæ‰“å¼€å‘½ä»¤åï¼Œ<code>cd</code>åˆ°æ¡Œé¢ï¼Œè¾“å…¥<code>touch main.js</code>åå›è½¦ï¼Œåœ¨æ¡Œé¢å°±ä¼šç”Ÿæˆä¸€ä¸ª<code>main.js</code>æ–‡ä»¶ï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ã€‚<br>å†™å…¥æˆ‘ä»¬è‡ªå·±çš„æ–¹æ³•æ›¿æ¢æ‰crashéƒ¨åˆ†çš„ä»£ç çš„æ‰€åœ¨çš„æ–¹æ³•ã€‚</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">defineClass(&apos;LeftViewController&apos;, &#123;</span><br><span class="line"></span><br><span class="line">Â  Â  tableView_didSelectRowAtIndexPath: function(tableView, indexPath) &#123;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  var array = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;];</span><br><span class="line">Â  Â  Â  Â  for (var i = 0; i &lt; array.count(); i++) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  NSLog(&quot;%&quot;, array[i]);</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥ç”¨<a href="https://github.com/bang590/JSPatchConvertor/blob/gh-pages/JSPatchConvertor.zip" target="_blank" rel="external">JSPatchConverter</a>ç›´æ¥å°†å†™å¥½çš„<code>OC</code>è½¬æˆ<code>Patch</code>ï¼Œå¤§éƒ¨åˆ†å¯ä»¥ç›´æ¥è½¬ï¼Œä½†<code>ç§æœ‰å˜é‡/é™æ€å˜é‡/å®</code>è¿™äº›è¿˜ä¸æ”¯æŒï¼Œæ‰€ä»¥è½¬æ¢åéœ€è¦<b>æ‰‹åŠ¨ä¿®æ”¹</b>ã€‚å¯ä»¥å€ŸåŠ©è¿™ä¸ªå·¥å…·ï¼Œçœå»åŸæœ¬è¦å…ˆå†™å¥½<code>OC</code>ä»£ç ï¼Œåœ¨ç¿»è¯‘æˆ<code>Patch</code>çš„æ—¶é—´æˆæœ¬ã€‚</p>
<ul>
<li><p>ç¬¬ä¸ƒæ­¥ï¼šæµ‹è¯•è¡¥ä¸çš„æœ‰æ•ˆæ€§<br>åœ¨ä¸‹å‘è¡¥ä¸ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯è¡¥ä¸æ˜¯å¦å‡‘æ•ˆï¼Œå…·ä½“åšæ³•æ˜¯ï¼š<br>å°†æˆ‘ä»¬åˆšåˆšç¼–è¾‘çš„main.jså¯¼å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œé€‰æ‹©copyã€‚åœ¨JSPatchåˆå§‹åŒ–çš„æ–¹æ³•ä¸­ï¼Œæ‰“å¼€æ²™ç›’æµ‹è¯•æ–¹æ³•<code>[JSPatch testScriptInBundle];</code>ï¼Œå¹¶æ³¨é‡Šæ‰å…¶ä»–JSPathchæ–¹æ³•ã€‚è¿è¡Œç¨‹åºï¼Œè¯¥æµ‹è¯•æ–¹æ³•ä¼šè‡ªåŠ¨åœ¨æ²™ç›’ä¸‹å¯»æ‰¾<code>main.js</code>æ–‡ä»¶å¹¶æ‰§è¡Œï¼Œä»¥éªŒè¯bugæ˜¯å¦è¢«ä¿®å¤ã€‚</p>
</li>
<li><p>ç¬¬å…«æ­¥ï¼šä¸‹å‘è¡¥ä¸<br>åœ¨ä¸Šä¸€æ­¥è¡¥ä¸æœ‰æ•ˆæ€§éªŒè¯æˆåŠŸä¹‹åï¼Œå»<a href="http://jspatch.com" target="_blank" rel="external">JSPatchå¹³å°</a>ä¸‹å‘è¡¥ä¸ã€‚<br>è¡¥ä¸é€‰æ‹©åˆšåˆšçš„<code>main.js</code>ï¼Œç§é’¥é€‰æ‹©åˆšåˆšç”Ÿæˆçš„ç§é’¥<code>private_key.pem</code>æ–‡ä»¶ï¼Œæäº¤ã€‚<br>æ³¨æ„ï¼šAppç‰ˆæœ¬å·è¦è·Ÿ<code>Bundle versions string, short</code>ç‰ˆæœ¬å·ä¸€è‡´ï¼</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-19df86d4b89682cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li>ç¬¬ä¹æ­¥ï¼šè¿è¡Œappï¼Œå†æ¬¡åœ¨<code>LeftViewController</code>çš„é€‰æ‹©cellï¼Œä¹‹å‰é€‰æ‹©cellå¯¼è‡´crashå¾—åˆ°äº†ä¿®å¤!<br>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»åœ¨ä¸ç”¨é‡æ–°æäº¤ç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œå®Œæˆäº†bugçš„å®æ—¶ä¿®å¤ã€‚</li>
</ul>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»åœ¨ä¸ç”¨é‡æ–°æäº¤ç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œå®Œæˆäº†bugçš„å®æ—¶ä¿®å¤ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ä¸¤ç§æ–¹æ³•å®ç°UILabelå›¾æ–‡å¹¶èŒ‚çš„æ˜¾ç¤ºhtmlæ–‡æœ¬]]></title>
      <url>http://cgpointzero.top/2016/08/17/label-html/</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡è®²è¿°ç”¨2ä¸­æ–¹æ³•åœ¨UILabelä¸­æ˜¾ç¤ºå¸¦å›¾ç‰‡å’Œæ–‡å­—çš„HTMLæ–‡æœ¬ã€‚<br>å…ˆé¢„è§ˆä¸‹æ˜¾ç¤ºæ•ˆæœï¼š<br><img src="http://upload-images.jianshu.io/upload_images/937405-164214672d8ab9e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ˜¾ç¤ºæ•ˆæœ"><br>å¦‚æœä½ çš„è®¾å¤‡æ—¶iOS 9æˆ–ä»¥ä¸Šï¼Œé»˜è®¤åªå…è®¸HTTPSï¼Œè¯·æ‰“å¼€HTTPè¯·æ±‚è®¸å¯ï¼Œå‚ç…§:<a href="http://www.jianshu.com/p/800637cce334" target="_blank" rel="external">iOS 9æ‰“å¼€HTTPè¯·æ±‚è®¸å¯</a></p>
<p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼š</p>
<pre>
//HTMLæ–‡æœ¬ åŒ…å«å›¾ç‰‡ã€æ–‡æœ¬
NSString *htmlString=@"< img src=http://upload-images.jianshu.io/upload_images/937405-50a8ad2d8866fc12.png>&nbsp&nbspèŠ±ç¾Šç¾Šé¢†å–äº†ä½ çš„<font color="\"red\""><a>çº¢åŒ…</a></font>"
UILabel \*label=[UILabel alloc] initWithFrame:CGRectMake(50, 200, 220, 20)];
[self.view addSubview:label];
UIFont \*font=[UIFont systemFontOfSize:14];
label.font=font;
NSDictionary \\*optoins=@{NSDocumentTypeDocumentAttribute:NSHTMLTextDocumentType,
                            NSFontAttributeName:font};
NSData \*data=[htmlString dataUsingEncoding:NSUnicodeStringEncoding];
NSAttributedString \*attributeString=[[NSAttributedString alloc] initWithData:data
                                                                     options:optoins
                                                          documentAttributes:nil
                                                                       error:nil];
label.attributedText=attributeString;
</pre>
æ–¹æ¡ˆä¸€ç‚¹è¯„ï¼š
è¿™ç§æ–¹æ¡ˆåªæ˜¯å®ç°äº†æ˜¾ç¤ºï¼Œæ˜¾ç¤ºæ•ˆæœå¥½ä¸å¥½æ˜¯å¦ä¸€å›äº‹ã€‚äº‹å®è¯æ˜ï¼Œè¿™ç§æ–¹æ¡ˆçš„æ˜¾ç¤ºæ•ˆæœå¾ˆä¸å¥½ï¼š

![æ–¹æ¡ˆä¸€æ˜¾ç¤ºæ•ˆæœ](http://upload-images.jianshu.io/upload_images/937405-d810311964b43dab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æˆ‘ä»¬ç°åœ¨è¦å¯¹æ–¹æ¡ˆä¸€è¿›è¡Œä¼˜åŒ–ã€‚

æ–¹æ¡ˆä¸€ä¼˜åŒ–æ€è·¯ï¼š1.ç¼©å°å›¾ç‰‡ï¼Œè®©å›¾ç‰‡ä¸å­—ä½“æ˜¾ç¤ºå·®ä¸å¤šå¤§ï¼›
2.è®©å­—ä½“æ˜¾ç¤ºå‚ç›´æ–¹å‘å±…ä¸­ã€‚

ä¼˜åŒ–åçš„æ–¹æ¡ˆä¸€ï¼š

<pre>
//HTMLæ–‡æœ¬ åŒ…å«å›¾ç‰‡ã€æ–‡æœ¬
NSString *htmlString=@"< img src=http://upload-images.jianshu.io/upload_images/937405-50a8ad2d8866fc12.png>&nbsp&nbspèŠ±ç¾Šç¾Šé¢†å–äº†ä½ çš„<font color="\"red\""><a>çº¢åŒ…</a></font>"
//æˆ‘ä»¬å¯ä»¥å…ˆæŠŠsrcå¯¹åº”çš„å›¾ç‰‡è§£æå‡ºæ¥ï¼Œæ”¾åˆ°æœ¬åœ°
NSRange httpRange=[htmlString rangeOfString:@"http://"];
NSRange endRange=[htmlString rangeOfString:@".png"];
NSString \*picString=[htmlString substringWithRange:NSMakeRange(httpRange.location, endRange.location+endRange.length-httpRange.location)];
[[SDWebImageDownloader sharedDownloader] downloadImageWithURL:[NSURL URLWithString:picString] options:nil progress:nil completed:^(UIImage \\*image, NSData \\*data, NSError \*error, BOOL finished) {
    //æŒ‰ç…§å­—ä½“å¤§å°ç¼©å°å›¾ç‰‡ï¼Œå…·ä½“å®ç°åœ¨ä¸‹æ–‡
     UIImage \\*scaledImage=[self scaleImage:image font:font];
     NSData \*imgData=UIImagePNGRepresentation(scaledImage);
     NSString \\*libPath=[NSSearchPathForDirectoriesInDomains(NSLibraryDirectory,     NSUserDomainMask, YES) lastObject];
    NSString \\*cachePath=[libPath stringByAppendingPathComponent:@"Caches"];
    NSString \\*scaledImagesPath=[cachePath stringByAppendingPathComponent:@"scaledImages"];
    if(![[NSFileManager defaultManager] fileExistsAtPath:scaledImagesPath]){
        [[NSFileManager defaultManager] createDirectoryAtPath:scaledImagesPath withIntermediateDirectories:YES attributes:nil error:nil];
    }
NSString\\ *picName=[[picString componentsSeparatedByString:@"/"] lastObject];
    NSString \\*filePath=[scaledImagesPath stringByAppendingPathComponent:picName];
    [imgData writeToFile:filePath atomically:YES];
    NSString \\*path=[NSURL fileURLWithPath:filePath].absoluteString;
//ç”¨æœ¬åœ°çš„å›¾ç‰‡è·¯å¾„æ›¿æ¢è¿œç¨‹å›¾ç‰‡è·¯å¾„
htmlString=[htmlString stringByReplacingOccurrencesOfString:picString withString:path];
}];
UILabel \\*label=[UILabel alloc] initWithFrame:CGRectMake(50, 200, 220, 20)];
[self.view addSubview:label];
UIFont \\*font=[UIFont systemFontOfSize:14];
label.font=font;
NSDictionary \\*optoins=@{NSDocumentTypeDocumentAttribute:NSHTMLTextDocumentType,
                            NSFontAttributeName:font};
NSData \\*data=[htmlString dataUsingEncoding:NSUnicodeStringEncoding];
NSAttributedString \\*attributeString=[[NSAttributedString alloc] initWithData:data
                                                                     options:optoins
                                                          documentAttributes:nil
                                                                       error:nil];
label.attributedText=attributeString;
</pre>

<p><img src="http://upload-images.jianshu.io/upload_images/937405-aeaca04c3819680c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¼˜åŒ–åçš„æ–¹æ¡ˆä¸€æ˜¾ç¤ºæ•ˆæœ"></p>
<p>ä¼˜åŒ–åçš„æ–¹æ¡ˆä¸€æ˜¾ç¤ºæ•ˆæœå·®å¼ºäººæ„ã€‚è¿™ç§æ–¹æ³•æˆåŠŸçš„è§£å†³äº†å›¾ç‰‡å¤§å°çš„é—®é¢˜ï¼Œä»¥åŠæ–‡æœ¬ä¸å±…ä¸­çš„é—®é¢˜ï¼Œä½†å›¾ç‰‡æ²¡æœ‰å±…ä¸­å¯¹é½ï¼Œç½‘ä¸Šä¹Ÿæ‰¾ä¸åˆ°æ–¹æ³•ï¼Œåªæœ‰ç»§ç»­æ¢å¯»ã€‚</p>
<p>æ–¹æ¡ˆäºŒï¼š</p>
<pre>
//HTMLæ–‡æœ¬ åŒ…å«å›¾ç‰‡ã€æ–‡æœ¬
NSString *htmlString=@"< img src=http://upload-images.jianshu.io/upload_images/937405-50a8ad2d8866fc12.png>&nbsp&nbspèŠ±ç¾Šç¾Šé¢†å–äº†ä½ çš„<font color="\"red\""><a>çº¢åŒ…</a></font>"
//æˆ‘ä»¬å¯ä»¥å…ˆæŠŠsrcå¯¹åº”çš„å›¾ç‰‡è§£æå‡ºæ¥ï¼Œæ”¾åˆ°æœ¬åœ°
NSRange httpRange=[htmlString rangeOfString:@"http://"];
NSRange endRange=[htmlString rangeOfString:@".png"];
NSString \*picString=[htmlString substringWithRange:NSMakeRange(httpRange.location, endRange.location+endRange.length-httpRange.location)];
UIImage \*scaledImage;
[[SDWebImageDownloader sharedDownloader] downloadImageWithURL:[NSURL URLWithString:picString] options:nil progress:nil completed:^(UIImage \*image, NSData \*data, NSError \*error, BOOL finished) {
    //æŒ‰ç…§å­—ä½“å¤§å°ç¼©å°å›¾ç‰‡ï¼Œå…·ä½“å®ç°åœ¨ä¸‹æ–‡
     scaledImage=[self scaleImage:image font:font];
     NSData \*imgData=UIImagePNGRepresentation(scaledImage);
     NSString \*libPath=[NSSearchPathForDirectoriesInDomains(NSLibraryDirectory,     NSUserDomainMask, YES) lastObject];
    NSString \*cachePath=[libPath stringByAppendingPathComponent:@"Caches"];
    NSString \*scaledImagesPath=[cachePath stringByAppendingPathComponent:@"scaledImages"];
    if(![[NSFileManager defaultManager] fileExistsAtPath:scaledImagesPath]){
        [[NSFileManager defaultManager] createDirectoryAtPath:scaledImagesPath withIntermediateDirectories:YES attributes:nil error:nil];
    }
NSString \\*picName=[[picString componentsSeparatedByString:@"/"] lastObject];
    NSString \\*filePath=[scaledImagesPath stringByAppendingPathComponent:picName];
    [imgData writeToFile:filePath atomically:YES];
//ç”¨ç©ºå­—ç¬¦ä¸²æ›¿æ¢è¿œç¨‹å›¾ç‰‡è·¯å¾„
htmlString=[htmlString stringByReplacingOccurrencesOfString:picString withString:@""];
}];


UILabel \*label=[UILabel alloc] initWithFrame:CGRectMake(50, 200, 220, 20)];
[self.view addSubview:label];
UIFont \*font=[UIFont systemFontOfSize:14];
label.font=font;
//åˆ©ç”¨NSTextAttachmentæ–‡UILabelæ·»åŠ å›¾ç‰‡ï¼Œå¹¶è°ƒæ•´ä½ç½®å®ç°å±…ä¸­å¯¹é½
NSTextAttachment *attach=[[NSTextAttachment alloc] init];
attach.bounds=CGRectMake(2, -(label.frame.size.height-font.pointSize)/2, 12, 14);
attach.image=scaledImage;
NSMutableAttributedString \*componets=[[NSMutableAttributedString alloc] init];
NSAttributedString \*imagePart=[NSAttributedString attributedStringWithAttachment:attach];
[componets appendAttributedString:imagePart];
NSDictionary \*optoins=@{NSDocumentTypeDocumentAttribute:NSHTMLTextDocumentType,
                            NSFontAttributeName:font};
NSData \*data=[htmlString dataUsingEncoding:NSUnicodeStringEncoding];
NSAttributedString \*textPart=[[NSAttributedString alloc] initWithData:data
                                                                     options:optoins
                                                          documentAttributes:nil
                                                                       error:nil];
[componets appendAttributedString:textPart];
label.attributedText=componets;
</pre>

<p><img src="http://upload-images.jianshu.io/upload_images/937405-e31040e80be7cc90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–¹æ¡ˆäºŒçš„æ˜¾ç¤ºæ•ˆæœ"><br>ç‚¹è¯„ï¼š<br>æ–¹æ¡ˆäºŒæ˜¾ç¤ºæ•ˆæœç•¥å¤æ‚ï¼Œä½†æ˜¯è¾¾åˆ°äº†æˆ‘ä»¬éœ€è¦çš„æ­£å¸¸æ˜¾ç¤ºæ•ˆæœã€‚</p>
<p>æœ€åï¼Œé™„ä¸Šæ ¹æ®å­—ä½“å¤§å°ç¼©å°å›¾ç‰‡çš„æ–¹æ³•ï¼š</p>
<pre>
-(UIImage \*)scaleImage:(UIImage \*)origin font:(UIFont \*)font{

    CGFloat imgH=origin.size.height;
    CGFloat imgW=origin.size.width;
    CGFloat width;
    CGFloat height;
    CGFloat fontHeight=font.pointSize;
    if(imgW>imgH){

        width=fontHeight;
        height=fontHeight/imgW\*imgH;
    }
    else{
        height=fontHeight;
        width=fontHeight/imgH\*imgW;
    }
    UIGraphicsBeginImageContext(CGSizeMake(width, height));
    [origin drawInRect:CGRectMake(0, 0, width, height)];
    UIImage \*scaledImage=UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    return scaledImage;
}
</pre>

<p><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[class_copyIvarListçš„å®ç”¨ä¸¾ä¾‹]]></title>
      <url>http://cgpointzero.top/2016/05/26/Ivar/</url>
      <content type="html"><![CDATA[<p>å½“ä¸€ä¸ªæ¨¡å‹æœ‰å¾ˆå¤šå±æ€§ï¼Œç»™å®šçš„éœ€æ±‚éœ€è¦è·å–æ‰€æœ‰çš„å±æ€§çš„æ—¶å€™ï¼Œå¦‚æœä¸€ä¸ªä¸€ä¸ªå†™ï¼Œæ•ˆç‡å¾ˆä½ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨class_copyIvarListè§£å†³äº†ã€‚<br>ä¾‹å¦‚æœ‰è¿™æ ·ä¸€ä¸ªç±»ï¼š</p>
<p><pre></pre></p>
<p>#import <foundation foundation.h=""></foundation></p>
<p>@interface Model : NSObject</p>
<p>@property(nonatomic,copy)NSString *name;<br>@property(nonatomic,copy)NSString *sex;<br>@property(nonatomic,copy)NSString *idno;<br>@property(nonatomic,copy)NSString *address;<br>@property(nonatomic,copy)NSString *mobile;</p>
<p>+(instancetype)modelWithValues:(NSArray *)values;</p>
<p>@end<br><br>ç°åœ¨éœ€è¦è·å–ä»–çš„ä»¥key=valueçš„å½¢å¼æ‰“å°å…¶æ‰€æœ‰å±æ€§åŠå…¶å€¼ã€‚å°±å¯ä»¥è¿™æ ·å†™äº†ï¼š<br><code><br>-(NSString <em>)description{<br>    unsigned int count=0;<br>    Ivar </em>list=class_copyIvarList([self class], &amp;count);<br>    NSMutableArray <em>resultArray=[NSMutableArray array];<br>    for(int i=0;i&lt;count;i++){<br>        Ivar var=list[i];<br>        NSString </em>varName=[NSString stringWithUTF8String:ivar_getName(var)];<br>        //å»æ‰å‰é¢çš„ä¸‹åˆ’çº¿<br>        NSString *tmp=[varName substringFromIndex:1];<br>        SEL method=NSSelectorFromString(tmp);</code></p>
<pre><code>    #pragma clang diagnostic push
    #pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot;
    id value=[self performSelector:method];
    #pragma clang diagnostic pop
    if(!value||value==NULL){
        value=@&quot;&quot;;
    }
    NSString *item=[NSString stringWithFormat:@&quot;%@=%@&quot;,tmp,value];

    [resultArray addObject:item];
}
free(list);
return [resultArray componentsJoinedByString:@&quot;&amp;&quot;];
</code></pre><p>}<br></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[runtimeè¿è¡Œæ—¶æ–¹æ³•æ›¿æ¢çš„ç”¨æ³•]]></title>
      <url>http://cgpointzero.top/2016/05/26/runtime/</url>
      <content type="html"><![CDATA[<p>åœ¨loadæ–¹æ³•ä¸­ï¼Œç”¨fc_viewDidLoadæ›¿æ¢viewDidLoadï¼š</p>
<pre>
/**
 *  åœ¨loadä¸­äº¤æ¢viewDidLoadå’Œfc_viewDidLoad
 */
+(void)load{

    static dispatch_once_t onceToken;
    dispatch_once(&onceToken,^{

        xgf_swizzleSelector([self class], @selector(viewDidLoad), @selector(xgf_viewDidLoad));

        /*Method m1=class_getInstanceMethod([self class], @selector(viewDidLoad));
        Method m2=class_getInstanceMethod([self class], @selector(fc_viewDidLoad));
        BOOL notImplemented=class_addMethod([self class], @selector(viewDidLoad), method_getImplementation(m2), method_getTypeEncoding(m2));
        if(!notImplemented){
        method_exchangeImplementations(m1, m2);
        }
        */
    });
}
static inline void xgf_swizzleSelector(Class class,SEL originalSelector,SEL swizzledSelector){

    Method originalMethod=class_getInstanceMethod(class, originalSelector);
    Method swizzledMethod=class_getInstanceMethod(class, swizzledSelector);
    if(class_addMethod(class, 
                       originalSelector, 
                       method_getImplementation(swizzledMethod),
                       method_getTypeEncoding(swizzledMethod))){
        class_replaceMethod(class, swizzledSelector,
                            method_getImplementation(originalMethod), 
                            method_getTypeEncoding(originalMethod));
    }else{
        method_exchangeImplementations(originalMethod, swizzledMethod);
    }
}
</pre><pre>
/**
 *  [self xgf_viewDidLoad] å…¶å®æ˜¯è°ƒç”¨äº†viewDidLoadçš„å®ç°
 */
-(void)xgf_viewDidLoad{
    NSLog(@"%s",__func__);
    [self xgf_viewDidLoad];
}
</pre>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[UITableViewè‡ªå®šä¹‰å¤šé€‰åˆ é™¤æ ·å¼]]></title>
      <url>http://cgpointzero.top/2015/11/26/multiple/</url>
      <content type="html"><![CDATA[<p>Model.h</p>
<pre>#import <foundation foundation.h="">
@interface Model : NSObject
@property(nonatomic,strong)NSString *desc;
+(instancetype)modelWithDesc:(NSString *)desc;
@end</foundation></pre>
Model.m
<pre>#import "Model.h"

@implementation Model

+(instancetype)modelWithDesc:(NSString *)desc
{
    Model *m=[Model new];
    m.desc=desc;
    return m;
}
@end</pre>
CustomCell.h
<pre>#import <uikit uikit.h="">

@interface CustomCell : UITableViewCell

@property(nonatomic,strong)UILabel *titleLb;
@property(nonatomic,strong)UIButton *selectBtn;

@end</uikit></pre>
CustomCell.m
<pre>#import "CustomCell.h"
#define kWidth ([UIScreen mainScreen].bounds.size.width)

@implementation CustomCell

- (void)awakeFromNib {
}

- (void)setSelected:(BOOL)selected animated:(BOOL)animated {
    [super setSelected:selected animated:animated];
}
-(id)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier
{
    if(self=[super initWithStyle:style reuseIdentifier:reuseIdentifier])
    {
        self.backgroundColor=[UIColor blackColor];
        [self createUI];
        self.selectionStyle=UITableViewCellSelectionStyleNone;
    }
    return self;
}
-(void)createUI
{
    for(UIView *sub in self.contentView.subviews)
        [sub removeFromSuperview];

    //é€‰æ‹©æŒ‰é’®
    self.selectBtn=[[UIButton alloc]initWithFrame:CGRectMake(-20, 10, 20, 20)];
    [self.selectBtn setImage:[UIImage imageNamed:@"un_select"] forState:UIControlStateNormal];
    [self .selectBtn setImage:[UIImage imageNamed:@"select"] forState:UIControlStateSelected];
    [self.contentView addSubview:self.selectBtn];
    //é»˜è®¤éšè—
    self.selectBtn.hidden=YES;

    // æ ‡é¢˜Lb
    self.titleLb=[[UILabel alloc]initWithFrame:CGRectMake(20, 0,kWidth-40, 40)];
    self.titleLb.textColor=[UIColor whiteColor];
    [self.contentView addSubview:self.titleLb];
}
@end</pre>
EditViewController.h
<pre>#import <uikit uikit.h="">

@interface EditViewController : UIViewController

@end</uikit></pre>
EditViewController.m
<pre>#import "EditViewController.h"
#import "CustomCell.h"
#import "Model.h"

#define kWidth ([UIScreen mainScreen].bounds.size.width)
#define kHeight ([UIScreen mainScreen].bounds.size.height)
#define RGB(r,g,b) ([UIColor colorWithRed:(r)/255.0f green:(g)/255.0f blue:(b)/255.0f alpha:1.0f])

@interface EditViewController ()<uitableviewdatasource,uitableviewdelegate>
{
    UITableView *_tbView;
    NSMutableArray *_dataArray;
    NSMutableArray *_delArray;
}
//åº•éƒ¨å·¥å…·æ 
@property(nonatomic,strong)UIView *toolView;

@end

@implementation EditViewController

- (void)viewDidLoad
{
    [super viewDidLoad];
    [self setUp];
    [self initDataArray];
    [self createTbView];
    [self createBottomTools];
}
//åˆå§‹è®¾ç½®
-(void)setUp
{
    self.automaticallyAdjustsScrollViewInsets=NO;
    //å¯¼èˆªè§†å›¾
    UIView *naviView=[[UIView alloc]initWithFrame:CGRectMake(0, 0, kWidth, 64)];
    naviView.backgroundColor=RGB(157, 25, 36);
    [self.view addSubview:naviView];
    //å¯¼èˆªæ æ ‡é¢˜
    UILabel *titleLb=[[UILabel alloc]initWithFrame:CGRectMake(0, 20, kWidth, 44)];
    titleLb.text=@"ç¼–è¾‘åˆ†ç»„";
    titleLb.textColor=[UIColor whiteColor];
    titleLb.textAlignment=NSTextAlignmentCenter;
    titleLb.font=[UIFont systemFontOfSize:20];
    [naviView addSubview:titleLb];
    //ç¼–è¾‘æŒ‰é’®
    UIButton *rightBtn=[[UIButton alloc]initWithFrame:CGRectMake(kWidth-60, 27, 40, 30)];
    [rightBtn setTitle:@"ç¼–è¾‘" forState:UIControlStateNormal];
    [rightBtn setTitle:@"å®Œæˆ" forState:UIControlStateSelected];
    [rightBtn addTarget:self action:@selector(editAction:) forControlEvents:UIControlEventTouchUpInside];
    [self.view addSubview:rightBtn];
}
//åˆå§‹åŒ–æ•°ç»„
-(void)initDataArray
{
    //åˆå§‹åŒ–æ•°æ®æºæ•°ç»„
    _dataArray=[NSMutableArray array];

    [_dataArray addObject:[Model modelWithDesc:@"æˆ‘çš„è‡ªé€‰"]];
    [_dataArray addObject:[Model modelWithDesc:@"æˆ‘å…³æ³¨çš„ç‰›è‚¡"]];
    [_dataArray addObject:[Model modelWithDesc:@"ç¯ä¿ç‰›è‚¡"]];
    //åˆå§‹åŒ–åˆ é™¤æ•°ç»„
    _delArray=[NSMutableArray array];
}
//ç‚¹å‡»ç¼–è¾‘æŒ‰é’®æ‰§è¡Œçš„æ–¹æ³•
-(void)editAction:(UIButton *)sender
{
    [_tbView setEditing:!_tbView.isEditing animated:YES];
    sender.selected=!sender.isSelected;

    if(sender.isSelected)
    {
        NSArray *allCells=[_tbView visibleCells];
        for(CustomCell *cell in allCells)
        {
            cell.selectBtn.hidden=NO;
            cell.selectBtn.selected=NO;
        }
        //æ˜¾ç¤ºåº•éƒ¨toolView
        [self showToolView];
    }
    else
    {
        NSArray *allCells=[_tbView visibleCells];
        for(CustomCell *cell in allCells)
            cell.selectBtn.hidden=YES;

        //éšè—åº•éƒ¨toolView
        [self hideToolView];

        //æ‰§è¡Œåˆ é™¤
        [_dataArray removeObjectsInArray:_delArray];
        //æ¸…ç©ºåˆ é™¤æ•°ç»„
        [_delArray removeAllObjects];
        //åˆ·æ–°è¡¨è§†å›¾
        [_tbView reloadData];
    }
}
//è¡¨è§†å›¾
-(void)createTbView
{
    _tbView=[[UITableView alloc]initWithFrame:CGRectMake(0, 64, kWidth, kHeight-64)];
    _tbView.delegate=self;
    _tbView.dataSource=self;
    _tbView.backgroundColor=[UIColor blackColor];
    _tbView.separatorColor=[UIColor whiteColor];
    _tbView.separatorStyle=UITableViewCellSeparatorStyleSingleLine;
    [self.view addSubview:_tbView];
    _tbView.scrollEnabled=NO;
    _tbView.allowsSelectionDuringEditing=YES;
    _tbView.tableFooterView=[UIView new];
}
//åº•éƒ¨å·¥å…·æ 
-(void)createBottomTools
{
    _toolView=[[UIView alloc]initWithFrame:CGRectMake(0, kHeight, kWidth, 49)];
    _toolView.backgroundColor=[UIColor darkGrayColor];
    [self.view addSubview:_toolView];

    //å…¨é€‰æŒ‰é’®
    UIButton *selectAllBtn=[[UIButton alloc]initWithFrame:CGRectMake(10, 14.5, 20, 20)];
    [selectAllBtn setImage:[UIImage imageNamed:@"un_all_select"] forState:UIControlStateNormal];
    [selectAllBtn setImage:[UIImage imageNamed:@"select"] forState:UIControlStateSelected];
    [selectAllBtn addTarget:self action:@selector(selectAllRows:) forControlEvents:UIControlEventTouchUpInside];
    selectAllBtn.tag=100;
    [_toolView addSubview:selectAllBtn];

    //å»é€‰lb
    UILabel *selectAllLb=[[UILabel alloc]initWithFrame:CGRectMake(CGRectGetMaxX(selectAllBtn.frame)+5, 14.5, 40, 20)];
    selectAllLb.textColor=[UIColor whiteColor];
    selectAllLb.text=@"å…¨é€‰";
    selectAllLb.textAlignment=NSTextAlignmentCenter;
    [_toolView addSubview:selectAllLb];

    //åˆ é™¤æ•°é‡
    UILabel *deleteCountLb=[[UILabel alloc]initWithFrame:CGRectMake(kWidth-70, 14.5, 60, 20)];
    deleteCountLb.text=@"åˆ é™¤(0)";
    deleteCountLb.textAlignment=NSTextAlignmentCenter;
    deleteCountLb.textColor=[UIColor whiteColor];
    deleteCountLb.tag=111;
    [_toolView addSubview:deleteCountLb];

    //é»˜è®¤éšè—
    _toolView.hidden=YES;
}
//å…¨é€‰
-(void)selectAllRows:(UIButton *)sender
{
    sender.selected=!sender.isSelected;
    if(_delArray.count<_dataarray.count) {="" for(model="" *m="" in="" _dataarray)="" if(![_delarray="" containsobject:m])="" [_delarray="" addobject:m];="" }="" nsarray="" *allcells="[_tbView" visiblecells];="" for(customcell="" *cell="" allcells)="" cell.selectbtn.selected="YES;" else="" removeallobjects];="" [self="" refreshdeletecountlb];="" æ˜¾ç¤ºå·¥å…·æ ="" -(void)showtoolview="" __weak="" typeof(self)="" weakself="self;" uilabel="" *deletecountlb="(UILabel" *)[self.toolview="" viewwithtag:111];="" deletecountlb.text="@"åˆ é™¤(0)";" self.toolview.hidden="NO;" å…¨é€‰æ ‡è®°ç½®ä¸ºå¦="" uibutton="" *selectallbtn="(UIButton" viewwithtag:100];="" selectallbtn.selected="NO;" [uiview="" animatewithduration:0.3="" animations:^{="" cgfloat="" ypos="weakSelf.toolView.frame.origin.y;" weakself.toolview.frame="CGRectMake(0," ypos,="" kwidth,="" 49);="" }];="" éšè—å·¥å…·æ ="" -(void)hidetoolview="" }completion:^(bool="" finished)="" weakself.toolview.hidden="YES;" åˆ·æ–°åˆ é™¤æ•°é‡lb="" -(void)refreshdeletecountlb="" stringwithformat:@"åˆ é™¤(%ld)",_delarray.count];="" #pragma="" mark="" -="" uitableview="" -(nsinteger)tableview:(uitableview="" *)tableview="" numberofrowsinsection:(nsinteger)section="" return="" _dataarray.count;="" -(cgfloat)tableview:(uitableview="" heightforrowatindexpath:(nsindexpath="" *)indexpath="" 40;="" -(uitableviewcell="" *)tableview:(uitableview="" cellforrowatindexpath:(nsindexpath="" static="" nsstring="" *cid="@"cid";" customcell="" *cel="[tableView" dequeuereusablecellwithidentifier:cid];="" if(!cel)="" cel="[[CustomCell" alloc]initwithstyle:uitableviewcellstyledefault="" reuseidentifier:cid];="" model="" *model="_dataArray[indexPath.row];" cel.titlelb.text="model.desc;" cel;="" ç¼–è¾‘æ ·å¼="" -(uitableviewcelleditingstyle)tableview:(uitableview="" editingstyleforrowatindexpath:(nsindexpath="" uitableviewcelleditingstylenone;="" ç§»åŠ¨="" -(void)tableview:(uitableview="" moverowatindexpath:(nsindexpath="" *)sourceindexpath="" toindexpath:(nsindexpath="" *)destinationindexpath="" äº¤æ¢æ•°æ®="" [_dataarray="" exchangeobjectatindex:sourceindexpath.row="" withobjectatindex:destinationindexpath.row];="" é€‰ä¸­æ—¶æ‰§è¡Œçš„é€»è¾‘="" didselectrowatindexpath:(nsindexpath="" if(_tbview.isediting)="" è‹¥é€‰æ‹©äº†æ‰€æœ‰è¡Œï¼Œåˆ™å°†å…¨é€‰æ ‡è®°ç½®ä¸ºæ˜¯="" if(_delarray.count="=_dataArray.count)" å…¨é€‰æ ‡è®°ç½®ä¸ºæ˜¯="" *)[_tbview="" cellforrowatindexpath:indexpath];="" removeobject:m];="" ç½®ä¸ºæœªé€‰ä¸­="" åˆ·æ–°åˆ é™¤æ•°lb="" @end="" <="" pre="">
Appdelegate.m
<pre>
ï¼ƒimport "AppDelegate.h"
ï¼ƒimport "EditViewController.h"
@interface AppDelegate ()
@end
@implementation AppDelegate
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    EditViewController *edit=[EditViewController new];
    UINavigationController *navi=[[UINavigationController alloc]initWithRootViewController:edit];
    navi.navigationBar.hidden=YES;
    navi.navigationBar.barStyle=UIBarStyleBlack;
    self.window.rootViewController=navi;
    return YES;
}</pre>

<p><img src="http://upload-images.jianshu.io/upload_images/937405-8a6d5aadc54c8000.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"><br>æœ€åé™„ä¸Š<a href="https://github.com/Insfgg99x/MultiDeleteAndMove" target="_blank" rel="external">GitHubæºç åœ°å€</a></p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-231806b43dc36e61.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</_dataarray.count)></uitableviewdatasource,uitableviewdelegate></pre>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[iOSé™æ€åº“çš„åˆ¶ä½œ]]></title>
      <url>http://cgpointzero.top/2015/11/03/static/</url>
      <content type="html"><![CDATA[<p><a href="http://www.jianshu.com/p/d70a51be5af1" target="_blank" rel="external">iOSé™æ€åº“çš„åˆ¶ä½œ</a></p>
]]></content>
    </entry>
    
  
  
</search>
