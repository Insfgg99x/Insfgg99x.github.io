<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="平凡的世界我们终将平凡而过，拥有不平凡的斗志，才能成就自己的不平凡！">
<meta property="og:type" content="website">
<meta property="og:title" content="CGPointZero">
<meta property="og:url" content="http://cgpointzero.top/index.html">
<meta property="og:site_name" content="CGPointZero">
<meta property="og:description" content="平凡的世界我们终将平凡而过，拥有不平凡的斗志，才能成就自己的不平凡！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CGPointZero">
<meta name="twitter:description" content="平凡的世界我们终将平凡而过，拥有不平凡的斗志，才能成就自己的不平凡！">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> CGPointZero </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">CGPointZero</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/03/cocoapods-release-project/" itemprop="url">
                  发布开源项目发布到cocoapods上去
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-03T20:15:44+08:00" content="2016-09-03">
              2016-09-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/03/cocoapods-release-project/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/03/cocoapods-release-project/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>发布开源项目到cocoapods上，可以让别人直接用cocoapods引用你的项目。<br>首先你需要安装cocoapods，如果你在安装出现了问题，请参考我的这篇帖子：<br><a href="http://www.jianshu.com/p/7846ef67153f" target="_blank" rel="external">解决安装cocoapods一直卡在Setting up master repos</a></p>
<p>######发布项目到cocoapods需要如下2个文件：<br><code>LICENSE</code>和<code>podspec</code>，即开源许可和规格说明文件，如下图:<br><img src="http://upload-images.jianshu.io/upload_images/937405-d8864eee92b83683.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###LICENSE<br>一般采用<a href="https://opensource.org/licenses/MIT" target="_blank" rel="external">MIT</a>格式LICENSE如下:<br><br><br><img src="http://upload-images.jianshu.io/upload_images/937405-77ba31f6bdfadc02.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>直接去这个网址<a href="https://opensource.org/licenses/MIT" target="_blank" rel="external">MIT</a>拷贝下来直接修改年份作者即可，也可以拿Github上别人的LICENSE，用文本编辑器打开来修改开源许可。</p>
<p>###podspec<br>项目的规格说明，如下面这个podspec：</p>
<p><pre>Pod::Spec.new do |s|<br>s.name                  = “FGGDownloader”<br>s.version               = “1.0”<br>s.ios.deployment_target = ‘6.0’<br>s.summary               = “FGGDownloader is used for resume from break point downloading.”<br>s.homepage              = “<a href="https://github.com/Insfgg99x/FGGDownloader" target="_blank" rel="external">https://github.com/Insfgg99x/FGGDownloader</a>“<br>s.license               = “MIT”<br>s.authors               = { “CGPointZero” =&gt; “newbox0512@yahoo.com” }<br>s.source                = { :git =&gt; “<a href="https://github.com/Insfgg99x/FGGDownloader.git" target="_blank" rel="external">https://github.com/Insfgg99x/FGGDownloader.git</a>“, :tag =&gt; “1.0” }<br>s.frameworks            = ‘Foundation’,’UIKit’<br>s.source_files          = ‘FGGDownloader/*.{h,m}’<br>s.requires_arc          = true<br>#s.dependency ‘SDWebImage’<br>#s.dependency ‘pop’<br>end</pre></p>
<p>######每一项都有自己的含义：</p>
<p><pre><br>s.name：名称，<b>pod search name</b> 的 name<br>s.version：版本号<br>s.ios.deployment_target:支持的pod最低版本<br>s.summary: 简介<br>s.homepage:项目的地址<br>s.license:开源许可<br>s.author:作者信息，表示格式为 { “[作者名]” =&gt; “[邮箱]” }<br>s.source:项目的git代码仓库的地址，如格式为:{:git =&gt; “[git代码仓库地址]”, tag =&gt; “[版本号]”}<br>s.frameworks:表示需要的框架,如’Foundation’，多个框架之间以英文逗号分隔。<br>s.source_files:别人通过你的pod引用文件的层级目录。<br>如我要引用FGGDownloader文件夹下的.h和.m文件，则可以写成’FGGDownloader/*.{h,m}’<br><img src="http://upload-images.jianshu.io/upload_images/937405-88b741350b73aab2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>s.requires_arc: 是否支持ARC<br>s.dependency：依赖的项目，如有多个，则写多行<br>#表示注释<br></pre></p>
<p>###如何生成podspec<br>两种方法：<br>1.拷贝别人项目的podspec文件，修改作者，简介，依赖等说明信息。<br>2.用中端cd到项目目录，输入<code>touch xxx.podspec</code>生成podspec文件，其中xxx代表你项目的名字，跟上面的<code>s.name</code>要一致。</p>
<p>###验证podspec文的有效性：<br>验证podspec的有效性，检查修复语法或者逻辑错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint xxx.podspec --verbose</span><br></pre></td></tr></table></figure></p>
<p>xxx代表你的项目名字，要与上面的<code>s.name</code>一致。<br>需要注意的是：这种验证方式，存在警告也会验证不通过。<br>我们用可以忽略警告的验证方式(<code>--allow-warnings</code>)，如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint FGGDownloader.podspec --allow-warnings</span><br></pre></td></tr></table></figure></p>
<p>验证车成功后会提示<code>xxx.podspec passed validation.</code>，如：<br><img src="http://upload-images.jianshu.io/upload_images/937405-ff176f2aad7a6f60.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###为你的项目添加版本号<br>开源许可LICENSE和podspec都做好之后，将项目push到你的远程代码仓库。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git  add .</span><br><span class="line">git commit -m&quot;添加开源许可和podspec&quot; </span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<p>发布开源项目到cocoapods上去需要添加版本号，用<code>git tag</code>添加版本号。<br><code>git tag -a 1.0.1 -m&quot;version 1.0.1&quot;</code><br>添加完版本号后，用’git tag’命令查看tag是否添加成功。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure></p>
<p>将本地添加的tag同步到远程代码仓库:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --tag</span><br></pre></td></tr></table></figure></p>
<p>如果你对<code>git tag</code>的操作存在问题，请参考我的这篇文章：<a href="http://www.jianshu.com/p/f5461fe1787a" target="_blank" rel="external">彩色的git lg</a></p>
<p>###万事具备<br>上面的准备工作都做好了，可以向cocoapods提交了。<br>我们可以通过<code>pod trunk命令提交我们的开源项目到cocoapods</code>。<br>但是，前提是，你得注册了trunk账号，用<code>pod trunk me</code>验证你是否注册了:</p>
<p>######若不是出现类似如下信息的，都是没注册的：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-368f30318753cc1e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###注册trunk账号<br>使用<code>pod trunk register</code>注册账号：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod trunk register xxx.@xxx.xx &quot;作者名&quot; --verbose</span><br></pre></td></tr></table></figure></p>
<p>上面的<code>xxx.@xxx.xx</code>表示邮箱，如123@yahoo.com.<br>–verbose选项表示输出可见性.</p>
<p>注册好了之后，用<code>pod trunk me</code>验证注册信息.</p>
<p>###发布代码到cocoapods<br>该有的都准备好了，发布吧！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod trunk push xxx.podspec --verbose</span><br></pre></td></tr></table></figure></p>
<p>上面的xxx表示项目名，要和<code>s.name</code>保持一致.<br>需要注意的是，这种提交命令，不允许你的podspec文件存在警告。若存在警告，则不能通过有效性验证，导致发布失败！</p>
<p>我们可以加上允许警告的选项(–allow-warnings)如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod trunk push FGGDownloader.podspec --allow-warnings</span><br></pre></td></tr></table></figure></p>
<p>验证是否发布成功：<br><code>pod search xxx</code><br>xxx表示你的项目名，要和上面的<code>s.name</code> 保持一致。若能查找到，表示发布成功。</p>
<p>你也可以在<a href="https://cocoapods.org" target="_blank" rel="external">cocoapods官网</a>搜索你的项目来验证，但一般官网存在延迟，发布后不能立即搜出来，可能要等到第二天甚至第三天。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-4643d30e062a2acb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="在cocoapods官网搜索验证"><br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/03/cocoapod-setup/" itemprop="url">
                  解决安装cocoapods一直卡在Setting up master repos
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-03T18:06:09+08:00" content="2016-09-03">
              2016-09-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/03/cocoapod-setup/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/03/cocoapod-setup/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#首先卸载之前安装的cocoapods:<br>打开终端，输入：<code>which pod</code>会得到一个地址，如<code>/usr/local/bin/pod</code><br>输入<code>sudo rm -rf /usr/local/bin/pod</code>删除pod，后面的路径就是上面的路径</p>
<p>接着输入<code>gem list</code>得到如下列表：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-2237beb0846859a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>##删除cocoapods部分：<br><code>sudo gem uninstall cocoapods -v 1.0.1</code><br><code>sudo gem uninstall cocoapods-core -v 1.0.1</code>后面的v1.0.1标示版本</p>
<p>##验证是否删除成功：<br><code>pod</code><br>得到<code>-bash pod :command not found</code>表示删除成功</p>
<p>##移除原来的源<br><code>gem source -l</code><br><code>gem sources  -r https://rubygems.org/</code></p>
<p>##添加国内源<br><code>gem sources -a https://gems.ruby-china.org/</code><br><code>gem source -l</code></p>
<p>##安装cocoapods<br><code>sudo gem install cocoapods</code>输入开机密码<br>若安装过程出现如下问题<br><code>ERROR:  While executing gem ... (Errno::EPERM)
Operation not permitted - /usr/bin/pod</code><br>解决办法是：<br><code>sudo gem install -n /usr/local/bin cocoapods</code>后面的路径是上面pod的路径</p>
<p>##初始化cocoapods<br>上一步安装完成之后，执行<code>pod setup</code>过几分钟到10分之后就完成初始化了。</p>
<p>##验证安装完成<br><code>pod search FGGDownloader</code>得到如下结果表示安装成功：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/937405-5b2baa3024cad79a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/01/colorfull_git/" itemprop="url">
                  彩色的git lg
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-01T00:30:18+08:00" content="2016-09-01">
              2016-09-01
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/01/colorfull_git/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/01/colorfull_git/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#将git log替换成git lg，并且彩色显示，方便查看及回滚到某个版本，效果如下：<br><img src="/img/gitlog.png" alt="彩色的git lg"></p>
<p>#只要在命令行输入以下命令回车：</p>
<p>git config –global alias.lg “log –color –graph –pretty=format:’%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset’ –abbrev-commit”</p>
<p>#然后再git lg就可以看到彩色的日志。</p>
<p>#附上常用git 命令<br><code>1.初始化 git init<br>2.查看状态：git status<br>3.添加文件：git  add .<br>4.提交 git commit -m”备注”<br>5.查看日志：git log<br>6.查看当前分支：git branch<br>7.拉取最新代码：git pull origin 分支名<br>8.推送代码：git push origin 分支名<br>9.删除远程分支：git push origin :分支名<br>10.新建分支，并切换到新建的分支:git checkout -b 新分支名<br>11.将新建的分支推送到服务器：git push origin 新建的分支名<br>12.删除本地分支：git branch -D 分支名<br>13.强制回撤到某次提交的版本：git reset —hard 版本号的前6位(如：abe75e)<br>14.添加tag：git tag -a “标签名” -m”备注”<br>15.将添加的标签推送到远程服务器：git push —tag<br>16.进入到某哥tag:git checkout 标签名<br>17.强制回撤到某哥标签：git reset —hard 标签名<br>18.删除本地tag：git tag -d 标签名<br></code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/19/JSPatchABC/" itemprop="url">
                  JSPatch热补丁实时修复bug
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-19T01:30:18+08:00" content="2016-08-19">
              2016-08-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/19/JSPatchABC/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/19/JSPatchABC/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>在iOS开发中，存在一个问题，若程序出了bug，需要先Xcode修复--打包--提交审核--用户更新。
</code></pre><p>才能得到解决，周期很长。JSPatch的出现，解决了这个烦恼。<br>它是一个动态更新框架，不仅可以实时的修复bug(热修复，也叫hotfix技术)，<br>还可以实时的添加新功能。操作简单，只需要引入小小的引擎文件，就可以用JS调用和替换任意OC方法。</p>
<p><img src="/img/jspatch_01.png" alt="JSPatch实时修复bug"></p>
<pre><code>JSPatch是一个开源的框架，[JSPatch](https://github.com/bang590/JSPatch)，我们可以在项目中引入JSPatch，
</code></pre><p>然后在在自己搭建下发补丁的服务器。<br>    当然，我们也可以直接用<a href="http://jspatch.com" target="_blank" rel="external">JSPatch平台</a>集成的带代码下发功能的SDK，我们只需要写好补丁，<br>直接就可以在这个平台下发了。</p>
<p>第一步：在<a href="http://jspatch.com" target="_blank" rel="external">JSPatch平台</a>注册一个帐号；<br>第二步：创建一个app；<br>第三步：下载JSPatch SDK，这个跟github上的不一样，github上的是开源的，不带代码下发服务器的。<br>第四步：生成RSA公钥和私钥。<br>       打开终端，cd到Desktop/，输入openssl后按回车，输入以下三行指令，<br><code>genrsa -out rsa_private_key.pem 1024<br>pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM –nocrypt<br>rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</code><br>在桌面时就会得到2个.pem文件，分别时公钥和私钥。<br>第五步：按照文档集成SDK到文档中，这个很简单。<br><img src="/img/jspatch_02.png" alt="初始化JSPatch"><br>其中，appkey是平台上创建app得到的appkey，而pullic key则是上步生成的RSA公钥，注意要手动加换行(\n)。<br>如：@”—–BEGIN PUBLIC KEY—–\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC1heHjbL+R6nulhIRptjfGmd3M\nlU…\n—–END PUBLIC KEY—–”。<br>而私钥，则是在下发补丁的时候需要用到。<br>    下发补丁时，服务端会计算补丁文件(js)文件的MD5值，然后讲这个MD5值用RSA私钥签名，签名后的字符串跟补丁一起下发到客户端。<br>客户端拿到签名后的字符串后，用公钥进行解密，得到一个MD5值，计算得到脚本的MD5值，比较这两个MD5值，若一支，说明补丁没有被篡改。<br>在运行时实现方法替换，替换掉我们的crash代码。<br>第六步：我们用在桌面上新建一个main.js文件，打开命令后，cd到桌面，输入 touch main.js后回车，在桌面就会生成一个main.js文件，用文本编辑器打开。<br>写入我们自己的方法替换掉crash部分的代码的所在的方法。<br><code><br>defineClass(‘LeftViewController’, {</code></p>
<pre><code>tableView_didSelectRowAtIndexPath: function(tableView, indexPath) {

    var array = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;];
    for (var i = 0; i &lt; array.count(); i++) {
        NSLog(&quot;%&quot;, array[i]);
    }
},
</code></pre><p>});<br><br>你可以用<a href="https://github.com/bang590/JSPatchConvertor/blob/gh-pages/JSPatchConvertor.zip" target="_blank" rel="external">JSPatchConverter</a>直接将写好的OC转成Patch，大部分可以直接转，但私有变量/静态变量/宏这些还不支持，所以转换后需要手动修改。可以借助这个工具，省去原本要先写好OC代码，在翻译成Patch的时间成本。<br>第七步：去<a href="http://jspatch.com" target="_blank" rel="external">JSPatch平台</a>下发补丁。<br>补丁选择刚刚的main.js，私钥选择刚刚生成的私钥private_key.pem文件，提交。<br><img src="/img/jspatch_03.png" alt=""><br>第八步：运行app，再次在LeftViewController的选择cell，之前选择cell导致的crash得到了修复！</p>
<p>至此，我们已经在不用重新提交版本的情况下，完成了bug的实时修复。<br><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/17/label-html/" itemprop="url">
                  两种方法实现UILabel图文并茂的显示html文本
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-17T21:57:50+08:00" content="2016-08-17">
              2016-08-17
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/17/label-html/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/17/label-html/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文讲述用2中方法在UILabel中显示带图片和文字的HTML文本。<br>先预览下显示效果：<br><img src="http://upload-images.jianshu.io/upload_images/937405-164214672d8ab9e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="显示效果"><br>如果你的设备时iOS 9或以上，默认只允许HTTPS，请打开HTTP请求许可，参照:<a href="http://www.jianshu.com/p/800637cce334" target="_blank" rel="external">iOS 9打开HTTP请求许可</a></p>
<p>第一种方案：</p>
<pre>
//HTML文本 包含图片、文本
NSString *htmlString=@"< img src=http://upload-images.jianshu.io/upload_images/937405-50a8ad2d8866fc12.png>&nbsp&nbsp花羊羊领取了你的<font color="\"red\""><a>红包</a></font>"
UILabel \*label=[UILabel alloc] initWithFrame:CGRectMake(50, 200, 220, 20)];
[self.view addSubview:label];
UIFont \*font=[UIFont systemFontOfSize:14];
label.font=font;
NSDictionary \\*optoins=@{NSDocumentTypeDocumentAttribute:NSHTMLTextDocumentType,
                            NSFontAttributeName:font};
NSData \*data=[htmlString dataUsingEncoding:NSUnicodeStringEncoding];
NSAttributedString \*attributeString=[[NSAttributedString alloc] initWithData:data
                                                                     options:optoins
                                                          documentAttributes:nil
                                                                       error:nil];
label.attributedText=attributeString;
</pre>
方案一点评：
这种方案只是实现了显示，显示效果好不好是另一回事。事实证明，这种方案的显示效果很不好：

![方案一显示效果](http://upload-images.jianshu.io/upload_images/937405-d810311964b43dab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

我们现在要对方案一进行优化。

方案一优化思路：1.缩小图片，让图片与字体显示差不多大；
2.让字体显示垂直方向居中。

优化后的方案一：

<pre>
//HTML文本 包含图片、文本
NSString *htmlString=@"< img src=http://upload-images.jianshu.io/upload_images/937405-50a8ad2d8866fc12.png>&nbsp&nbsp花羊羊领取了你的<font color="\"red\""><a>红包</a></font>"
//我们可以先把src对应的图片解析出来，放到本地
NSRange httpRange=[htmlString rangeOfString:@"http://"];
NSRange endRange=[htmlString rangeOfString:@".png"];
NSString \*picString=[htmlString substringWithRange:NSMakeRange(httpRange.location, endRange.location+endRange.length-httpRange.location)];
[[SDWebImageDownloader sharedDownloader] downloadImageWithURL:[NSURL URLWithString:picString] options:nil progress:nil completed:^(UIImage \\*image, NSData \\*data, NSError \*error, BOOL finished) {
    //按照字体大小缩小图片，具体实现在下文
     UIImage \\*scaledImage=[self scaleImage:image font:font];
     NSData \*imgData=UIImagePNGRepresentation(scaledImage);
     NSString \\*libPath=[NSSearchPathForDirectoriesInDomains(NSLibraryDirectory,     NSUserDomainMask, YES) lastObject];
    NSString \\*cachePath=[libPath stringByAppendingPathComponent:@"Caches"];
    NSString \\*scaledImagesPath=[cachePath stringByAppendingPathComponent:@"scaledImages"];
    if(![[NSFileManager defaultManager] fileExistsAtPath:scaledImagesPath]){
        [[NSFileManager defaultManager] createDirectoryAtPath:scaledImagesPath withIntermediateDirectories:YES attributes:nil error:nil];
    }
NSString\\ *picName=[[picString componentsSeparatedByString:@"/"] lastObject];
    NSString \\*filePath=[scaledImagesPath stringByAppendingPathComponent:picName];
    [imgData writeToFile:filePath atomically:YES];
    NSString \\*path=[NSURL fileURLWithPath:filePath].absoluteString;
//用本地的图片路径替换远程图片路径
htmlString=[htmlString stringByReplacingOccurrencesOfString:picString withString:path];
}];
UILabel \\*label=[UILabel alloc] initWithFrame:CGRectMake(50, 200, 220, 20)];
[self.view addSubview:label];
UIFont \\*font=[UIFont systemFontOfSize:14];
label.font=font;
NSDictionary \\*optoins=@{NSDocumentTypeDocumentAttribute:NSHTMLTextDocumentType,
                            NSFontAttributeName:font};
NSData \\*data=[htmlString dataUsingEncoding:NSUnicodeStringEncoding];
NSAttributedString \\*attributeString=[[NSAttributedString alloc] initWithData:data
                                                                     options:optoins
                                                          documentAttributes:nil
                                                                       error:nil];
label.attributedText=attributeString;
</pre>

<p><img src="http://upload-images.jianshu.io/upload_images/937405-aeaca04c3819680c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="优化后的方案一显示效果"></p>
<p>优化后的方案一显示效果差强人意。这种方法成功的解决了图片大小的问题，以及文本不居中的问题，但图片没有居中对齐，网上也找不到方法，只有继续探寻。</p>
<p>方案二：</p>
<pre>
//HTML文本 包含图片、文本
NSString *htmlString=@"< img src=http://upload-images.jianshu.io/upload_images/937405-50a8ad2d8866fc12.png>&nbsp&nbsp花羊羊领取了你的<font color="\"red\""><a>红包</a></font>"
//我们可以先把src对应的图片解析出来，放到本地
NSRange httpRange=[htmlString rangeOfString:@"http://"];
NSRange endRange=[htmlString rangeOfString:@".png"];
NSString \*picString=[htmlString substringWithRange:NSMakeRange(httpRange.location, endRange.location+endRange.length-httpRange.location)];
UIImage \*scaledImage;
[[SDWebImageDownloader sharedDownloader] downloadImageWithURL:[NSURL URLWithString:picString] options:nil progress:nil completed:^(UIImage \*image, NSData \*data, NSError \*error, BOOL finished) {
    //按照字体大小缩小图片，具体实现在下文
     scaledImage=[self scaleImage:image font:font];
     NSData \*imgData=UIImagePNGRepresentation(scaledImage);
     NSString \*libPath=[NSSearchPathForDirectoriesInDomains(NSLibraryDirectory,     NSUserDomainMask, YES) lastObject];
    NSString \*cachePath=[libPath stringByAppendingPathComponent:@"Caches"];
    NSString \*scaledImagesPath=[cachePath stringByAppendingPathComponent:@"scaledImages"];
    if(![[NSFileManager defaultManager] fileExistsAtPath:scaledImagesPath]){
        [[NSFileManager defaultManager] createDirectoryAtPath:scaledImagesPath withIntermediateDirectories:YES attributes:nil error:nil];
    }
NSString \\*picName=[[picString componentsSeparatedByString:@"/"] lastObject];
    NSString \\*filePath=[scaledImagesPath stringByAppendingPathComponent:picName];
    [imgData writeToFile:filePath atomically:YES];
//用空字符串替换远程图片路径
htmlString=[htmlString stringByReplacingOccurrencesOfString:picString withString:@""];
}];


UILabel \*label=[UILabel alloc] initWithFrame:CGRectMake(50, 200, 220, 20)];
[self.view addSubview:label];
UIFont \*font=[UIFont systemFontOfSize:14];
label.font=font;
//利用NSTextAttachment文UILabel添加图片，并调整位置实现居中对齐
NSTextAttachment *attach=[[NSTextAttachment alloc] init];
attach.bounds=CGRectMake(2, -(label.frame.size.height-font.pointSize)/2, 12, 14);
attach.image=scaledImage;
NSMutableAttributedString \*componets=[[NSMutableAttributedString alloc] init];
NSAttributedString \*imagePart=[NSAttributedString attributedStringWithAttachment:attach];
[componets appendAttributedString:imagePart];
NSDictionary \*optoins=@{NSDocumentTypeDocumentAttribute:NSHTMLTextDocumentType,
                            NSFontAttributeName:font};
NSData \*data=[htmlString dataUsingEncoding:NSUnicodeStringEncoding];
NSAttributedString \*textPart=[[NSAttributedString alloc] initWithData:data
                                                                     options:optoins
                                                          documentAttributes:nil
                                                                       error:nil];
[componets appendAttributedString:textPart];
label.attributedText=componets;
</pre>

<p><img src="http://upload-images.jianshu.io/upload_images/937405-e31040e80be7cc90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="方案二的显示效果"><br>点评：<br>方案二显示效果略复杂，但是达到了我们需要的正常显示效果。</p>
<p>最后，附上根据字体大小缩小图片的方法：</p>
<pre>
-(UIImage \*)scaleImage:(UIImage \*)origin font:(UIFont \*)font{

    CGFloat imgH=origin.size.height;
    CGFloat imgW=origin.size.width;
    CGFloat width;
    CGFloat height;
    CGFloat fontHeight=font.pointSize;
    if(imgW>imgH){

        width=fontHeight;
        height=fontHeight/imgW\*imgH;
    }
    else{
        height=fontHeight;
        width=fontHeight/imgH\*imgW;
    }
    UIGraphicsBeginImageContext(CGSizeMake(width, height));
    [origin drawInRect:CGRectMake(0, 0, width, height)];
    UIImage \*scaledImage=UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    return scaledImage;
}
</pre>

<p><img src="http://upload-images.jianshu.io/upload_images/937405-e91a649f7a7df2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="CGPoint Zero" />
          <p class="site-author-name" itemprop="name">CGPoint Zero</p>
          <p class="site-description motion-element" itemprop="description">平凡的世界我们终将平凡而过，拥有不平凡的斗志，才能成就自己的不平凡！</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/1752627837/profile?topnav=1&wvr=6" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/Insfgg99x" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/c3f2e8c87dc4/latest_articles" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  简书
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CGPoint Zero</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:""};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
